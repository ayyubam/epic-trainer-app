<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic EMR Trainer Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-hospital-user"></i>
                <span>Epic EMR Trainer Assistant</span>
            </div>
            <div class="user-actions">
                <div class="premium-badge" id="premium-status">
                    <i class="fas fa-crown"></i>
                    <span>Free Plan</span>
                </div>
                <button id="login-btn" class="btn btn-primary"><i class="fas fa-user"></i> Trainer Login</button>
            </div>
        </div>
    </header>
    
    <nav>
        <ul class="nav-tabs">
            <li><a href="#dashboard" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#hospitals" class="nav-link"><i class="fas fa-hospital"></i> Hospital Systems</a></li>
            <li><a href="#playground" class="nav-link"><i class="fas fa-gamepad"></i> Playground Navigation</a></li>
            <li><a href="#resources" class="nav-link"><i class="fas fa-book"></i> Resources</a></li>
            <li><a href="#faq" class="nav-link"><i class="fas fa-question-circle"></i> FAQ</a></li>
            <li><a href="#go-live" class="nav-link"><i class="fas fa-rocket"></i> Go-Live Support</a></li>
            <li><a href="#profile" class="nav-link"><i class="fas fa-user"></i> My Profile</a></li>
            <li><a href="#premium" class="nav-link"><i class="fas fa-crown"></i> Premium</a></li>
        </ul>
    </nav>
    
    <main>
        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content active">
            <h2>Welcome, Epic Trainer</h2>
            <p class="subtitle">Your central hub for Epic EMR training resources</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search across all hospitals, resources, and FAQs...">
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-hospital"></i>
                    <h3 id="hospital-count">6</h3>
                    <p>Hospital Systems</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-file-alt"></i>
                    <h3>156</h3>
                    <p>Training Resources</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-question-circle"></i>
                    <h3 id="faq-count">12</h3>
                    <p>Answered FAQs</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-sync-alt"></i>
                    <h3>6</h3>
                    <p>System Updates This Month</p>
                </div>
            </div>
            
            <h3>Recently Added Hospitals</h3>
            <div class="hospital-grid" id="dashboard-hospitals">
                <!-- Hospitals will be dynamically rendered here -->
            </div>
            
            <h3>Recent Resources</h3>
            <div class="resource-grid">
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Epic 2023 Upgrade Guide</h3>
                    <div class="resource-meta">
                        <span>PDF Document</span>
                        <span>2.4 MB</span>
                    </div>
                    <p>Complete guide to new features and changes in Epic 2023 version.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="doc-001" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Playground Navigation Video</h3>
                    <div class="resource-meta">
                        <span>Video Tutorial</span>
                        <span>15:32 min</span>
                    </div>
                    <p>Step-by-step guide to setting up and using the Epic playground environment.</p>
                    <button class="btn btn-primary"><i class="fas fa-play-circle"></i> Watch</button>
                    <button class="btn btn-outline save-btn" data-id="doc-002" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
            </div>
        </section>
        
        <!-- Hospitals Tab -->
        <section id="hospitals" class="tab-content">
            <h2>Hospital Systems</h2>
            <p>Comprehensive database of hospital Epic implementations</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search hospital systems...">
            </div>
            
            <div class="hospital-grid" id="hospital-list">
                <!-- Hospitals will be dynamically rendered here -->
            </div>
        </section>
        
        <!-- Playground Navigation Tab -->
        <section id="playground" class="tab-content">
            <h2>Epic Playground Navigation</h2>
            <p>Guidance for using the Epic training environments</p>
            
            <div class="faq-container">
                <!-- FAQs will be dynamically rendered here -->
            </div>
        </section>
        
        <!-- Resources Tab -->
        <section id="resources" class="tab-content">
            <h2>Epic Resources</h2>
            <p>Training materials, guides, and documentation</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search resources...">
            </div>
            
            <button class="btn btn-primary" id="upload-resource-btn"><i class="fas fa-upload"></i> Upload New Resource</button>
            
            <div class="resource-grid">
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Epic Fundamentals Training Guide</h3>
                    <div class="resource-meta">
                        <span>PDF Document</span>
                        <span>5.2 MB</span>
                    </div>
                    <p>Complete guide to Epic fundamentals for new trainers.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="res-001" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>MyChart Patient Portal Tutorial</h3>
                    <div class="resource-meta">
                        <span>Video</span>
                        <span>22:15 min</span>
                    </div>
                    <p>Detailed walkthrough of MyChart features and patient communication tools.</p>
                    <button class="btn btn-primary"><i class="fas fa-play-circle"></i> Watch</button>
                    <button class="btn btn-outline save-btn" data-id="res-002" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Clinical Documentation Templates</h3>
                    <div class="resource-meta">
                        <span>ZIP File</span>
                        <span>3.7 MB</span>
                    </div>
                    <p>Collection of customizable clinical documentation templates.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="res-003" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Reporting Workbench Guide</h3>
                    <div class="resource-meta">
                        <span>PDF Document</span>
                        <span>4.1 MB</span>
                    </div>
                    <p>Creating and customizing reports in Epic.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="res-004" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
            </div>
        </section>
        
        <!-- FAQ Tab -->
        <section id="faq" class="tab-content">
            <h2>Frequently Asked Questions</h2>
            <p>Find answers to common Epic navigation questions</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search FAQs...">
            </div>
            
            <div class="faq-container" id="faq-list">
                <!-- FAQs will be dynamically rendered here -->
            </div>
        </section>
        
        <!-- Go-Live Support Tab -->
        <section id="go-live" class="tab-content">
            <h2><i class="fas fa-rocket"></i> Epic Go-Live Support Center</h2>
            <p class="subtitle">Tools and resources for successful Epic implementations</p>
            
            <div class="stats-grid" id="go-live-stats">
                <!-- Stats will be populated by JavaScript -->
            </div>
            
            <h3>Go-Live Phases</h3>
            <div class="go-live-phases">
                <div class="phase-card">
                    <h3><i class="fas fa-clipboard-check"></i> Preparation (D-30 to D-7)</h3>
                    <ul>
                        <li>Command Center Setup</li>
                        <li>Staff Training Completion</li>
                        <li>System Validation</li>
                        <li>Dress Rehearsal Planning</li>
                    </ul>
                    <button class="btn btn-primary">View Checklist</button>
                </div>
                
                <div class="phase-card">
                    <h3><i class="fas fa-bullhorn"></i> Go-Live Day (D-0)</h3>
                    <ul>
                        <li>Command Center Active</li>
                        <li>Real-time Issue Tracking</li>
                        <li>Leadership Updates</li>
                        <li>24/7 Support Coverage</li>
                    </ul>
                    <button class="btn btn-primary">Live Dashboard</button>
                </div>
                
                <div class="phase-card">
                    <h3><i class="fas fa-headset"></i> Hypercare (D+1 to D+14)</h3>
                    <ul>
                        <li>Intensive 24/7 Support</li>
                        <li>Rapid Issue Resolution</li>
                        <li>Performance Monitoring</li>
                        <li>User Feedback Collection</li>
                    </ul>
                    <button class="btn btn-primary">Support Metrics</button>
                </div>
            </div>
            
            <h3>Quick Resources</h3>
            <div class="resource-grid" id="go-live-resources">
                <div class="resource-card">
                    <h3>Go-Live Checklist Template</h3>
                    <div class="resource-meta">
                        <span>Excel Template</span>
                        <span>1.2 MB</span>
                    </div>
                    <p>Comprehensive 120-item checklist for Go-Live preparation.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                </div>
                
                <div class="resource-card">
                    <h3>Command Center Setup Guide</h3>
                    <div class="resource-meta">
                        <span>PDF Guide</span>
                        <span>3.5 MB</span>
                    </div>
                    <p>Step-by-step guide to setting up an effective Command Center.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                </div>
                
                <div class="resource-card">
                    <h3>Staffing Calculator Tool</h3>
                    <div class="resource-meta">
                        <span>Web Tool</span>
                        <span>Interactive</span>
                    </div>
                    <p>Calculate support staff requirements based on user count and specialties.</p>
                    <button class="btn btn-primary"><i class="fas fa-calculator"></i> Open Tool</button>
                </div>
            </div>
        </section>
        
        <!-- Profile Tab -->
        <section id="profile" class="tab-content">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <h2>John Smith</h2>
                    <p>Epic Certified Trainer</p>
                    <p>Mercy General Hospital</p>
                    <div class="premium-badge">
                        <i class="fas fa-crown"></i>
                        <span>Free Plan</span>
                    </div>
                </div>
            </div>
            
            <div class="premium-upgrade">
                <h2><i class="fas fa-crown"></i> Upgrade to Premium</h2>
                <p>Unlock the ability to save hospitals, resources, and FAQs to your personal profile</p>
                <button class="btn btn-premium pulse" id="upgrade-btn"><i class="fas fa-star"></i> Upgrade Now</button>
                
                <div class="premium-features">
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save hospitals to your profile</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save resources and documentation</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save FAQ answers for quick reference</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Add personal notes to saved items</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Access your saved content from any device</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Organize content with custom categories</span>
                    </div>
                </div>
            </div>
            
            <div class="profile-tabs">
                <div class="profile-tab active" data-tab="saved">Saved Content</div>
                <div class="profile-tab" data-tab="uploads">My Uploads</div>
                <div class="profile-tab" data-tab="questions">My Questions</div>
                <div class="profile-tab" data-tab="settings">Settings</div>
            </div>
            
            <div class="profile-content">
                <div class="profile-tab-content active" id="saved-tab">
                    <div class="premium-upgrade">
                        <h2><i class="fas fa-lock"></i> Premium Feature</h2>
                        <p>Upgrade to Premium to save hospitals, resources, and FAQs to your personal profile</p>
                        <button class="btn btn-premium" id="upgrade-btn-2"><i class="fas fa-crown"></i> Upgrade to Premium</button>
                    </div>
                </div>
                
                <div class="profile-tab-content" id="uploads-tab">
                    <h3>My Uploaded Resources</h3>
                    <p>You haven't uploaded any resources yet.</p>
                    <button class="btn btn-primary" id="upload-from-profile-btn"><i class="fas fa-upload"></i> Upload Your First Resource</button>
                </div>
                
                <div class="profile-tab-content" id="questions-tab">
                    <h3>My Questions</h3>
                    <p>You haven't asked any questions yet.</p>
                </div>
                
                <div class="profile-tab-content" id="settings-tab">
                    <h3>Account Settings</h3>
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" class="form-control" id="name" value="John Smith">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" class="form-control" id="email" value="john.smith@mercygeneral.org">
                    </div>
                    <div class="form-group">
                        <label for="hospital">Primary Hospital</label>
                        <select class="form-control" id="hospital">
                            <option value="mercy">Mercy General Hospital</option>
                            <option value="mayo">Mayo Clinic</option>
                            <option value="hopkins">Johns Hopkins Hospital</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="certification">Epic Certification</label>
                        <input type="text" class="form-control" id="certification" value="Epic Physician Trainer Certified">
                    </div>
                    <button class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </section>
        
        <!-- Premium Tab -->
        <section id="premium" class="tab-content">
            <h2><i class="fas fa-crown"></i> Epic Trainer Premium</h2>
            <p class="subtitle">Upgrade your experience with powerful profile features</p>
            
            <div class="premium-upgrade">
                <h2>Unlock Premium Features</h2>
                <p>Get access to personalized profile features designed for Epic trainers</p>
                
                <div class="premium-features">
                    <div class="premium-feature">
                        <i class="fas fa-bookmark"></i>
                        <span>Save hospitals, resources, and FAQs to your profile</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-sticky-note"></i>
                        <span>Add personal notes to saved content</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-folder"></i>
                        <span>Organize content with custom categories</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Access your profile from any device</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-search"></i>
                        <span>Save search history and preferences</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-cloud-download-alt"></i>
                        <span>Download resources for offline access</span>
                    </div>
                </div>
            </div>
            
            <h3>Choose Your Plan</h3>
            <div class="pricing-plans">
                <div class="pricing-plan">
                    <h4>Free</h4>
                    <div class="plan-price">$0<span>/month</span></div>
                    <ul class="plan-features">
                        <li><i class="fas fa-check"></i> Access to all hospitals</li>
                        <li><i class="fas fa-check"></i> Browse resources</li>
                        <li><i class="fas fa-check"></i> Read FAQs</li>
                        <li><i class="fas fa-times"></i> <span class="text-muted">Save to profile</span></li>
                        <li><i class="fas fa-times"></i> <span class="text-muted">Personal notes</span></li>
                        <li><i class="fas fa-times"></i> <span class="text-muted">Offline access</span></li>
                    </ul>
                    <button class="btn btn-outline" disabled>Current Plan</button>
                </div>
                
                <div class="pricing-plan popular">
                    <div class="popular-badge">MOST POPULAR</div>
                    <h4>Premium Monthly</h4>
                    <div class="plan-price">$9.99<span>/month</span></div>
                    <ul class="plan-features">
                        <li><i class="fas fa-check"></i> Everything in Free</li>
                        <li><i class="fas fa-check"></i> Save unlimited items</li>
                        <li><i class="fas fa-check"></i> Add personal notes</li>
                        <li><i class="fas fa-check"></i> Organize with categories</li>
                        <li><i class="fas fa-check"></i> Search history</li>
                        <li><i class="fas fa-check"></i> Offline access</li>
                    </ul>
                    <button class="btn btn-premium"><i class="fas fa-crown"></i> Upgrade Now</button>
                </div>
                
                <div class="pricing-plan">
                    <h4>Premium Annual</h4>
                    <div class="plan-price">$99.99<span>/year</span></div>
                    <div class="small">Save $20 compared to monthly</div>
                    <ul class="plan-features">
                        <li><i class="fas fa-check"></i> Everything in Free</li>
                        <li><i class="fas fa-check"></i> Save unlimited items</li>
                        <li><i class="fas fa-check"></i> Add personal notes</li>
                        <li><i class="fas fa-check"></i> Organize with categories</li>
                        <li><i class="fas fa-check"></i> Search history</li>
                        <li><i class="fas fa-check"></i> Offline access</li>
                    </ul>
                    <button class="btn btn-premium"><i class="fas fa-crown"></i> Upgrade Now</button>
                </div>
            </div>
            
            <div class="premium-upgrade">
                <h2>Frequently Asked Questions</h2>
                
                <div class="faq-item">
                    <div class="faq-question">What payment methods do you accept? <span>+</span></div>
                    <div class="faq-answer">
                        <p>We accept all major credit cards, PayPal, and Apple Pay for your convenience.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Can I cancel my subscription anytime? <span>+</span></div>
                    <div class="faq-answer">
                        <p>Yes, you can cancel your subscription at any time. Your premium features will remain active until the end of your billing period.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Will I lose my saved data if I cancel? <span>+</span></div>
                    <div class="faq-answer">
                        <p>Your saved data will be preserved for 6 months after cancellation. If you resubscribe within that time, you'll regain access to all your saved content.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Is there a free trial? <span>+</span></div>
                    <div class="faq-answer">
                        <p>Yes, we offer a 7-day free trial for new premium subscribers. No credit card required to start the trial.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <p>Epic EMR Trainer Assistant | For training purposes only</p>
        <p>This application is not affiliated with Epic Systems Corporation</p>
        <p>© 2023 Epic EMR Trainer Assistant. All rights reserved.</p>
    </footer>

    <!-- MODALS GO HERE (NOT BEFORE <body>) -->
    <!-- Upload Resource Modal -->
    <div class="modal-overlay" id="upload-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>Upload Epic Documentation</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="file-upload" id="file-upload-area">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to select a file or drag and drop here</p>
                <p class="small">Maximum file size: 50MB</p>
                <input type="file" id="file-input" style="display: none;">
            </div>
            
            <div id="file-info" style="display: none;">
                <h4>Selected file: <span id="file-name"></span></h4>
                <p>Size: <span id="file-size"></span></p>
            </div>
            
            <div class="form-group">
                <label for="doc-title">Document Title</label>
                <input type="text" class="form-control" id="doc-title" placeholder="Enter a descriptive title">
            </div>
            
            <div class="form-group">
                <label for="doc-description">Description</label>
                <textarea class="form-control" id="doc-description" placeholder="Describe what this document contains"></textarea>
            </div>
            
            <div class="form-group">
                <label for="doc-category">Category</label>
                <select class="form-control" id="doc-category">
                    <option value="">Select a category</option>
                    <option value="user-guide">User Guide</option>
                    <option value="training-manual">Training Manual</option>
                    <option value="release-notes">Release Notes</option>
                    <option value="cheat-sheet">Cheat Sheet</option>
                    <option value="presentation">Presentation</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="doc-tags">Tags (comma separated)</label>
                <input type="text" class="form-control" id="doc-tags" placeholder="e.g., billing, clinical, reports">
            </div>
            
            <div class="form-group">
                <label for="doc-hospital">Related Hospital (optional)</label>
                <select class="form-control" id="doc-hospital">
                    <option value="">Select a hospital</option>
                    <option value="mercy">Mercy General Hospital</option>
                    <option value="mayo">Mayo Clinic</option>
                    <option value="hopkins">Johns Hopkins Hospital</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="checkbox">
                    <input type="checkbox" id="doc-public"> Make this document public for all users
                </label>
            </div>
            
            <button class="btn btn-primary" id="start-upload-btn" disabled><i class="fas fa-upload"></i> Upload Document</button>
        </div>
    </div>
    
    <!-- Upgrade Modal -->
    <div class="modal-overlay" id="upgrade-modal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-crown"></i> Upgrade to Premium</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="premium-upgrade">
                <h3>Start Your 7-Day Free Trial</h3>
                <p>Get immediate access to all premium features</p>
                
                <div class="plan-price">$9.99<span>/month after trial</span></div>
                
                <div class="premium-features">
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save hospitals to your profile</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save resources and documentation</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save FAQ answers for quick reference</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Add personal notes to saved items</span>
                    </div>
                </div>
                
                <button class="btn btn-premium" id="start-trial-btn"><i class="fas fa-play-circle"></i> Start Free Trial</button>
                <p class="small">No credit card required. Cancel anytime.</p>
            </div>
        </div>
    </div>

    <script>
    // ==================== API URL HELPER ====================
    function getApiUrl(endpoint) {
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            return `http://localhost:3000/${endpoint}`;
        }
        return `/.netlify/functions/${endpoint}`;
    }
    
    // ==================== ORIGINAL APP CORE ====================
    const userState = {
        isPremium: false,
        savedItems: [],
        currentUser: null
    };

    // Sample data - MAKE SURE THIS IS DEFINED
        // Sample data - COMPLETE VERSION
    const hospitals = [
    { 
        id: 1, 
        name: "Mayo Clinic", 
        version: "Epic 2022", 
        modules: ["Radiant", "Beaker", "OpTime", "Research", "Cadence", "Prelude"], 
        notes: "Uses special billing modules and research functionality. Strong focus on oncology and cardiology.",
        lastUpdated: "2023-10-15",
        goLiveDate: "2022-06-15",
        epicTeamSize: 58,
        trainingRooms: 12,
        supportModel: "24/7 Tier 1-3 with specialty pods",
        specialtyAreas: ["Oncology", "Cardiology", "Transplant", "Neurology"],
        contact: {
            name: "Dr. Sarah Johnson",
            email: "sjohnson@mayoclinic.org",
            phone: "(555) 123-4567",
            role: "Epic Principal Trainer"
        },
        epicContacts: [
            { role: "Principal Trainer", name: "Sarah Johnson", email: "sjohnson@mayoclinic.org", phone: "(555) 123-4567" },
            { role: "Analyst Lead", name: "Michael Roberts", email: "mroberts@mayoclinic.org", phone: "(555) 123-4568" },
            { role: "Physician Builder", name: "Dr. James Wilson", email: "jwilson@mayoclinic.org", phone: "(555) 123-4569" }
        ],
        stats: {
            usersTrained: 1250,
            goLiveSuccess: 98,
            supportTickets: 45,
            avgResolutionTime: "2.3 hours"
        }
    },
    { 
        id: 2, 
        name: "Johns Hopkins Hospital", 
        version: "Epic 2023", 
        modules: ["Care Everywhere", "MyChart", "Healthy Planet", "Research", "Cupid"], 
        notes: "Research-focused customization with specialized modules. Early adopter of new Epic features.",
        lastUpdated: "2023-11-05",
        goLiveDate: "2023-03-22",
        epicTeamSize: 42,
        trainingRooms: 8,
        supportModel: "Dedicated specialty support teams",
        specialtyAreas: ["Research", "Pediatrics", "Genomics", "Telemedicine"],
        contact: {
            name: "Michael Chen",
            email: "mchen@jh.edu",
            phone: "(555) 234-5678",
            role: "Epic Training Director"
        },
        epicContacts: [
            { role: "Training Director", name: "Michael Chen", email: "mchen@jh.edu", phone: "(555) 234-5678" },
            { role: "Research Lead", name: "Dr. Amanda Lee", email: "alee@jh.edu", phone: "(555) 234-5679" },
            { role: "Clinical Informatics", name: "Robert Kim", email: "rkim@jh.edu", phone: "(555) 234-5680" }
        ],
        stats: {
            usersTrained: 980,
            goLiveSuccess: 96,
            supportTickets: 32,
            avgResolutionTime: "3.1 hours"
        }
    },
    { 
        id: 3, 
        name: "Massachusetts General Hospital", 
        version: "Epic 2022", 
        modules: ["Cadence", "Prelude", "Grand Central", "Beaker", "Radiant"], 
        notes: "Integrated with Partners healthcare system. Strong emphasis on patient portal implementation.",
        lastUpdated: "2023-09-22",
        goLiveDate: "2021-11-30",
        epicTeamSize: 67,
        trainingRooms: 15,
        supportModel: "Hub-and-spoke with central command",
        specialtyAreas: ["Emergency Medicine", "Psychiatry", "Rheumatology", "Orthopedics"],
        contact: {
            name: "Emily Rodriguez",
            email: "erodriguez@mgh.harvard.edu",
            phone: "(555) 345-6789",
            role: "Epic Program Manager"
        },
        epicContacts: [
            { role: "Program Manager", name: "Emily Rodriguez", email: "erodriguez@mgh.harvard.edu", phone: "(555) 345-6789" },
            { role: "Emergency Med Lead", name: "Dr. David Park", email: "dpark@mgh.harvard.edu", phone: "(555) 345-6790" },
            { role: "MyChart Specialist", name: "Jennifer Wong", email: "jwong@mgh.harvard.edu", phone: "(555) 345-6791" }
        ],
        stats: {
            usersTrained: 2100,
            goLiveSuccess: 99,
            supportTickets: 67,
            avgResolutionTime: "1.8 hours"
        }
    },
    { 
        id: 4, 
        name: "Cleveland Clinic", 
        version: "Epic 2023", 
        modules: ["Hyperspace", "Cupid", "Bones", "MyChart", "Healthy Planet"], 
        notes: "Cardiology specialty focus with custom modules. Strong telemedicine integration.",
        lastUpdated: "2023-11-12",
        goLiveDate: "2023-01-10",
        epicTeamSize: 53,
        trainingRooms: 10,
        supportModel: "Cardiology-focused tiered support",
        specialtyAreas: ["Cardiology", "Cardiac Surgery", "Vascular", "Tele-ICU"],
        contact: {
            name: "Robert Williams",
            email: "rwilliams@clevelandclinic.org",
            phone: "(555) 456-7890",
            role: "Cardiology Epic Lead"
        },
        epicContacts: [
            { role: "Cardiology Lead", name: "Robert Williams", email: "rwilliams@clevelandclinic.org", phone: "(555) 456-7890" },
            { role: "Surgery Analyst", name: "Dr. Thomas Brown", email: "tbrown@clevelandclinic.org", phone: "(555) 456-7891" },
            { role: "Telemedicine Lead", name: "Susan Davis", email: "sdavis@clevelandclinic.org", phone: "(555) 456-7892" }
        ],
        stats: {
            usersTrained: 1450,
            goLiveSuccess: 97,
            supportTickets: 41,
            avgResolutionTime: "2.5 hours"
        }
    },
    { 
        id: 5, 
        name: "UCSF Medical Center", 
        version: "Epic 2022", 
        modules: ["Beaker", "Willow", "Phoenix", "Radiant", "Care Everywhere"], 
        notes: "Academic medical center configuration with research emphasis. Strong pediatric specialization.",
        lastUpdated: "2023-08-30",
        goLiveDate: "2022-04-18",
        epicTeamSize: 49,
        trainingRooms: 9,
        supportModel: "Academic research integrated support",
        specialtyAreas: ["Pediatrics", "Neonatology", "Cancer Research", "Infectious Disease"],
        contact: {
            name: "Jennifer Lee",
            email: "jlee@ucsf.edu",
            phone: "(555) 567-8901",
            role: "Academic Epic Director"
        },
        epicContacts: [
            { role: "Academic Director", name: "Jennifer Lee", email: "jlee@ucsf.edu", phone: "(555) 567-8901" },
            { role: "Research Coordinator", name: "Dr. Mark Taylor", email: "mtaylor@ucsf.edu", phone: "(555) 567-8902" },
            { role: "Pediatrics Lead", name: "Lisa Martinez", email: "lmartinez@ucsf.edu", phone: "(555) 567-8903" }
        ],
        stats: {
            usersTrained: 1100,
            goLiveSuccess: 95,
            supportTickets: 38,
            avgResolutionTime: "2.8 hours"
        }
    },
    { 
        id: 6, 
        name: "NewYork-Presbyterian Hospital", 
        version: "Epic 2023", 
        modules: ["Healthy Planet", "MyChart", "Care Companion", "Cadence", "Prelude"], 
        notes: "Large multi-campus system with unified Epic implementation. Strong population health focus.",
        lastUpdated: "2023-10-28",
        goLiveDate: "2023-02-14",
        epicTeamSize: 72,
        trainingRooms: 18,
        supportModel: "Multi-campus command center model",
        specialtyAreas: ["Population Health", "Multispecialty", "Ambulatory Care", "Behavioral Health"],
        contact: {
            name: "David Kim",
            email: "dkim@nyp.org",
            phone: "(555) 678-9012",
            role: "Enterprise Epic Manager"
        },
        epicContacts: [
            { role: "Enterprise Manager", name: "David Kim", email: "dkim@nyp.org", phone: "(555) 678-9012" },
            { role: "Population Health Lead", name: "Dr. Rachel Green", email: "rgreen@nyp.org", phone: "(555) 678-9013" },
            { role: "Ambulatory Director", name: "Kevin White", email: "kwhite@nyp.org", phone: "(555) 678-9014" }
        ],
        stats: {
            usersTrained: 2800,
            goLiveSuccess: 99,
            supportTickets: 89,
            avgResolutionTime: "2.1 hours"
        }
    }
];

    const faqs = [
        { 
            id: 1,
            question: "How do I access the Epic Playground?", 
            answer: "Access to the Epic Playground varies by organization. Typically, you need to connect through your organization's VPN and use a specific URL provided by your Epic team. Some organizations require additional authentication steps or special permissions granted by your Epic coordinator.",
            category: "Access",
            helpfulCount: 24
        },
        { 
            id: 2,
            question: "What's the difference between Hyperspace and Hyperdrive?", 
            answer: "Hyperspace is the traditional Epic interface, while Hyperdrive is the newer, web-based version that offers improved performance and customization options. Hyperdrive allows for faster navigation, better mobile compatibility, and more personalized workspace configurations. Most organizations are transitioning to Hyperdrive, but some modules may still require Hyperspace.",
            category: "Navigation",
            helpfulCount: 31
        },
        { 
            id: 3,
            question: "How often does Epic release updates?", 
            answer: "Epic typically releases major updates once a year, with smaller updates and patches throughout the year. Organizations can choose when to implement these updates, but most follow a regular schedule. Major updates usually occur in the spring or fall, with preview environments available 3-4 months before the production upgrade.",
            category: "Updates",
            helpfulCount: 18
        },
        { 
            id: 4,
            question: "How can I customize training for different specialties?", 
            answer: "Epic allows trainers to create specialized training profiles, build custom training environments, and use the Training Wheels feature to guide users through workflows. You can create specialty-specific patient scenarios, develop custom learning paths, and utilize the role-based access configurations to simulate real clinical environments for each specialty.",
            category: "Training",
            helpfulCount: 29
        },
        { 
            id: 5,
            question: "How do I get access to Epic UserWeb?", 
            answer: "Access to Epic UserWeb is typically provided by your organization's Epic coordinator. You'll need to complete required training and request access through proper channels. Most organizations have a process for requesting UserWeb access that may include completing security training, signing access agreements, and having a legitimate business need for the resource.",
            category: "Access",
            helpfulCount: 15
        },
        { 
            id: 6,
            question: "What's the best way to train physicians on Epic?", 
            answer: "Physician training works best when it's specialty-specific, concise, and focused on workflow efficiency. Use real clinical scenarios, emphasize time-saving features like SmartTools and SmartPhrases, and provide just-in-time training resources. Many organizations find success with a combination of classroom training, one-on-one coaching, and specialty-specific tip sheets.",
            category: "Training",
            helpfulCount: 42
        },
        { 
            id: 7,
            question: "What are the critical Go-Live support phases?", 
            answer: "Epic Go-Live typically follows these phases:<br><br><strong>1) Command Center Setup (Day -30):</strong> Physical setup, staffing, equipment<br><strong>2) Dress Rehearsal (Day -7):</strong> Full system test with simulated patients<br><strong>3) Go-Live Day (Day 0):</strong> Live support begins, real patients<br><strong>4) Hypercare (Days 1-14):</strong> 24/7 intensive support<br><strong>5) Sustainment (Day 15+):</strong> Transition to normal operations",
            category: "Go-Live",
            helpfulCount: 0
        },
        { 
            id: 8,
            question: "How many support staff are needed per 100 users?", 
            answer: "Industry standard staffing ratios for Epic Go-Live:<br><br><strong>Tier 1 (At-the-elbow):</strong> 1:50 ratio (2 staff for 100 users)<br><strong>Tier 2 (Command Center):</strong> 1:100 ratio (1 staff for 100 users)<br><strong>Tier 3 (Analyst/Builder):</strong> 1:200 ratio (0.5 staff for 100 users)<br><br><em>Note:</em> These ratios increase for complex specialties like ED, OR, and ICU.",
            category: "Staffing",
            helpfulCount: 0
        },
        { 
            id: 9,
            question: "What metrics should we track during Go-Live?", 
            answer: "Critical Go-Live metrics to monitor:<br><br>• <strong>Ticket Volume:</strong> Total and by priority<br>• <strong>Resolution Time:</strong> Average time to close tickets<br>• <strong>First Call Resolution:</strong> Percentage resolved at Tier 1<br>• <strong>User Satisfaction:</strong> Real-time feedback scores<br>• <strong>System Performance:</strong> Downtime, response times<br>• <strong>Clinical Impact:</strong> Patient safety issues<br><br>Track these on a live dashboard visible to leadership.",
            category: "Metrics",
            helpfulCount: 0
        },
        { 
            id: 10,
            question: "How do we handle physician resistance during Go-Live?", 
            answer: "Strategies for physician adoption:<br><br>1. <strong>Physician Champions:</strong> Identify and empower early adopters<br>2. <strong>Specialty-Specific Training:</strong> Customize for each department<br>3. <strong>Just-in-Time Support:</strong> Have trainers in clinical areas<br>4. <strong>Efficiency Tools:</strong> Emphasize time-saving features (SmartPhrases, SmartTools)<br>5. <strong>Leadership Engagement:</strong> Involve department chairs in planning<br>6. <strong>Quick Wins:</strong> Highlight immediate benefits in first week",
            category: "Change Management",
            helpfulCount: 0
        },
        { 
            id: 11,
            question: "What's the difference between Hypercare and Sustainment?", 
            answer: "<strong>Hypercare (Days 1-14):</strong><br>• 24/7 support coverage<br>• At-the-elbow support in all clinical areas<br>• Command Center with real-time monitoring<br>• Leadership updates every 2-4 hours<br>• Focus: Immediate issue resolution, patient safety<br><br><strong>Sustainment (Day 15+):</strong><br>• Normal business hours support<br>• Help desk with escalation paths<br>• Scheduled optimization sessions<br>• Monthly metrics reporting<br>• Focus: Optimization, training new users",
            category: "Support Models",
            helpfulCount: 0
        },
        { 
            id: 12,
            question: "How do we prepare the Command Center?", 
            answer: "Command Center setup checklist:<br><br><strong>Physical Space:</strong><br>• Large room with multiple work areas<br>• Whiteboards/wall monitors for status<br>• Quiet rooms for sensitive calls<br>• Refreshment area for staff<br><br><strong>Technology:</strong><br>• Dedicated phones and headsets<br>• Multiple large-screen displays<br>• Real-time dashboard software<br>• Secure Wi-Fi and network<br><br><strong>Staffing:</strong><br>• Clear roles and responsibilities<br>• Shift schedules posted<br>• Escalation paths defined<br>• Leadership presence",
            category: "Command Center",
            helpfulCount: 0
        }
    ];

    // ==================== FIXED TAB NAVIGATION ====================
    function initApp() {
        console.log('Initializing app...');
        
        // Set up navigation
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                console.log('Clicked tab:', targetId);
                
                // Update active tab
                navLinks.forEach(navLink => navLink.classList.remove('active'));
                link.classList.add('active');
                
                // Show target content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.classList.add('active');
                    console.log('Showing tab:', targetId);
                    
                    // If it's the go-live section, update stats
                    if (targetId === 'go-live') {
                        updateGoLiveStats();
                    }
                } else {
                    console.error('Tab content not found:', targetId);
                }
            });
        });
        
        // Initialize dashboard stats
        document.getElementById('hospital-count').textContent = hospitals.length;
        document.getElementById('faq-count').textContent = faqs.length;
        
        // Render hospitals and FAQs
        renderHospitals();
        renderFAQs();
        
        // Update Go-Live stats
        updateGoLiveStats();
        
        // Set up search functionality
        initSearchFunctionality();
        
        // Profile tabs
        const profileTabs = document.querySelectorAll('.profile-tab');
        const profileTabContents = document.querySelectorAll('.profile-tab-content');
        
        profileTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                profileTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show target content
                profileTabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Save button handlers
        document.querySelectorAll('.save-btn').forEach(button => {
            button.addEventListener('click', handleSaveItem);
        });
        
        // Upload modal
        const uploadResourceBtn = document.getElementById('upload-resource-btn');
        const uploadFromProfileBtn = document.getElementById('upload-from-profile-btn');
        const modalCloseBtns = document.querySelectorAll('.modal-close');
        
        if (uploadResourceBtn) {
            uploadResourceBtn.addEventListener('click', () => {
                document.getElementById('upload-modal').classList.add('active');
            });
        }
        
        if (uploadFromProfileBtn) {
            uploadFromProfileBtn.addEventListener('click', () => {
                document.getElementById('upload-modal').classList.add('active');
            });
        }
        
        modalCloseBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('upload-modal').classList.remove('active');
                document.getElementById('upgrade-modal').classList.remove('active');
            });
        });
        
        // File upload handling
        const fileUploadArea = document.getElementById('file-upload-area');
        const fileInput = document.getElementById('file-input');
        const startUploadBtn = document.getElementById('start-upload-btn');
        
        if (fileUploadArea && fileInput) {
            fileUploadArea.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const fileName = document.getElementById('file-name');
                    const fileSize = document.getElementById('file-size');
                    const fileInfo = document.getElementById('file-info');
                    
                    if (fileName) fileName.textContent = file.name;
                    if (fileSize) fileSize.textContent = formatFileSize(file.size);
                    if (fileInfo) fileInfo.style.display = 'block';
                }
            });
        }
        
        if (startUploadBtn) {
            startUploadBtn.addEventListener('click', () => {
                startUploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
                startUploadBtn.disabled = true;
                
                setTimeout(() => {
                    showNotification('Document uploaded successfully!');
                    document.getElementById('upload-modal').classList.remove('active');
                    startUploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Document';
                    startUploadBtn.disabled = false;
                }, 2000);
            });
        }
        
        // Upgrade buttons
        const upgradeButtons = document.querySelectorAll('#upgrade-btn, #upgrade-btn-2');
        const startTrialBtn = document.getElementById('start-trial-btn');
        
        upgradeButtons.forEach(button => {
            button.addEventListener('click', () => {
                document.getElementById('upgrade-modal').classList.add('active');
            });
        });
        
        if (startTrialBtn) {
            startTrialBtn.addEventListener('click', () => {
                startTrialBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                
                setTimeout(() => {
                    userState.isPremium = true;
                    const premiumBadge = document.getElementById('premium-status');
                    if (premiumBadge) {
                        premiumBadge.innerHTML = '<i class="fas fa-crown"></i> Premium Member';
                        premiumBadge.style.background = 'linear-gradient(135deg, var(--premium-gold), var(--premium-dark))';
                    }
                    showNotification('Welcome to Premium! You now have access to all profile features.');
                    document.getElementById('upgrade-modal').classList.remove('active');
                    startTrialBtn.innerHTML = '<i class="fas fa-play-circle"></i> Start Free Trial';
                }, 1500);
            });
        }
        
        console.log('App initialized successfully');
    }

    function updateGoLiveStats() {
        console.log('Updating Go-Live stats...');
        const totalEpicTeam = hospitals.reduce((sum, hospital) => sum + hospital.epicTeamSize, 0);
        const totalUsersTrained = hospitals.reduce((sum, hospital) => sum + hospital.stats.usersTrained, 0);
        const avgSuccessRate = (hospitals.reduce((sum, hospital) => sum + hospital.stats.goLiveSuccess, 0) / hospitals.length).toFixed(1);
        
        const statsHTML = `
            <div class="stat-card">
                <i class="fas fa-hospital"></i>
                <h3>${hospitals.length}</h3>
                <p>Hospital Systems</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <h3>${totalEpicTeam}</h3>
                <p>Total Epic Team Members</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-chart-line"></i>
                <h3>${avgSuccessRate}%</h3>
                <p>Average Success Rate</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-graduation-cap"></i>
                <h3>${totalUsersTrained.toLocaleString()}</h3>
                <p>Users Trained</p>
            </div>
        `;
        
        const statsContainer = document.getElementById('go-live-stats');
        if (statsContainer) {
            statsContainer.innerHTML = statsHTML;
            console.log('Go-Live stats updated');
        } else {
            console.error('Go-Live stats container not found!');
        }
    }

    function renderHospitals() {
        const hospitalList = document.getElementById('hospital-list');
        const dashboardHospitals = document.getElementById('dashboard-hospitals');
        
        if (hospitalList) {
            hospitalList.innerHTML = '';
            hospitals.forEach(hospital => {
                hospitalList.appendChild(createHospitalCard(hospital));
            });
        }
        
        if (dashboardHospitals) {
            dashboardHospitals.innerHTML = '';
            hospitals.slice(0, 2).forEach(hospital => {
                dashboardHospitals.appendChild(createHospitalCard(hospital));
            });
        }
        
        document.querySelectorAll('.save-btn').forEach(button => {
            button.addEventListener('click', handleSaveItem);
        });
    }

    function createHospitalCard(hospital) {
        const card = document.createElement('div');
        card.className = 'hospital-card';
        card.innerHTML = `
            <div class="premium-lock" title="Premium feature">
                <i class="fas fa-lock"></i>
            </div>
            <h3><i class="fas fa-hospital"></i> ${hospital.name}</h3>
            <div class="hospital-meta">
                <span><i class="fas fa-code-branch"></i> ${hospital.version}</span>
                <span><i class="fas fa-calendar-alt"></i> Go-Live: ${hospital.goLiveDate}</span>
                <span><i class="fas fa-users"></i> Team: ${hospital.epicTeamSize}</span>
            </div>
            <p>${hospital.notes}</p>
            <div class="module-list">
                ${hospital.modules.map(module => `<span class="module-tag">${module}</span>`).join('')}
            </div>
            <div class="hospital-contact">
                <p><strong><i class="fas fa-user-tie"></i> ${hospital.contact.role}:</strong> ${hospital.contact.name}</p>
                <p><strong><i class="fas fa-envelope"></i> Email:</strong> ${hospital.contact.email}</p>
                <p><strong><i class="fas fa-phone"></i> Phone:</strong> ${hospital.contact.phone}</p>
                <p><strong><i class="fas fa-chalkboard-teacher"></i> Training Rooms:</strong> ${hospital.trainingRooms}</p>
                <p><strong><i class="fas fa-chart-line"></i> Success Rate:</strong> ${hospital.stats.goLiveSuccess}%</p>
            </div>
            <button class="btn btn-primary">View Details</button>
            <button class="btn btn-outline save-btn" data-id="hosp-${hospital.id}" data-type="hospital" data-premium="true">
                <i class="fas fa-bookmark"></i> Save
            </button>
        `;
        return card;
    }

    function renderFAQs() {
        const faqContainer = document.querySelector('.faq-container');
        const faqList = document.getElementById('faq-list');
        
        if (faqContainer) {
            faqContainer.innerHTML = '';
            faqs.forEach(faq => {
                faqContainer.appendChild(createFAQItem(faq));
            });
        }
        
        if (faqList) {
            faqList.innerHTML = '';
            faqs.forEach(faq => {
                faqList.appendChild(createFAQItem(faq));
            });
        }
        
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', function() {
                const answer = this.nextElementSibling;
                answer.classList.toggle('active');
                this.querySelector('span').textContent = answer.classList.contains('active') ? '-' : '+';
            });
        });
        
        document.querySelectorAll('.save-btn').forEach(button => {
            button.addEventListener('click', handleSaveItem);
        });
    }

    function createFAQItem(faq) {
        const faqItem = document.createElement('div');
        faqItem.className = 'faq-item';
        faqItem.innerHTML = `
            <div class="faq-question">${faq.question} <span>+</span></div>
            <div class="faq-answer">
                <p>${faq.answer}</p>
                <div class="faq-meta">
                    <span class="faq-category">${faq.category}</span>
                    <span class="faq-helpful">${faq.helpfulCount} people found this helpful</span>
                </div>
                <button class="btn btn-outline save-btn" data-id="faq-${faq.id}" data-type="faq" data-premium="true">
                    <i class="fas fa-bookmark"></i> Save this answer
                </button>
            </div>
        `;
        return faqItem;
    }

    function handleSaveItem(e) {
        const button = e.currentTarget;
        const isPremiumFeature = button.getAttribute('data-premium') === 'true';
        
        if (isPremiumFeature && !userState.isPremium) {
            showNotification('Upgrade to Premium to save items', 'warning');
            return;
        }
        
        const itemId = button.getAttribute('data-id');
        const itemType = button.getAttribute('data-type');
        
        if (button.classList.contains('saved')) {
            button.classList.remove('saved');
            button.innerHTML = '<i class="fas fa-bookmark"></i> Save';
            removeFromSavedItems(itemId);
            showNotification('Item removed from your saved content.');
        } else {
            button.classList.add('saved');
            button.innerHTML = '<i class="fas fa-check"></i> Saved';
            addToSavedItems(itemId, itemType);
            showNotification('Item saved to your profile!');
        }
    }

    function initSearchFunctionality() {
        const searchBoxes = document.querySelectorAll('.search-box');
        
        searchBoxes.forEach(box => {
            box.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const tabId = e.target.closest('.tab-content')?.id || '';
                
                if (tabId === 'hospitals') {
                    filterHospitals(searchTerm);
                } else if (tabId === 'faq') {
                    filterFAQs(searchTerm);
                } else if (tabId === 'resources') {
                    filterResources(searchTerm);
                } else if (tabId === 'dashboard') {
                    filterAllContent(searchTerm);
                }
            });
        });
    }

    function filterHospitals(searchTerm) {
        const hospitalCards = document.querySelectorAll('#hospital-list .hospital-card');
        
        hospitalCards.forEach(card => {
            const hospitalName = card.querySelector('h3').textContent.toLowerCase();
            const hospitalDetails = card.textContent.toLowerCase();
            
            if (hospitalName.includes(searchTerm) || hospitalDetails.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    function filterFAQs(searchTerm) {
        const faqItems = document.querySelectorAll('.faq-item');
        
        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question').textContent.toLowerCase();
            const answer = item.querySelector('.faq-answer').textContent.toLowerCase();
            
            if (question.includes(searchTerm) || answer.includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function filterResources(searchTerm) {
        const resourceCards = document.querySelectorAll('.resource-card');
        
        resourceCards.forEach(card => {
            const title = card.querySelector('h3').textContent.toLowerCase();
            const description = card.textContent.toLowerCase();
            
            if (title.includes(searchTerm) || description.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    function filterAllContent(searchTerm) {
        const allContent = document.querySelectorAll('.hospital-card, .resource-card, .faq-item');
        
        allContent.forEach(item => {
            const contentText = item.textContent.toLowerCase();
            
            if (contentText.includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function addToSavedItems(itemId, itemType) {
        userState.savedItems.push({
            id: itemId,
            type: itemType,
            savedAt: new Date()
        });
    }

    function removeFromSavedItems(itemId) {
        userState.savedItems = userState.savedItems.filter(item => item.id !== itemId);
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 
                                           type === 'warning' ? 'var(--warning)' : 
                                           type === 'error' ? 'var(--danger)' : 
                                           type === 'info' ? 'var(--info)' :
                                           'var(--epic-purple)';
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 3000);
    }

    // ==================== INITIALIZE APP ====================
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing app...');
        initApp();
    });
</script>
    
    <!-- Only keep one AI chat button -->
    <div id="ai-features-button" style="position: fixed; bottom: 100px; right: 30px; width: 70px; height: 70px; background: linear-gradient(135deg, #FFD700, #D4AF37); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 25px rgba(0,0,0,0.3); z-index: 9999; transition: all 0.3s ease; animation: pulse 2s infinite;">
        <a href="ai-features.html" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; text-decoration: none; color: #333; font-weight: bold; flex-direction: column;">
            <i class="fas fa-robot" style="font-size: 24px; margin-bottom: 5px;"></i>
            <span style="font-size: 10px;">AI Features</span>
        </a>
    </div>
</body>
</html>
