<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic EMR Trainer Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-hospital-user"></i>
                <span>Epic EMR Trainer Assistant</span>
            </div>
            <div class="user-actions">
                <div class="premium-badge" id="premium-status">
                    <i class="fas fa-crown"></i>
                    <span>Free Plan</span>
                </div>
                <button id="login-btn" class="btn btn-primary"><i class="fas fa-user"></i> Trainer Login</button>
            </div>
        </div>
    </header>
    
    <nav>
        <ul class="nav-tabs">
            <li><a href="#dashboard" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#hospitals" class="nav-link"><i class="fas fa-hospital"></i> Hospital Systems</a></li>
            <li><a href="#playground" class="nav-link"><i class="fas fa-gamepad"></i> Playground Navigation</a></li>
            <li><a href="#resources" class="nav-link"><i class="fas fa-book"></i> Resources</a></li>
            <li><a href="#faq" class="nav-link"><i class="fas fa-question-circle"></i> FAQ</a></li>
            <li><a href="#go-live" class="nav-link"><i class="fas fa-rocket"></i> Go-Live Support</a></li>
            <li><a href="#profile" class="nav-link"><i class="fas fa-user"></i> My Profile</a></li>
            <li><a href="#premium" class="nav-link"><i class="fas fa-crown"></i> Premium</a></li>
        </ul>
    </nav>
    
    <main>
        <!-- Dashboard Tab -->
        <section id="dashboard" class="tab-content active">
            <h2>Welcome, Epic Trainer</h2>
            <p class="subtitle">Your central hub for Epic EMR training resources</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search across all hospitals, resources, and FAQs...">
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-hospital"></i>
                    <h3 id="hospital-count">6</h3>
                    <p>Hospital Systems</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-file-alt"></i>
                    <h3>156</h3>
                    <p>Training Resources</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-question-circle"></i>
                    <h3 id="faq-count">12</h3>
                    <p>Answered FAQs</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-sync-alt"></i>
                    <h3>6</h3>
                    <p>System Updates This Month</p>
                </div>
            </div>
            
            <h3>Recently Added Hospitals</h3>
            <div class="hospital-grid" id="dashboard-hospitals">
                <!-- Hospitals will be dynamically rendered here -->
            </div>
            
            <h3>Recent Resources</h3>
            <div class="resource-grid">
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Epic 2023 Upgrade Guide</h3>
                    <div class="resource-meta">
                        <span>PDF Document</span>
                        <span>2.4 MB</span>
                    </div>
                    <p>Complete guide to new features and changes in Epic 2023 version.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="doc-001" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Playground Navigation Video</h3>
                    <div class="resource-meta">
                        <span>Video Tutorial</span>
                        <span>15:32 min</span>
                    </div>
                    <p>Step-by-step guide to setting up and using the Epic playground environment.</p>
                    <button class="btn btn-primary"><i class="fas fa-play-circle"></i> Watch</button>
                    <button class="btn btn-outline save-btn" data-id="doc-002" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
            </div>
        </section>
        
        <!-- Hospitals Tab -->
        <section id="hospitals" class="tab-content">
            <h2>Hospital Systems</h2>
            <p>Comprehensive database of hospital Epic implementations</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search hospital systems...">
            </div>
            
            <div class="hospital-grid" id="hospital-list">
                <!-- Hospitals will be dynamically rendered here -->
            </div>
        </section>
        
        <!-- Playground Navigation Tab -->
        <section id="playground" class="tab-content">
            <h2>Epic Playground Navigation</h2>
            <p>Guidance for using the Epic training environments</p>
            
            <div class="faq-container">
                <!-- FAQs will be dynamically rendered here -->
            </div>
        </section>
        
        <!-- Resources Tab -->
        <section id="resources" class="tab-content">
            <h2>Epic Resources</h2>
            <p>Training materials, guides, and documentation</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search resources...">
            </div>
            
            <button class="btn btn-primary" id="upload-resource-btn"><i class="fas fa-upload"></i> Upload New Resource</button>
            <button class="btn btn-success" onclick="openSimulator()" style="margin-left: 10px;">
                <i class="fas fa-laptop-medical"></i> Training Simulator
            </button>            
            <div class="resource-grid">
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Epic Fundamentals Training Guide</h3>
                    <div class="resource-meta">
                        <span>PDF Document</span>
                        <span>5.2 MB</span>
                    </div>
                    <p>Complete guide to Epic fundamentals for new trainers.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="res-001" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>MyChart Patient Portal Tutorial</h3>
                    <div class="resource-meta">
                        <span>Video</span>
                        <span>22:15 min</span>
                    </div>
                    <p>Detailed walkthrough of MyChart features and patient communication tools.</p>
                    <button class="btn btn-primary"><i class="fas fa-play-circle"></i> Watch</button>
                    <button class="btn btn-outline save-btn" data-id="res-002" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Clinical Documentation Templates</h3>
                    <div class="resource-meta">
                        <span>ZIP File</span>
                        <span>3.7 MB</span>
                    </div>
                    <p>Collection of customizable clinical documentation templates.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="res-003" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
                
                <div class="resource-card">
                    <div class="premium-lock" title="Premium feature">
                        <i class="fas fa-lock"></i>
                    </div>
                    <h3>Reporting Workbench Guide</h3>
                    <div class="resource-meta">
                        <span>PDF Document</span>
                        <span>4.1 MB</span>
                    </div>
                    <p>Creating and customizing reports in Epic.</p>
                    <button class="btn btn-primary"><i class="fas fa-download"></i> Download</button>
                    <button class="btn btn-outline save-btn" data-id="res-004" data-type="resource" data-premium="true"><i class="fas fa-bookmark"></i> Save</button>
                </div>
            </div>
        </section>
        
        <!-- FAQ Tab -->
        <section id="faq" class="tab-content">
            <h2>Frequently Asked Questions</h2>
            <p>Find answers to common Epic navigation questions</p>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-box" placeholder="Search FAQs...">
            </div>
            
            <div class="faq-container" id="faq-list">
                <!-- FAQs will be dynamically rendered here -->
            </div>
        </section>
        
        <!-- Enhanced Go-Live Support Section -->
<section id="go-live" class="tab-content">
    <div class="go-live-header">
        <h2><i class="fas fa-rocket"></i> Epic Go-Live Command Center</h2>
        <p class="subtitle">Complete toolkit for successful Epic implementations</p>
    </div>
    
    <!-- Live Status Dashboard -->
    <div class="live-status-dashboard">
        <h3><i class="fas fa-broadcast-tower"></i> Live System Status</h3>
        <div class="status-grid">
            <div class="status-card status-operational">
                <div class="status-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="status-info">
                    <h4>EPIC EHR System</h4>
                    <p>Operational - All modules online</p>
                    <small>Last updated: Just now</small>
                </div>
            </div>
            <div class="status-card status-warning">
                <div class="status-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="status-info">
                    <h4>Billing Module</h4>
                    <p>Scheduled maintenance: 10-11 AM</p>
                    <small>Impact: Medium</small>
                </div>
            </div>
            <div class="status-card status-operational">
                <div class="status-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="status-info">
                    <h4>Patient Portal</h4>
                    <p>Operational - Normal response times</p>
                    <small>Users online: 2,457</small>
                </div>
            </div>
            <div class="status-card status-operational">
                <div class="status-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="status-info">
                    <h4>Support Center</h4>
                    <p>24/7 Active - All teams staffed</p>
                    <small>Calls in queue: 3</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Go-Live Phases -->
    <h3><i class="fas fa-project-diagram"></i> Go-Live Implementation Phases</h3>
    <div class="phase-timeline">
        <div class="phase-phase">
            <div class="phase-number">1</div>
            <div class="phase-content">
                <h4><i class="fas fa-clipboard-check"></i> Preparation (D-30 to D-7)</h4>
                <ul>
                    <li><strong>Command Center Setup:</strong> Physical space, technology, staffing</li>
                    <li><strong>Training Completion:</strong> 100% of end-users trained</li>
                    <li><strong>System Validation:</strong> Full dress rehearsal</li>
                    <li><strong>Communication Plan:</strong> Stakeholder updates ready</li>
                </ul>
                <button class="btn btn-primary phase-btn"><i class="fas fa-download"></i> Download Checklist</button>
            </div>
        </div>
        
        <div class="phase-phase">
            <div class="phase-number">2</div>
            <div class="phase-content">
                <h4><i class="fas fa-bullhorn"></i> Go-Live Day (D-0)</h4>
                <ul>
                    <li><strong>Command Center Active:</strong> 24/7 monitoring begins</li>
                    <li><strong>Real-time Issue Tracking:</strong> Live dashboard updates</li>
                    <li><strong>Leadership Updates:</strong> Hourly briefings</li>
                    <li><strong>At-the-Elbow Support:</strong> All clinical areas covered</li>
                </ul>
                <button class="btn btn-primary phase-btn"><i class="fas fa-tv"></i> View Live Dashboard</button>
            </div>
        </div>
        
        <div class="phase-phase">
            <div class="phase-number">3</div>
            <div class="phase-content">
                <h4><i class="fas fa-headset"></i> Hypercare (D+1 to D+14)</h4>
                <ul>
                    <li><strong>Intensive Support:</strong> 24/7 coverage continues</li>
                    <li><strong>Issue Resolution:</strong> Priority 1 within 1 hour</li>
                    <li><strong>Performance Monitoring:</strong> System metrics tracked</li>
                    <li><strong>User Feedback:</strong> Daily satisfaction surveys</li>
                </ul>
                <button class="btn btn-primary phase-btn"><i class="fas fa-chart-line"></i> View Metrics</button>
            </div>
        </div>
    </div>
    
    <!-- Go-Live FAQ Section -->
    <h3><i class="fas fa-question-circle"></i> Go-Live Frequently Asked Questions</h3>
    <div class="faq-grid">
        <div class="faq-category">
            <h4><i class="fas fa-users"></i> Staffing & Planning</h4>
            <div class="faq-item">
                <div class="faq-question">How many support staff do we need? <span>+</span></div>
                <div class="faq-answer">
                    <p><strong>Industry standard ratios:</strong></p>
                    <ul>
                        <li><strong>Tier 1 (At-the-elbow):</strong> 1:50 (2 per 100 users)</li>
                        <li><strong>Tier 2 (Command Center):</strong> 1:100 (1 per 100 users)</li>
                        <li><strong>Tier 3 (Analyst/Builder):</strong> 1:200 (0.5 per 100 users)</li>
                    </ul>
                    <p><em>Note:</em> Increase ratios for ED, OR, ICU (1:25 recommended).</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">What's the command center setup checklist? <span>+</span></div>
                <div class="faq-answer">
                    <p><strong>Essential Command Center Requirements:</strong></p>
                    <ul>
                        <li><strong>Physical Space:</strong> Large room with multiple work areas</li>
                        <li><strong>Technology:</strong> Multiple large displays, dedicated phones</li>
                        <li><strong>Staffing:</strong> Clear roles, shift schedules, escalation paths</li>
                        <li><strong>Communication:</strong> Direct lines to leadership, status boards</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="faq-category">
            <h4><i class="fas fa-chart-line"></i> Metrics & Monitoring</h4>
            <div class="faq-item">
                <div class="faq-question">What metrics should we track during go-live? <span>+</span></div>
                <div class="faq-answer">
                    <p><strong>Critical Go-Live Metrics:</strong></p>
                    <ul>
                        <li><strong>Ticket Volume:</strong> Total and by priority level</li>
                        <li><strong>Resolution Time:</strong> Average time to close tickets</li>
                        <li><strong>First Call Resolution:</strong> Percentage resolved at Tier 1</li>
                        <li><strong>System Performance:</strong> Downtime, response times</li>
                        <li><strong>User Satisfaction:</strong> Real-time feedback scores</li>
                    </ul>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">What's the difference between Hypercare and Sustainment? <span>+</span></div>
                <div class="faq-answer">
                    <p><strong>Hypercare (Days 1-14):</strong></p>
                    <ul>
                        <li>24/7 support coverage</li>
                        <li>At-the-elbow support in all areas</li>
                        <li>Leadership updates every 2-4 hours</li>
                        <li>Focus: Immediate issue resolution</li>
                    </ul>
                    <p><strong>Sustainment (Day 15+):</strong></p>
                    <ul>
                        <li>Normal business hours support</li>
                        <li>Scheduled optimization sessions</li>
                        <li>Monthly metrics reporting</li>
                        <li>Focus: Optimization and training</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="faq-category">
            <h4><i class="fas fa-user-md"></i> Clinical Support</h4>
            <div class="faq-item">
                <div class="faq-question">How do we handle physician resistance? <span>+</span></div>
                <div class="faq-answer">
                    <p><strong>Physician Engagement Strategies:</strong></p>
                    <ul>
                        <li><strong>Physician Champions:</strong> Identify and empower early adopters</li>
                        <li><strong>Specialty Training:</strong> Custom sessions for each department</li>
                        <li><strong>Just-in-Time Support:</strong> Trainers available in clinical areas</li>
                        <li><strong>Efficiency Tools:</strong> Highlight SmartPhrases, SmartTools</li>
                        <li><strong>Quick Wins:</strong> Demonstrate immediate benefits in Week 1</li>
                    </ul>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">What are critical success factors for ED/OR/ICU? <span>+</span></div>
                <div class="faq-answer">
                    <p><strong>High-Acacity Area Requirements:</strong></p>
                    <ul>
                        <li><strong>Higher Staffing Ratios:</strong> 1:25 for ED/OR/ICU</li>
                        <li><strong>Specialized Training:</strong> Scenario-based for emergencies</li>
                        <li><strong>Downtime Procedures:</strong> Clear paper backup processes</li>
                        <li><strong>Physician Super Users:</strong> Dedicated physician support</li>
                        <li><strong>Real-time Monitoring:</strong> Constant system performance checks</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Support Contacts -->
    <div class="support-contacts">
        <h3><i class="fas fa-headset"></i> 24/7 Support Contacts</h3>
        <div class="contact-grid">
            <div class="contact-card">
                <div class="contact-icon">
                    <i class="fas fa-phone-alt"></i>
                </div>
                <div class="contact-info">
                    <h4>Command Center</h4>
                    <p class="contact-number">(555) 123-4567</p>
                    <p class="contact-hours">24/7 - Priority 1-3 Issues</p>
                </div>
            </div>
            
            <div class="contact-card">
                <div class="contact-icon">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="contact-info">
                    <h4>Physician Support</h4>
                    <p class="contact-number">(555) 234-5678</p>
                    <p class="contact-hours">6 AM - 10 PM Daily</p>
                </div>
            </div>
            
            <div class="contact-card">
                <div class="contact-icon">
                    <i class="fas fa-user-nurse"></i>
                </div>
                <div class="contact-info">
                    <h4>Nursing Support</h4>
                    <p class="contact-number">(555) 345-6789</p>
                    <p class="contact-hours">24/7 - All Units</p>
                </div>
            </div>
            
            <div class="contact-card">
                <div class="contact-icon">
                    <i class="fas fa-clinic-medical"></i>
                </div>
                <div class="contact-info">
                    <h4>Ambulatory Support</h4>
                    <p class="contact-number">(555) 456-7890</p>
                    <p class="contact-hours">7 AM - 7 PM Weekdays</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Resources -->
    <h3><i class="fas fa-download"></i> Quick Resources</h3>
    <div class="resource-grid">
        <div class="resource-card">
            <div class="resource-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <h4>Go-Live Checklist</h4>
            <p>120-item comprehensive checklist with timelines</p>
            <button class="btn btn-primary"><i class="fas fa-download"></i> Download Excel</button>
        </div>
        
        <div class="resource-card">
            <div class="resource-icon">
                <i class="fas fa-building"></i>
            </div>
            <h4>Command Center Guide</h4>
            <p>Step-by-step setup guide with floor plans</p>
            <button class="btn btn-primary"><i class="fas fa-download"></i> Download PDF</button>
        </div>
        
        <div class="resource-card">
            <div class="resource-icon">
                <i class="fas fa-calculator"></i>
            </div>
            <h4>Staffing Calculator</h4>
            <p>Interactive tool to calculate support needs</p>
            <button class="btn btn-primary"><i class="fas fa-external-link-alt"></i> Open Tool</button>
        </div>
        
        <div class="resource-card">
            <div class="resource-icon">
                <i class="fas fa-chart-bar"></i>
            </div>
            <h4>Metrics Dashboard</h4>
            <p>Template for tracking go-live performance</p>
            <button class="btn btn-primary"><i class="fas fa-download"></i> Download Template</button>
        </div>
    </div>
</section>

        <!-- Profile Tab -->
        <section id="profile" class="tab-content">
            <div class="profile-header">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div>
                    <h2>John Smith</h2>
                    <p>Epic Certified Trainer</p>
                    <p>Mercy General Hospital</p>
                    <div class="premium-badge">
                        <i class="fas fa-crown"></i>
                        <span>Free Plan</span>
                    </div>
                </div>
            </div>
            
            <div class="premium-upgrade">
                <h2><i class="fas fa-crown"></i> Upgrade to Premium</h2>
                <p>Unlock the ability to save hospitals, resources, and FAQs to your personal profile</p>
                <button class="btn btn-premium pulse" id="upgrade-btn"><i class="fas fa-star"></i> Upgrade Now</button>
                <button class="btn btn-info" onclick="openStaffingCalculator()" style="margin-left: 10px;">
                    <i class="fas fa-calculator"></i> Staffing Calculator
                </button>                
                <div class="premium-features">
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save hospitals to your profile</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save resources and documentation</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save FAQ answers for quick reference</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Add personal notes to saved items</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Access your saved content from any device</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Organize content with custom categories</span>
                    </div>
                </div>
            </div>
            
            <div class="profile-tabs">
                <div class="profile-tab active" data-tab="saved">Saved Content</div>
                <div class="profile-tab" data-tab="uploads">My Uploads</div>
                <div class="profile-tab" data-tab="questions">My Questions</div>
                <div class="profile-tab" data-tab="settings">Settings</div>
            </div>
            
            <div class="profile-content">
                <div class="profile-tab-content active" id="saved-tab">
                    <div class="premium-upgrade">
                        <h2><i class="fas fa-lock"></i> Premium Feature</h2>
                        <p>Upgrade to Premium to save hospitals, resources, and FAQs to your personal profile</p>
                        <button class="btn btn-premium" id="upgrade-btn-2"><i class="fas fa-crown"></i> Upgrade to Premium</button>
                    </div>
                </div>
                
                <div class="profile-tab-content" id="uploads-tab">
                    <h3>My Uploaded Resources</h3>
                    <p>You haven't uploaded any resources yet.</p>
                    <button class="btn btn-primary" id="upload-from-profile-btn"><i class="fas fa-upload"></i> Upload Your First Resource</button>
                </div>
                
                <div class="profile-tab-content" id="questions-tab">
                    <h3>My Questions</h3>
                    <p>You haven't asked any questions yet.</p>
                </div>
                
                <div class="profile-tab-content" id="settings-tab">
                    <h3>Account Settings</h3>
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" class="form-control" id="name" value="John Smith">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" class="form-control" id="email" value="john.smith@mercygeneral.org">
                    </div>
                    <div class="form-group">
                        <label for="hospital">Primary Hospital</label>
                        <select class="form-control" id="hospital">
                            <option value="mercy">Mercy General Hospital</option>
                            <option value="mayo">Mayo Clinic</option>
                            <option value="hopkins">Johns Hopkins Hospital</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="certification">Epic Certification</label>
                        <input type="text" class="form-control" id="certification" value="Epic Physician Trainer Certified">
                    </div>
                    <button class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </section>
        
        <!-- Premium Tab -->
        <section id="premium" class="tab-content">
            <h2><i class="fas fa-crown"></i> Epic Trainer Premium</h2>
            <p class="subtitle">Upgrade your experience with powerful profile features</p>
            
            <div class="premium-upgrade">
                <h2>Unlock Premium Features</h2>
                <p>Get access to personalized profile features designed for Epic trainers</p>
                
                <div class="premium-features">
                    <div class="premium-feature">
                        <i class="fas fa-bookmark"></i>
                        <span>Save hospitals, resources, and FAQs to your profile</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-sticky-note"></i>
                        <span>Add personal notes to saved content</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-folder"></i>
                        <span>Organize content with custom categories</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Access your profile from any device</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-search"></i>
                        <span>Save search history and preferences</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-cloud-download-alt"></i>
                        <span>Download resources for offline access</span>
                    </div>
                </div>
            </div>
            
            <h3>Choose Your Plan</h3>
            <div class="pricing-plans">
                <div class="pricing-plan">
                    <h4>Free</h4>
                    <div class="plan-price">$0<span>/month</span></div>
                    <ul class="plan-features">
                        <li><i class="fas fa-check"></i> Access to all hospitals</li>
                        <li><i class="fas fa-check"></i> Browse resources</li>
                        <li><i class="fas fa-check"></i> Read FAQs</li>
                        <li><i class="fas fa-times"></i> <span class="text-muted">Save to profile</span></li>
                        <li><i class="fas fa-times"></i> <span class="text-muted">Personal notes</span></li>
                        <li><i class="fas fa-times"></i> <span class="text-muted">Offline access</span></li>
                    </ul>
                    <button class="btn btn-outline" disabled>Current Plan</button>
                </div>
                
                <div class="pricing-plan popular">
                    <div class="popular-badge">MOST POPULAR</div>
                    <h4>Premium Monthly</h4>
                    <div class="plan-price">$9.99<span>/month</span></div>
                    <ul class="plan-features">
                        <li><i class="fas fa-check"></i> Everything in Free</li>
                        <li><i class="fas fa-check"></i> Save unlimited items</li>
                        <li><i class="fas fa-check"></i> Add personal notes</li>
                        <li><i class="fas fa-check"></i> Organize with categories</li>
                        <li><i class="fas fa-check"></i> Search history</li>
                        <li><i class="fas fa-check"></i> Offline access</li>
                    </ul>
                    <button class="btn btn-premium"><i class="fas fa-crown"></i> Upgrade Now</button>
                </div>
                
                <div class="pricing-plan">
                    <h4>Premium Annual</h4>
                    <div class="plan-price">$99.99<span>/year</span></div>
                    <div class="small">Save $20 compared to monthly</div>
                    <ul class="plan-features">
                        <li><i class="fas fa-check"></i> Everything in Free</li>
                        <li><i class="fas fa-check"></i> Save unlimited items</li>
                        <li><i class="fas fa-check"></i> Add personal notes</li>
                        <li><i class="fas fa-check"></i> Organize with categories</li>
                        <li><i class="fas fa-check"></i> Search history</li>
                        <li><i class="fas fa-check"></i> Offline access</li>
                    </ul>
                    <button class="btn btn-premium"><i class="fas fa-crown"></i> Upgrade Now</button>
                </div>
            </div>
            
            <div class="premium-upgrade">
                <h2>Frequently Asked Questions</h2>
                
                <div class="faq-item">
                    <div class="faq-question">What payment methods do you accept? <span>+</span></div>
                    <div class="faq-answer">
                        <p>We accept all major credit cards, PayPal, and Apple Pay for your convenience.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Can I cancel my subscription anytime? <span>+</span></div>
                    <div class="faq-answer">
                        <p>Yes, you can cancel your subscription at any time. Your premium features will remain active until the end of your billing period.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Will I lose my saved data if I cancel? <span>+</span></div>
                    <div class="faq-answer">
                        <p>Your saved data will be preserved for 6 months after cancellation. If you resubscribe within that time, you'll regain access to all your saved content.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Is there a free trial? <span>+</span></div>
                    <div class="faq-answer">
                        <p>Yes, we offer a 7-day free trial for new premium subscribers. No credit card required to start the trial.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <footer>
        <p>Epic EMR Trainer Assistant | For training purposes only</p>
        <p>This application is not affiliated with Epic Systems Corporation</p>
        <p>Â© 2023 Epic EMR Trainer Assistant. All rights reserved.</p>
    </footer>

    <!-- MODALS GO HERE (NOT BEFORE <body>) -->
    <!-- Upload Resource Modal -->
    <div class="modal-overlay" id="upload-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>Upload Epic Documentation</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="file-upload" id="file-upload-area">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Click to select a file or drag and drop here</p>
                <p class="small">Maximum file size: 50MB</p>
                <input type="file" id="file-input" style="display: none;">
            </div>
            
            <div id="file-info" style="display: none;">
                <h4>Selected file: <span id="file-name"></span></h4>
                <p>Size: <span id="file-size"></span></p>
            </div>
            
            <div class="form-group">
                <label for="doc-title">Document Title</label>
                <input type="text" class="form-control" id="doc-title" placeholder="Enter a descriptive title">
            </div>
            
            <div class="form-group">
                <label for="doc-description">Description</label>
                <textarea class="form-control" id="doc-description" placeholder="Describe what this document contains"></textarea>
            </div>
            
            <div class="form-group">
                <label for="doc-category">Category</label>
                <select class="form-control" id="doc-category">
                    <option value="">Select a category</option>
                    <option value="user-guide">User Guide</option>
                    <option value="training-manual">Training Manual</option>
                    <option value="release-notes">Release Notes</option>
                    <option value="cheat-sheet">Cheat Sheet</option>
                    <option value="presentation">Presentation</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="doc-tags">Tags (comma separated)</label>
                <input type="text" class="form-control" id="doc-tags" placeholder="e.g., billing, clinical, reports">
            </div>
            
            <div class="form-group">
                <label for="doc-hospital">Related Hospital (optional)</label>
                <select class="form-control" id="doc-hospital">
                    <option value="">Select a hospital</option>
                    <option value="mercy">Mercy General Hospital</option>
                    <option value="mayo">Mayo Clinic</option>
                    <option value="hopkins">Johns Hopkins Hospital</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="checkbox">
                    <input type="checkbox" id="doc-public"> Make this document public for all users
                </label>
            </div>
            
            <button class="btn btn-primary" id="start-upload-btn" disabled><i class="fas fa-upload"></i> Upload Document</button>
        </div>
    </div>
    
    <!-- Upgrade Modal -->
    <div class="modal-overlay" id="upgrade-modal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-crown"></i> Upgrade to Premium</h2>
                <button class="modal-close">&times;</button>
            </div>
            
            <div class="premium-upgrade">
                <h3>Start Your 7-Day Free Trial</h3>
                <p>Get immediate access to all premium features</p>
                
                <div class="plan-price">$9.99<span>/month after trial</span></div>
                
                <div class="premium-features">
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save hospitals to your profile</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save resources and documentation</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Save FAQ answers for quick reference</span>
                    </div>
                    <div class="premium-feature">
                        <i class="fas fa-check-circle"></i>
                        <span>Add personal notes to saved items</span>
                    </div>
                </div>
                
                <button class="btn btn-premium" id="start-trial-btn"><i class="fas fa-play-circle"></i> Start Free Trial</button>
                <p class="small">No credit card required. Cancel anytime.</p>
            </div>
        </div>
    </div>

    <script>
    // ==================== API URL HELPER ====================
    function getApiUrl(endpoint) {
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            return `http://localhost:3000/${endpoint}`;
        }
        return `/.netlify/functions/${endpoint}`;
    }
    
    // ==================== ORIGINAL APP CORE ====================
    const userState = {
        isPremium: false,
        savedItems: [],
        currentUser: null
    };

    // Sample data - MAKE SURE THIS IS DEFINED
        // Sample data - COMPLETE VERSION
    const hospitals = [
    { 
        id: 1, 
        name: "Mayo Clinic", 
        version: "Epic 2022", 
        modules: ["Radiant", "Beaker", "OpTime", "Research", "Cadence", "Prelude"], 
        notes: "Uses special billing modules and research functionality. Strong focus on oncology and cardiology.",
        lastUpdated: "2023-10-15",
        goLiveDate: "2022-06-15",
        epicTeamSize: 58,
        trainingRooms: 12,
        supportModel: "24/7 Tier 1-3 with specialty pods",
        specialtyAreas: ["Oncology", "Cardiology", "Transplant", "Neurology"],
        contact: {
            name: "Dr. Sarah Johnson",
            email: "sjohnson@mayoclinic.org",
            phone: "(555) 123-4567",
            role: "Epic Principal Trainer"
        },
        epicContacts: [
            { role: "Principal Trainer", name: "Sarah Johnson", email: "sjohnson@mayoclinic.org", phone: "(555) 123-4567" },
            { role: "Analyst Lead", name: "Michael Roberts", email: "mroberts@mayoclinic.org", phone: "(555) 123-4568" },
            { role: "Physician Builder", name: "Dr. James Wilson", email: "jwilson@mayoclinic.org", phone: "(555) 123-4569" }
        ],
        stats: {
            usersTrained: 1250,
            goLiveSuccess: 98,
            supportTickets: 45,
            avgResolutionTime: "2.3 hours"
        }
    },
    { 
        id: 2, 
        name: "Johns Hopkins Hospital", 
        version: "Epic 2023", 
        modules: ["Care Everywhere", "MyChart", "Healthy Planet", "Research", "Cupid"], 
        notes: "Research-focused customization with specialized modules. Early adopter of new Epic features.",
        lastUpdated: "2023-11-05",
        goLiveDate: "2023-03-22",
        epicTeamSize: 42,
        trainingRooms: 8,
        supportModel: "Dedicated specialty support teams",
        specialtyAreas: ["Research", "Pediatrics", "Genomics", "Telemedicine"],
        contact: {
            name: "Michael Chen",
            email: "mchen@jh.edu",
            phone: "(555) 234-5678",
            role: "Epic Training Director"
        },
        epicContacts: [
            { role: "Training Director", name: "Michael Chen", email: "mchen@jh.edu", phone: "(555) 234-5678" },
            { role: "Research Lead", name: "Dr. Amanda Lee", email: "alee@jh.edu", phone: "(555) 234-5679" },
            { role: "Clinical Informatics", name: "Robert Kim", email: "rkim@jh.edu", phone: "(555) 234-5680" }
        ],
        stats: {
            usersTrained: 980,
            goLiveSuccess: 96,
            supportTickets: 32,
            avgResolutionTime: "3.1 hours"
        }
    },
    { 
        id: 3, 
        name: "Massachusetts General Hospital", 
        version: "Epic 2022", 
        modules: ["Cadence", "Prelude", "Grand Central", "Beaker", "Radiant"], 
        notes: "Integrated with Partners healthcare system. Strong emphasis on patient portal implementation.",
        lastUpdated: "2023-09-22",
        goLiveDate: "2021-11-30",
        epicTeamSize: 67,
        trainingRooms: 15,
        supportModel: "Hub-and-spoke with central command",
        specialtyAreas: ["Emergency Medicine", "Psychiatry", "Rheumatology", "Orthopedics"],
        contact: {
            name: "Emily Rodriguez",
            email: "erodriguez@mgh.harvard.edu",
            phone: "(555) 345-6789",
            role: "Epic Program Manager"
        },
        epicContacts: [
            { role: "Program Manager", name: "Emily Rodriguez", email: "erodriguez@mgh.harvard.edu", phone: "(555) 345-6789" },
            { role: "Emergency Med Lead", name: "Dr. David Park", email: "dpark@mgh.harvard.edu", phone: "(555) 345-6790" },
            { role: "MyChart Specialist", name: "Jennifer Wong", email: "jwong@mgh.harvard.edu", phone: "(555) 345-6791" }
        ],
        stats: {
            usersTrained: 2100,
            goLiveSuccess: 99,
            supportTickets: 67,
            avgResolutionTime: "1.8 hours"
        }
    },
    { 
        id: 4, 
        name: "Cleveland Clinic", 
        version: "Epic 2023", 
        modules: ["Hyperspace", "Cupid", "Bones", "MyChart", "Healthy Planet"], 
        notes: "Cardiology specialty focus with custom modules. Strong telemedicine integration.",
        lastUpdated: "2023-11-12",
        goLiveDate: "2023-01-10",
        epicTeamSize: 53,
        trainingRooms: 10,
        supportModel: "Cardiology-focused tiered support",
        specialtyAreas: ["Cardiology", "Cardiac Surgery", "Vascular", "Tele-ICU"],
        contact: {
            name: "Robert Williams",
            email: "rwilliams@clevelandclinic.org",
            phone: "(555) 456-7890",
            role: "Cardiology Epic Lead"
        },
        epicContacts: [
            { role: "Cardiology Lead", name: "Robert Williams", email: "rwilliams@clevelandclinic.org", phone: "(555) 456-7890" },
            { role: "Surgery Analyst", name: "Dr. Thomas Brown", email: "tbrown@clevelandclinic.org", phone: "(555) 456-7891" },
            { role: "Telemedicine Lead", name: "Susan Davis", email: "sdavis@clevelandclinic.org", phone: "(555) 456-7892" }
        ],
        stats: {
            usersTrained: 1450,
            goLiveSuccess: 97,
            supportTickets: 41,
            avgResolutionTime: "2.5 hours"
        }
    },
    { 
        id: 5, 
        name: "UCSF Medical Center", 
        version: "Epic 2022", 
        modules: ["Beaker", "Willow", "Phoenix", "Radiant", "Care Everywhere"], 
        notes: "Academic medical center configuration with research emphasis. Strong pediatric specialization.",
        lastUpdated: "2023-08-30",
        goLiveDate: "2022-04-18",
        epicTeamSize: 49,
        trainingRooms: 9,
        supportModel: "Academic research integrated support",
        specialtyAreas: ["Pediatrics", "Neonatology", "Cancer Research", "Infectious Disease"],
        contact: {
            name: "Jennifer Lee",
            email: "jlee@ucsf.edu",
            phone: "(555) 567-8901",
            role: "Academic Epic Director"
        },
        epicContacts: [
            { role: "Academic Director", name: "Jennifer Lee", email: "jlee@ucsf.edu", phone: "(555) 567-8901" },
            { role: "Research Coordinator", name: "Dr. Mark Taylor", email: "mtaylor@ucsf.edu", phone: "(555) 567-8902" },
            { role: "Pediatrics Lead", name: "Lisa Martinez", email: "lmartinez@ucsf.edu", phone: "(555) 567-8903" }
        ],
        stats: {
            usersTrained: 1100,
            goLiveSuccess: 95,
            supportTickets: 38,
            avgResolutionTime: "2.8 hours"
        }
    },
    { 
        id: 6, 
        name: "NewYork-Presbyterian Hospital", 
        version: "Epic 2023", 
        modules: ["Healthy Planet", "MyChart", "Care Companion", "Cadence", "Prelude"], 
        notes: "Large multi-campus system with unified Epic implementation. Strong population health focus.",
        lastUpdated: "2023-10-28",
        goLiveDate: "2023-02-14",
        epicTeamSize: 72,
        trainingRooms: 18,
        supportModel: "Multi-campus command center model",
        specialtyAreas: ["Population Health", "Multispecialty", "Ambulatory Care", "Behavioral Health"],
        contact: {
            name: "David Kim",
            email: "dkim@nyp.org",
            phone: "(555) 678-9012",
            role: "Enterprise Epic Manager"
        },
        epicContacts: [
            { role: "Enterprise Manager", name: "David Kim", email: "dkim@nyp.org", phone: "(555) 678-9012" },
            { role: "Population Health Lead", name: "Dr. Rachel Green", email: "rgreen@nyp.org", phone: "(555) 678-9013" },
            { role: "Ambulatory Director", name: "Kevin White", email: "kwhite@nyp.org", phone: "(555) 678-9014" }
        ],
        stats: {
            usersTrained: 2800,
            goLiveSuccess: 99,
            supportTickets: 89,
            avgResolutionTime: "2.1 hours"
        }
    }
];

// US Hospital Database (50+ major hospitals)
const usHospitals = [
    { id: 101, name: "Mayo Clinic - Rochester", city: "Rochester", state: "MN", beds: 2057, epicVersion: "Epic 2023", specialties: ["Oncology", "Cardiology", "Gastroenterology"] },
    { id: 102, name: "Cleveland Clinic", city: "Cleveland", state: "OH", beds: 5460, epicVersion: "Epic 2023", specialties: ["Cardiology", "Urology", "Orthopedics"] },
    { id: 103, name: "Johns Hopkins Hospital", city: "Baltimore", state: "MD", beds: 1129, epicVersion: "Epic 2023", specialties: ["Neurology", "Psychiatry", "ENT"] },
    { id: 104, name: "Massachusetts General Hospital", city: "Boston", state: "MA", beds: 1057, epicVersion: "Epic 2022", specialties: ["Diabetes", "Endocrinology", "Cancer"] },
    { id: 105, name: "UCSF Medical Center", city: "San Francisco", state: "CA", beds: 785, epicVersion: "Epic 2022", specialties: ["Neurology", "Cancer", "Geriatrics"] },
    { id: 106, name: "UCLA Medical Center", city: "Los Angeles", state: "CA", beds: 485, epicVersion: "Epic 2023", specialties: ["Geriatrics", "Neurology", "Urology"] },
    { id: 107, name: "NewYork-Presbyterian Hospital", city: "New York", state: "NY", beds: 2681, epicVersion: "Epic 2023", specialties: ["Cardiology", "Neurology", "Gastroenterology"] },
    { id: 108, name: "Northwestern Memorial Hospital", city: "Chicago", state: "IL", beds: 897, epicVersion: "Epic 2022", specialties: ["Cardiology", "Neurology", "Orthopedics"] },
    { id: 109, name: "University of Michigan Hospitals", city: "Ann Arbor", state: "MI", beds: 1000, epicVersion: "Epic 2023", specialties: ["Cancer", "Cardiology", "Orthopedics"] },
    { id: 110, name: "Stanford Health Care", city: "Stanford", state: "CA", beds: 613, epicVersion: "Epic 2023", specialties: ["Cancer", "Cardiology", "Neurology"] },
    { id: 201, name: "Barnes-Jewish Hospital", city: "St. Louis", state: "MO", beds: 1258, epicVersion: "Epic 2022", specialties: ["Cancer", "Cardiology", "Transplant"] },
    { id: 202, name: "UT Southwestern Medical Center", city: "Dallas", state: "TX", beds: 882, epicVersion: "Epic 2023", specialties: ["Neurology", "Cancer", "Cardiology"] },
    { id: 203, name: "Vanderbilt University Medical Center", city: "Nashville", state: "TN", beds: 1069, epicVersion: "Epic 2023", specialties: ["Cancer", "Cardiology", "Pediatrics"] },
    { id: 204, name: "Duke University Hospital", city: "Durham", state: "NC", beds: 957, epicVersion: "Epic 2023", specialties: ["Cancer", "Cardiology", "Orthopedics"] },
    { id: 205, name: "University of Washington Medical Center", city: "Seattle", state: "WA", beds: 450, epicVersion: "Epic 2022", specialties: ["Cancer", "Rehabilitation", "Transplant"] },
    { id: 301, name: "Boston Children's Hospital", city: "Boston", state: "MA", beds: 404, epicVersion: "Epic 2023", specialties: ["Pediatric Cardiology", "Pediatric Cancer", "Neonatology"] },
    { id: 302, name: "Children's Hospital of Philadelphia", city: "Philadelphia", state: "PA", beds: 546, epicVersion: "Epic 2022", specialties: ["Pediatric Oncology", "Cardiology", "Neonatology"] },
    { id: 401, name: "VA Greater Los Angeles Healthcare", city: "Los Angeles", state: "CA", beds: 1226, epicVersion: "Epic 2022", specialties: ["Mental Health", "Rehabilitation", "Primary Care"] },
    { id: 501, name: "Baptist Health Lexington", city: "Lexington", state: "KY", beds: 383, epicVersion: "Epic 2022", specialties: ["Cardiology", "Orthopedics", "Cancer"] },
    { id: 502, name: "Banner - University Medical Center", city: "Phoenix", state: "AZ", beds: 662, epicVersion: "Epic 2023", specialties: ["Transplant", "Trauma", "Cancer"] },
];    const faqs = [
        { 
            id: 1,
            question: "How do I access the Epic Playground?", 
            answer: "Access to the Epic Playground varies by organization. Typically, you need to connect through your organization's VPN and use a specific URL provided by your Epic team. Some organizations require additional authentication steps or special permissions granted by your Epic coordinator.",
            category: "Access",
            helpfulCount: 24
        },
        { 
            id: 2,
            question: "What's the difference between Hyperspace and Hyperdrive?", 
            answer: "Hyperspace is the traditional Epic interface, while Hyperdrive is the newer, web-based version that offers improved performance and customization options. Hyperdrive allows for faster navigation, better mobile compatibility, and more personalized workspace configurations. Most organizations are transitioning to Hyperdrive, but some modules may still require Hyperspace.",
            category: "Navigation",
            helpfulCount: 31
        },
        { 
            id: 3,
            question: "How often does Epic release updates?", 
            answer: "Epic typically releases major updates once a year, with smaller updates and patches throughout the year. Organizations can choose when to implement these updates, but most follow a regular schedule. Major updates usually occur in the spring or fall, with preview environments available 3-4 months before the production upgrade.",
            category: "Updates",
            helpfulCount: 18
        },
        { 
            id: 4,
            question: "How can I customize training for different specialties?", 
            answer: "Epic allows trainers to create specialized training profiles, build custom training environments, and use the Training Wheels feature to guide users through workflows. You can create specialty-specific patient scenarios, develop custom learning paths, and utilize the role-based access configurations to simulate real clinical environments for each specialty.",
            category: "Training",
            helpfulCount: 29
        },
        { 
            id: 5,
            question: "How do I get access to Epic UserWeb?", 
            answer: "Access to Epic UserWeb is typically provided by your organization's Epic coordinator. You'll need to complete required training and request access through proper channels. Most organizations have a process for requesting UserWeb access that may include completing security training, signing access agreements, and having a legitimate business need for the resource.",
            category: "Access",
            helpfulCount: 15
        },
        { 
            id: 6,
            question: "What's the best way to train physicians on Epic?", 
            answer: "Physician training works best when it's specialty-specific, concise, and focused on workflow efficiency. Use real clinical scenarios, emphasize time-saving features like SmartTools and SmartPhrases, and provide just-in-time training resources. Many organizations find success with a combination of classroom training, one-on-one coaching, and specialty-specific tip sheets.",
            category: "Training",
            helpfulCount: 42
        },
        { 
            id: 7,
            question: "What are the critical Go-Live support phases?", 
            answer: "Epic Go-Live typically follows these phases:<br><br><strong>1) Command Center Setup (Day -30):</strong> Physical setup, staffing, equipment<br><strong>2) Dress Rehearsal (Day -7):</strong> Full system test with simulated patients<br><strong>3) Go-Live Day (Day 0):</strong> Live support begins, real patients<br><strong>4) Hypercare (Days 1-14):</strong> 24/7 intensive support<br><strong>5) Sustainment (Day 15+):</strong> Transition to normal operations",
            category: "Go-Live",
            helpfulCount: 0
        },
        { 
            id: 8,
            question: "How many support staff are needed per 100 users?", 
            answer: "Industry standard staffing ratios for Epic Go-Live:<br><br><strong>Tier 1 (At-the-elbow):</strong> 1:50 ratio (2 staff for 100 users)<br><strong>Tier 2 (Command Center):</strong> 1:100 ratio (1 staff for 100 users)<br><strong>Tier 3 (Analyst/Builder):</strong> 1:200 ratio (0.5 staff for 100 users)<br><br><em>Note:</em> These ratios increase for complex specialties like ED, OR, and ICU.",
            category: "Staffing",
            helpfulCount: 0
        },
        { 
            id: 9,
            question: "What metrics should we track during Go-Live?", 
            answer: "Critical Go-Live metrics to monitor:<br><br>â¢ <strong>Ticket Volume:</strong> Total and by priority<br>â¢ <strong>Resolution Time:</strong> Average time to close tickets<br>â¢ <strong>First Call Resolution:</strong> Percentage resolved at Tier 1<br>â¢ <strong>User Satisfaction:</strong> Real-time feedback scores<br>â¢ <strong>System Performance:</strong> Downtime, response times<br>â¢ <strong>Clinical Impact:</strong> Patient safety issues<br><br>Track these on a live dashboard visible to leadership.",
            category: "Metrics",
            helpfulCount: 0
        },
        { 
            id: 10,
            question: "How do we handle physician resistance during Go-Live?", 
            answer: "Strategies for physician adoption:<br><br>1. <strong>Physician Champions:</strong> Identify and empower early adopters<br>2. <strong>Specialty-Specific Training:</strong> Customize for each department<br>3. <strong>Just-in-Time Support:</strong> Have trainers in clinical areas<br>4. <strong>Efficiency Tools:</strong> Emphasize time-saving features (SmartPhrases, SmartTools)<br>5. <strong>Leadership Engagement:</strong> Involve department chairs in planning<br>6. <strong>Quick Wins:</strong> Highlight immediate benefits in first week",
            category: "Change Management",
            helpfulCount: 0
        },
        { 
            id: 11,
            question: "What's the difference between Hypercare and Sustainment?", 
            answer: "<strong>Hypercare (Days 1-14):</strong><br>â¢ 24/7 support coverage<br>â¢ At-the-elbow support in all clinical areas<br>â¢ Command Center with real-time monitoring<br>â¢ Leadership updates every 2-4 hours<br>â¢ Focus: Immediate issue resolution, patient safety<br><br><strong>Sustainment (Day 15+):</strong><br>â¢ Normal business hours support<br>â¢ Help desk with escalation paths<br>â¢ Scheduled optimization sessions<br>â¢ Monthly metrics reporting<br>â¢ Focus: Optimization, training new users",
            category: "Support Models",
            helpfulCount: 0
        },
        { 
            id: 12,
            question: "How do we prepare the Command Center?", 
            answer: "Command Center setup checklist:<br><br><strong>Physical Space:</strong><br>â¢ Large room with multiple work areas<br>â¢ Whiteboards/wall monitors for status<br>â¢ Quiet rooms for sensitive calls<br>â¢ Refreshment area for staff<br><br><strong>Technology:</strong><br>â¢ Dedicated phones and headsets<br>â¢ Multiple large-screen displays<br>â¢ Real-time dashboard software<br>â¢ Secure Wi-Fi and network<br><br><strong>Staffing:</strong><br>â¢ Clear roles and responsibilities<br>â¢ Shift schedules posted<br>â¢ Escalation paths defined<br>â¢ Leadership presence",
            category: "Command Center",
            helpfulCount: 0
        }
    ];

    // ==================== FIXED TAB NAVIGATION ====================
    // Update the createHospitalCard function to include go-live info
function createHospitalCard(hospital) {
    const card = document.createElement('div');
    card.className = 'hospital-card enhanced';
    card.innerHTML = `
        <div class="hospital-badge ${hospital.stats.goLiveSuccess >= 95 ? 'success' : 'warning'}">
            <i class="fas fa-${hospital.stats.goLiveSuccess >= 95 ? 'check-circle' : 'exclamation-triangle'}"></i>
            ${hospital.stats.goLiveSuccess}% Success
        </div>
        
        <div class="premium-lock" title="Premium feature">
            <i class="fas fa-lock"></i>
        </div>
        
        <h3><i class="fas fa-hospital"></i> ${hospital.name}</h3>
        
        <div class="hospital-meta">
            <span><i class="fas fa-code-branch"></i> ${hospital.version}</span>
            <span><i class="fas fa-calendar-alt"></i> Live: ${hospital.goLiveDate}</span>
            <span><i class="fas fa-users"></i> Team: ${hospital.epicTeamSize}</span>
        </div>
        
        <p class="hospital-description">${hospital.notes}</p>
        
        <div class="hospital-stats">
            <div class="stat-item">
                <div class="stat-label">Users Trained</div>
                <div class="stat-value">${hospital.stats.usersTrained.toLocaleString()}</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Avg Resolution</div>
                <div class="stat-value">${hospital.stats.avgResolutionTime}</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Open Tickets</div>
                <div class="stat-value">${hospital.stats.supportTickets}</div>
            </div>
        </div>
        
        <div class="module-list">
            ${hospital.modules.map(module => `<span class="module-tag">${module}</span>`).join('')}
        </div>
        
        <div class="specialty-areas">
            <strong><i class="fas fa-stethoscope"></i> Specialties:</strong>
            ${hospital.specialtyAreas.map(area => `<span class="specialty-tag">${area}</span>`).join('')}
        </div>
        
        <div class="hospital-contact">
            <div class="contact-header">
                <i class="fas fa-user-tie"></i>
                <strong>Epic Team Contacts</strong>
            </div>
            ${hospital.epicContacts.map(contact => `
                <div class="contact-person">
                    <span class="contact-role">${contact.role}:</span>
                    <span class="contact-name">${contact.name}</span>
                    <span class="contact-phone">${contact.phone}</span>
                </div>
            `).join('')}
        </div>
        
        <div class="hospital-actions">
            <button class="btn btn-primary" onclick="viewHospitalDetails(${hospital.id})">
                <i class="fas fa-eye"></i> View Details
            </button>
            <button class="btn btn-outline save-btn" data-id="hosp-${hospital.id}" data-type="hospital" data-premium="true">
                <i class="fas fa-bookmark"></i> Save Hospital
            </button>
            <button class="btn btn-info" onclick="showGoLiveTips(${hospital.id})">
                <i class="fas fa-lightbulb"></i> Go-Live Tips
            </button>
        </div>
        
        <div class="support-model">
            <strong><i class="fas fa-headset"></i> Support Model:</strong> ${hospital.supportModel}
        </div>
    `;
    return card;
}

// Function to view hospital details
function viewHospitalDetails(hospitalId) {
    const hospital = hospitals.find(h => h.id === hospitalId);
    if (hospital) {
        alert(`Hospital Details: ${hospital.name}\n\n` +
              `Version: ${hospital.version}\n` +
              `Go-Live Date: ${hospital.goLiveDate}\n` +
              `Team Size: ${hospital.epicTeamSize}\n` +
              `Training Rooms: ${hospital.trainingRooms}\n` +
              `Success Rate: ${hospital.stats.goLiveSuccess}%\n` +
              `Users Trained: ${hospital.stats.usersTrained.toLocaleString()}\n` +
              `Support Model: ${hospital.supportModel}\n\n` +
              `Primary Contact: ${hospital.contact.name}\n` +
              `Email: ${hospital.contact.email}\n` +
              `Phone: ${hospital.contact.phone}`);
    }
}

// Function to show go-live tips
function showGoLiveTips(hospitalId) {
    const hospital = hospitals.find(h => h.id === hospitalId);
    if (hospital) {
        const tips = [
            `ð ${hospital.name} successfully implemented Epic with a ${hospital.stats.goLiveSuccess}% success rate.`,
            `ð Key metric: Average resolution time was ${hospital.stats.avgResolutionTime}.`,
            `ð¥ Staffing model: ${hospital.supportModel}`,
            `ð¯ Training approach: ${hospital.trainingRooms} dedicated training rooms with specialty-focused sessions.`,
            `ð¡ Pro tip: ${hospital.specialtyAreas[0]} department required additional at-the-elbow support (1:25 ratio).`,
            `ð Success factor: Weekly leadership briefings and real-time dashboard updates.`
        ].join('\n\n');
        
        alert(`Go-Live Success Tips for ${hospital.name}:\n\n${tips}`);
    }
}

// Update the renderHospitals function
function renderHospitals() {
    const hospitalList = document.getElementById('hospital-list');
    const dashboardHospitals = document.getElementById('dashboard-hospitals');
    
    if (hospitalList) {
        hospitalList.innerHTML = '<div class="hospital-filters">' +
            '<button class="filter-btn active" data-filter="all">All Hospitals</button>' +
            '<button class="filter-btn" data-filter="high-success">High Success (>95%)</button>' +
            '<button class="filter-btn" data-filter="recent">Recent Go-Lives</button>' +
            '<button class="filter-btn" data-filter="large-team">Large Teams</button>' +
            '</div><div class="hospital-cards-container"></div>';
        
        const container = hospitalList.querySelector('.hospital-cards-container');
        hospitals.forEach(hospital => {
            container.appendChild(createHospitalCard(hospital));
        });
        
        // Add filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                filterHospitals(this.dataset.filter);
            });
        });
    }
    
    if (dashboardHospitals) {
        dashboardHospitals.innerHTML = '';
        // Show top 3 hospitals by success rate
        const topHospitals = [...hospitals]
            .sort((a, b) => b.stats.goLiveSuccess - a.stats.goLiveSuccess)
            .slice(0, 3);
        
        topHospitals.forEach(hospital => {
            dashboardHospitals.appendChild(createHospitalCard(hospital));
        });
    }
    
    document.querySelectorAll('.save-btn').forEach(button => {
        button.addEventListener('click', handleSaveItem);
    });
}

// Filter hospitals function
function filterHospitals(filter) {
    const container = document.querySelector('.hospital-cards-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    let filteredHospitals = [...hospitals];
    
    switch(filter) {
        case 'high-success':
            filteredHospitals = filteredHospitals.filter(h => h.stats.goLiveSuccess >= 95);
            break;
        case 'recent':
            // Filter for go-lives in last 2 years
            filteredHospitals = filteredHospitals.filter(h => {
                const goLiveDate = new Date(h.goLiveDate);
                const twoYearsAgo = new Date();
                twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
                return goLiveDate > twoYearsAgo;
            });
            break;
        case 'large-team':
            filteredHospitals = filteredHospitals.filter(h => h.epicTeamSize >= 50);
            break;
    }
    
    filteredHospitals.forEach(hospital => {
        container.appendChild(createHospitalCard(hospital));
    });
    
    document.querySelectorAll('.save-btn').forEach(button => {
        button.addEventListener('click', handleSaveItem);
    });
}


function initApp() {
        console.log('Initializing app...');
        
        // Set up navigation
        const navLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');
        
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                console.log('Clicked tab:', targetId);
                
                // Update active tab
                navLinks.forEach(navLink => navLink.classList.remove('active'));
                link.classList.add('active');
                
                // Show target content
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.classList.add('active');
                    console.log('Showing tab:', targetId);
                    
                    // If it's the go-live section, update stats
                    if (targetId === 'go-live') {
                        updateGoLiveStats();
                    }
                } else {
                    console.error('Tab content not found:', targetId);
                }
            });
        });
        
        // Initialize dashboard stats
        document.getElementById('hospital-count').textContent = hospitals.length;
        document.getElementById('faq-count').textContent = faqs.length;
        
        // Render hospitals and FAQs
        renderHospitals();
        renderFAQs();
        
        // Update Go-Live stats
        updateGoLiveStats();
        
        // Set up search functionality
        initSearchFunctionality();
        
        // Profile tabs
        const profileTabs = document.querySelectorAll('.profile-tab');
        const profileTabContents = document.querySelectorAll('.profile-tab-content');
        
        profileTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Update active tab
                profileTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show target content
                profileTabContents.forEach(content => content.classList.remove('active'));
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Save button handlers
        document.querySelectorAll('.save-btn').forEach(button => {
            button.addEventListener('click', handleSaveItem);
        });
        
        // Upload modal
        const uploadResourceBtn = document.getElementById('upload-resource-btn');
        const uploadFromProfileBtn = document.getElementById('upload-from-profile-btn');
        const modalCloseBtns = document.querySelectorAll('.modal-close');
        
        if (uploadResourceBtn) {
            uploadResourceBtn.addEventListener('click', () => {
                document.getElementById('upload-modal').classList.add('active');
            });
        }
        
        if (uploadFromProfileBtn) {
            uploadFromProfileBtn.addEventListener('click', () => {
                document.getElementById('upload-modal').classList.add('active');
            });
        }
        
        modalCloseBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('upload-modal').classList.remove('active');
                document.getElementById('upgrade-modal').classList.remove('active');
            });
        });
        
        // File upload handling
        const fileUploadArea = document.getElementById('file-upload-area');
        const fileInput = document.getElementById('file-input');
        const startUploadBtn = document.getElementById('start-upload-btn');
        
        if (fileUploadArea && fileInput) {
            fileUploadArea.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const fileName = document.getElementById('file-name');
                    const fileSize = document.getElementById('file-size');
                    const fileInfo = document.getElementById('file-info');
                    
                    if (fileName) fileName.textContent = file.name;
                    if (fileSize) fileSize.textContent = formatFileSize(file.size);
                    if (fileInfo) fileInfo.style.display = 'block';
                }
            });
        }
        
        if (startUploadBtn) {
            startUploadBtn.addEventListener('click', () => {
                startUploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
                startUploadBtn.disabled = true;
                
                setTimeout(() => {
                    showNotification('Document uploaded successfully!');
                    document.getElementById('upload-modal').classList.remove('active');
                    startUploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Document';
                    startUploadBtn.disabled = false;
                }, 2000);
            });
        }
        
        // Upgrade buttons
        const upgradeButtons = document.querySelectorAll('#upgrade-btn, #upgrade-btn-2');
        const startTrialBtn = document.getElementById('start-trial-btn');
        
        upgradeButtons.forEach(button => {
            button.addEventListener('click', () => {
                document.getElementById('upgrade-modal').classList.add('active');
            });
        });
        
        if (startTrialBtn) {
            startTrialBtn.addEventListener('click', () => {
                startTrialBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                
                setTimeout(() => {
                    userState.isPremium = true;
                    const premiumBadge = document.getElementById('premium-status');
                    if (premiumBadge) {
                        premiumBadge.innerHTML = '<i class="fas fa-crown"></i> Premium Member';
                        premiumBadge.style.background = 'linear-gradient(135deg, var(--premium-gold), var(--premium-dark))';
                    }
                    showNotification('Welcome to Premium! You now have access to all profile features.');
                    document.getElementById('upgrade-modal').classList.remove('active');
                    startTrialBtn.innerHTML = '<i class="fas fa-play-circle"></i> Start Free Trial';
                }, 1500);
            });
        }
        
        console.log('App initialized successfully');
    }

    function updateGoLiveStats() {
        console.log('Updating Go-Live stats...');
        const totalEpicTeam = hospitals.reduce((sum, hospital) => sum + hospital.epicTeamSize, 0);
        const totalUsersTrained = hospitals.reduce((sum, hospital) => sum + hospital.stats.usersTrained, 0);
        const avgSuccessRate = (hospitals.reduce((sum, hospital) => sum + hospital.stats.goLiveSuccess, 0) / hospitals.length).toFixed(1);
        
        const statsHTML = `
            <div class="stat-card">
                <i class="fas fa-hospital"></i>
                <h3>${hospitals.length}</h3>
                <p>Hospital Systems</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-users"></i>
                <h3>${totalEpicTeam}</h3>
                <p>Total Epic Team Members</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-chart-line"></i>
                <h3>${avgSuccessRate}%</h3>
                <p>Average Success Rate</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-graduation-cap"></i>
                <h3>${totalUsersTrained.toLocaleString()}</h3>
                <p>Users Trained</p>
            </div>
        `;
        
        const statsContainer = document.getElementById('go-live-stats');
        if (statsContainer) {
            statsContainer.innerHTML = statsHTML;
            console.log('Go-Live stats updated');
        } else {
            console.error('Go-Live stats container not found!');
        }
    }

    function renderHospitals() {
        const hospitalList = document.getElementById('hospital-list');
        const dashboardHospitals = document.getElementById('dashboard-hospitals');
        
        if (hospitalList) {
            hospitalList.innerHTML = '';
            hospitals.forEach(hospital => {
                hospitalList.appendChild(createHospitalCard(hospital));
            });
        }
        
        if (dashboardHospitals) {
            dashboardHospitals.innerHTML = '';
            hospitals.slice(0, 2).forEach(hospital => {
                dashboardHospitals.appendChild(createHospitalCard(hospital));
            });
        }
        
        document.querySelectorAll('.save-btn').forEach(button => {
            button.addEventListener('click', handleSaveItem);
        });
    }

    function createHospitalCard(hospital) {
        const card = document.createElement('div');
        card.className = 'hospital-card';
        card.innerHTML = `
            <div class="premium-lock" title="Premium feature">
                <i class="fas fa-lock"></i>
            </div>
            <h3><i class="fas fa-hospital"></i> ${hospital.name}</h3>
            <div class="hospital-meta">
                <span><i class="fas fa-code-branch"></i> ${hospital.version}</span>
                <span><i class="fas fa-calendar-alt"></i> Go-Live: ${hospital.goLiveDate}</span>
                <span><i class="fas fa-users"></i> Team: ${hospital.epicTeamSize}</span>
            </div>
            <p>${hospital.notes}</p>
            <div class="module-list">
                ${hospital.modules.map(module => `<span class="module-tag">${module}</span>`).join('')}
            </div>
            <div class="hospital-contact">
                <p><strong><i class="fas fa-user-tie"></i> ${hospital.contact.role}:</strong> ${hospital.contact.name}</p>
                <p><strong><i class="fas fa-envelope"></i> Email:</strong> ${hospital.contact.email}</p>
                <p><strong><i class="fas fa-phone"></i> Phone:</strong> ${hospital.contact.phone}</p>
                <p><strong><i class="fas fa-chalkboard-teacher"></i> Training Rooms:</strong> ${hospital.trainingRooms}</p>
                <p><strong><i class="fas fa-chart-line"></i> Success Rate:</strong> ${hospital.stats.goLiveSuccess}%</p>
            </div>
            <button class="btn btn-primary">View Details</button>
            <button class="btn btn-outline save-btn" data-id="hosp-${hospital.id}" data-type="hospital" data-premium="true">
                <i class="fas fa-bookmark"></i> Save
            </button>
        `;
        return card;
    }

    function renderFAQs() {
        const faqContainer = document.querySelector('.faq-container');
        const faqList = document.getElementById('faq-list');
        
        if (faqContainer) {
            faqContainer.innerHTML = '';
            faqs.forEach(faq => {
                faqContainer.appendChild(createFAQItem(faq));
            });
        }
        
        if (faqList) {
            faqList.innerHTML = '';
            faqs.forEach(faq => {
                faqList.appendChild(createFAQItem(faq));
            });
        }
        
        document.querySelectorAll('.faq-question').forEach(question => {
            question.addEventListener('click', function() {
                const answer = this.nextElementSibling;
                answer.classList.toggle('active');
                this.querySelector('span').textContent = answer.classList.contains('active') ? '-' : '+';
            });
        });
        
        document.querySelectorAll('.save-btn').forEach(button => {
            button.addEventListener('click', handleSaveItem);
        });
    }

    function createFAQItem(faq) {
        const faqItem = document.createElement('div');
        faqItem.className = 'faq-item';
        faqItem.innerHTML = `
            <div class="faq-question">${faq.question} <span>+</span></div>
            <div class="faq-answer">
                <p>${faq.answer}</p>
                <div class="faq-meta">
                    <span class="faq-category">${faq.category}</span>
                    <span class="faq-helpful">${faq.helpfulCount} people found this helpful</span>
                </div>
                <button class="btn btn-outline save-btn" data-id="faq-${faq.id}" data-type="faq" data-premium="true">
                    <i class="fas fa-bookmark"></i> Save this answer
                </button>
            </div>
        `;
        return faqItem;
    }

    function handleSaveItem(e) {
        const button = e.currentTarget;
        const isPremiumFeature = button.getAttribute('data-premium') === 'true';
        
        if (isPremiumFeature && !userState.isPremium) {
            showNotification('Upgrade to Premium to save items', 'warning');
            return;
        }
        
        const itemId = button.getAttribute('data-id');
        const itemType = button.getAttribute('data-type');
        
        if (button.classList.contains('saved')) {
            button.classList.remove('saved');
            button.innerHTML = '<i class="fas fa-bookmark"></i> Save';
            removeFromSavedItems(itemId);
            showNotification('Item removed from your saved content.');
        } else {
            button.classList.add('saved');
            button.innerHTML = '<i class="fas fa-check"></i> Saved';
            addToSavedItems(itemId, itemType);
            showNotification('Item saved to your profile!');
        }
    }

    function initSearchFunctionality() {
        const searchBoxes = document.querySelectorAll('.search-box');
        
        searchBoxes.forEach(box => {
            box.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const tabId = e.target.closest('.tab-content')?.id || '';
                
                if (tabId === 'hospitals') {
                    filterHospitals(searchTerm);
                } else if (tabId === 'faq') {
                    filterFAQs(searchTerm);
                } else if (tabId === 'resources') {
                    filterResources(searchTerm);
                } else if (tabId === 'dashboard') {
                    filterAllContent(searchTerm);
                }
            });
        });
    }

    function filterHospitals(searchTerm) {
        const hospitalCards = document.querySelectorAll('#hospital-list .hospital-card');
        
        hospitalCards.forEach(card => {
            const hospitalName = card.querySelector('h3').textContent.toLowerCase();
            const hospitalDetails = card.textContent.toLowerCase();
            
            if (hospitalName.includes(searchTerm) || hospitalDetails.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    function filterFAQs(searchTerm) {
        const faqItems = document.querySelectorAll('.faq-item');
        
        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question').textContent.toLowerCase();
            const answer = item.querySelector('.faq-answer').textContent.toLowerCase();
            
            if (question.includes(searchTerm) || answer.includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function filterResources(searchTerm) {
        const resourceCards = document.querySelectorAll('.resource-card');
        
        resourceCards.forEach(card => {
            const title = card.querySelector('h3').textContent.toLowerCase();
            const description = card.textContent.toLowerCase();
            
            if (title.includes(searchTerm) || description.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    function filterAllContent(searchTerm) {
        const allContent = document.querySelectorAll('.hospital-card, .resource-card, .faq-item');
        
        allContent.forEach(item => {
            const contentText = item.textContent.toLowerCase();
            
            if (contentText.includes(searchTerm)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function addToSavedItems(itemId, itemType) {
        userState.savedItems.push({
            id: itemId,
            type: itemType,
            savedAt: new Date()
        });
    }

    function removeFromSavedItems(itemId) {
        userState.savedItems = userState.savedItems.filter(item => item.id !== itemId);
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 
                                           type === 'warning' ? 'var(--warning)' : 
                                           type === 'error' ? 'var(--danger)' : 
                                           type === 'info' ? 'var(--info)' :
                                           'var(--epic-purple)';
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 3000);
    }

    // ==================== INITIALIZE APP ====================
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing app...');
        initApp();
    });
// ==================== AI ASSISTANT ====================
function showAIAssistant() {
    // Create AI modal if it doesn't exist
    if (!document.getElementById('ai-assistant-modal')) {
        const modalHTML = `
            <div id="ai-assistant-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10001; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px);">
                <div style="background: white; border-radius: 15px; width: 90%; max-width: 600px; max-height: 80vh; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <div style="background: linear-gradient(135deg, #4B286D, #7B52AB); color: white; padding: 20px 25px; display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-robot"></i> Epic AI Assistant
                        </h3>
                        <button onclick="closeAIAssistant()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">Ã</button>
                    </div>
                    
                    <div id="ai-chat-container" style="flex: 1; padding: 20px; overflow-y: auto; min-height: 400px; max-height: 500px; background: #f8f9fa;">
                        <div class="ai-message ai">
                            <div class="ai-avatar">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="ai-content">
                                <p>Hello! I'm your Epic AI Assistant. I can help you with:</p>
                                <ul>
                                    <li>Go-Live planning and checklists</li>
                                    <li>Training strategies and resources</li>
                                    <li>Hospital implementation best practices</li>
                                    <li>Support staffing calculations</li>
                                    <li>FAQ answers and troubleshooting</li>
                                </ul>
                                <p>What would you like to know about Epic implementations?</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 20px; border-top: 1px solid #dee2e6; background: white;">
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button onclick="askAIQuick('What are the critical go-live success factors?')" class="ai-quick-btn">
                                <i class="fas fa-rocket"></i> Go-Live Tips
                            </button>
                            <button onclick="askAIQuick('How many support staff do I need?')" class="ai-quick-btn">
                                <i class="fas fa-users"></i> Staff Planning
                            </button>
                            <button onclick="askAIQuick('What training resources are available?')" class="ai-quick-btn">
                                <i class="fas fa-book"></i> Training Resources
                            </button>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="ai-question-input" placeholder="Ask about Epic implementations..." style="flex: 1; padding: 12px 15px; border: 1px solid #dee2e6; border-radius: 8px; font-size: 14px;">
                            <button onclick="askAIQuestion()" style="padding: 12px 25px; background: linear-gradient(135deg, #4B286D, #7B52AB); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-paper-plane"></i> Ask
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <style>
                .ai-message {
                    display: flex;
                    gap: 15px;
                    margin-bottom: 20px;
                }
                
                .ai-message.ai {
                    flex-direction: row;
                }
                
                .ai-message.user {
                    flex-direction: row-reverse;
                }
                
                .ai-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    flex-shrink: 0;
                }
                
                .ai-message.ai .ai-avatar {
                    background: linear-gradient(135deg, #4B286D, #7B52AB);
                    color: white;
                }
                
                .ai-message.user .ai-avatar {
                    background: #28a745;
                    color: white;
                }
                
                .ai-content {
                    background: white;
                    padding: 15px;
                    border-radius: 12px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    max-width: 80%;
                }
                
                .ai-message.ai .ai-content {
                    border-top-left-radius: 0;
                }
                
                .ai-message.user .ai-content {
                    border-top-right-radius: 0;
                    background: #e3f2fd;
                }
                
                .ai-content p {
                    margin: 0 0 10px 0;
                }
                
                .ai-content ul {
                    margin: 10px 0;
                    padding-left: 20px;
                }
                
                .ai-content li {
                    margin-bottom: 5px;
                }
                
                .ai-quick-btn {
                    padding: 10px 15px;
                    background: #f8f9fa;
                    border: 1px solid #dee2e6;
                    border-radius: 6px;
                    color: #4B286D;
                    cursor: pointer;
                    font-size: 12px;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                    transition: all 0.3s;
                }
                
                .ai-quick-btn:hover {
                    background: #4B286D;
                    color: white;
                    border-color: #4B286D;
                }
            </style>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
    
    document.getElementById('ai-assistant-modal').style.display = 'flex';
    document.getElementById('ai-question-input').focus();
}

function closeAIAssistant() {
    document.getElementById('ai-assistant-modal').style.display = 'none';
}

function askAIQuestion() {
    const input = document.getElementById('ai-question-input');
    const question = input.value.trim();
    
    if (!question) {
        showNotification('Please enter a question', 'warning');
        return;
    }
    
    addAIMessage('user', question);
    input.value = '';
    
    // Simulate AI thinking
    setTimeout(() => {
        const answer = generateAIAnswer(question);
        addAIMessage('ai', answer);
    }, 800);
}

function askAIQuick(question) {
    document.getElementById('ai-question-input').value = question;
    askAIQuestion();
}

function addAIMessage(sender, content) {
    const container = document.getElementById('ai-chat-container');
    const messageDiv = document.createElement('div');
    messageDiv.className = `ai-message ${sender}`;
    
    const avatar = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
    const avatarClass = sender === 'user' ? 'user' : 'ai';
    
    messageDiv.innerHTML = `
        <div class="ai-avatar ${avatarClass}">
            ${avatar}
        </div>
        <div class="ai-content">
            ${content}
        </div>
    `;
    
    container.appendChild(messageDiv);
    container.scrollTop = container.scrollHeight;
}

function generateAIAnswer(question) {
    const q = question.toLowerCase();
    
    if (q.includes('go-live') || q.includes('success factor') || q.includes('critical')) {
        return `<p><strong>Critical Go-Live Success Factors:</strong></p>
                <ul>
                    <li><strong>Executive Sponsorship:</strong> Active leadership engagement</li>
                    <li><strong>Comprehensive Training:</strong> 100% of end-users trained before go-live</li>
                    <li><strong>Adequate Staffing:</strong> 1:50 at-the-elbow support ratio</li>
                    <li><strong>Clear Communication:</strong> Hourly leadership updates during go-live</li>
                    <li><strong>Real-time Monitoring:</strong> Live dashboard with key metrics</li>
                    <li><strong>Physician Engagement:</strong> Physician champions in each specialty</li>
                </ul>
                <p><em>Pro Tip:</em> Conduct a full dress rehearsal 7 days before go-live.</p>`;
    }
    else if (q.includes('staff') || q.includes('support') || q.includes('ratio')) {
        return `<p><strong>Epic Go-Live Staffing Recommendations:</strong></p>
                <ul>
                    <li><strong>Tier 1 (At-the-elbow):</strong> 1:50 ratio (2 per 100 users)</li>
                    <li><strong>Tier 2 (Command Center):</strong> 1:100 ratio (1 per 100 users)</li>
                    <strong>Tier 3 (Analyst/Builder):</strong> 1:200 ratio (0.5 per 100 users)</li>
                </ul>
                <p><strong>Specialty Area Adjustments:</strong></p>
                <ul>
                    <li><strong>ED/OR/ICU:</strong> Increase to 1:25 ratio</li>
                    <li><strong>Inpatient Units:</strong> 1:40 ratio recommended</li>
                    <li><strong>Ambulatory:</strong> 1:75 ratio typically sufficient</li>
                </ul>
                <p>Use the Staffing Calculator in the Go-Live section for precise calculations.</p>`;
    }
    else if (q.includes('train') || q.includes('resource')) {
        return `<p><strong>Essential Epic Training Resources:</strong></p>
                <ul>
                    <li><strong>Fundamentals Training:</strong> 8-hour classroom or virtual sessions</li>
                    <li><strong>Playground Access:</strong> Hands-on practice environment</li>
                    <li><strong>Specialty-Specific Materials:</strong> Department-focused scenarios</li>
                    <li><strong>Quick Reference Guides:</strong> One-page workflow summaries</li>
                    <li><strong>Video Tutorials:</strong> On-demand procedural videos</li>
                </ul>
                <p><strong>Training Success Metrics:</strong></p>
                <ul>
                    <li>100% attendance for required training</li>
                    <li>85%+ proficiency scores on assessments</li>
                    <li>95%+ satisfaction ratings</li>
                    <li>Post-training competency validation</li>
                </ul>`;
    }
    else if (q.includes('command center') || q.includes('setup')) {
        return `<p><strong>Command Center Setup Requirements:</strong></p>
                <ul>
                    <li><strong>Physical Space:</strong> Large room (min 1000 sq ft) with multiple work zones</li>
                    <strong>Technology:</strong> Multiple large displays, dedicated phones, reliable Wi-Fi</li>
                    <li><strong>Staffing:</strong> Clear roles (Lead, Coordinator, Communicator, Scribe)</li>
                    <li><strong>Communication:</strong> Direct lines to hospital leadership, status boards</li>
                    <li><strong>Tools:</strong> Real-time dashboard, ticket tracking system, communication platform</li>
                </ul>
                <p>Download the complete Command Center Setup Guide from the Go-Live Resources section.</p>`;
    }
    else {
        return `<p>I can help you with various Epic implementation topics. Try asking about:</p>
                <ul>
                    <li><strong>Go-Live Planning:</strong> "What are the critical success factors?"</li>
                    <strong>Staffing:</strong> "How many support staff do I need?"</li>
                    <li><strong>Training:</strong> "What training resources are available?"</li>
                    <li><strong>Metrics:</strong> "What should we track during go-live?"</li>
                    <li><strong>Physician Engagement:</strong> "How do we get physicians on board?"</li>
                </ul>
                <p>You can also use the quick buttons above for common questions.</p>`;
    }
}

// ==================== LOGIN SYSTEM ====================
function showLoginModal() {
    // Create login modal if it doesn't exist
    if (!document.getElementById('login-modal')) {
        const modalHTML = `
            <div class="modal-overlay" id="login-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 10000;">
                <div class="modal" style="background: white; border-radius: 10px; padding: 30px; width: 90%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                    <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0; color: #4B286D;">
                            <i class="fas fa-user-circle"></i> Epic Trainer Login
                        </h2>
                        <button onclick="closeLoginModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6c757d; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">Ã</button>
                    </div>
                    
                    <div style="padding: 10px;">
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="login-email" style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">Email Address</label>
                            <input type="email" id="login-email" placeholder="trainer@hospital.org" style="width: 100%; padding: 12px 15px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 14px;">
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 25px;">
                            <label for="login-password" style="display: block; margin-bottom: 8px; font-weight: 600; color: #495057;">Password</label>
                            <input type="password" id="login-password" placeholder="Enter your password" style="width: 100%; padding: 12px 15px; border: 1px solid #dee2e6; border-radius: 6px; font-size: 14px;">
                        </div>
                        
                        <button onclick="performLogin()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #4B286D, #7B52AB); color: white; border: none; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px;">
                            <i class="fas fa-sign-in-alt"></i> Login to Epic Trainer
                        </button>
                        
                        <div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 6px; margin-bottom: 15px;">
                            <p style="margin: 0; font-size: 13px; color: #6c757d;">
                                <strong>Demo Access Available</strong><br>
                                Use: <code>demo@epictrainer.org</code> / <code>epicdemo123</code>
                            </p>
                        </div>
                        
                        <div style="text-align: center;">
                            <button onclick="showDemoLogin()" style="background: none; border: none; color: #4B286D; cursor: pointer; font-size: 14px; padding: 10px;">
                                <i class="fas fa-magic"></i> Quick Demo Login
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
    }
    
    document.getElementById('login-modal').style.display = 'flex';
    document.getElementById('login-email').focus();
}

function closeLoginModal() {
    document.getElementById('login-modal').style.display = 'none';
}

function showDemoLogin() {
    document.getElementById('login-email').value = 'demo@epictrainer.org';
    document.getElementById('login-password').value = 'epicdemo123';
    performLogin();
}

function performLogin() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    // For demo purposes, accept any login
    // In production, you would validate against a backend
    userState.currentUser = {
        id: 'user-' + Date.now(),
        email: email,
        name: email.split('@')[0].replace('.', ' ').replace(/\b\w/g, l => l.toUpperCase()),
        hospital: email.includes('mayo') ? 'Mayo Clinic' : 
                 email.includes('hopkins') ? 'Johns Hopkins Hospital' :
                 email.includes('mercy') ? 'Mercy General Hospital' : 'Demo Hospital',
        isPremium: true,
        role: 'Epic Certified Trainer',
        avatar: 'https://ui-avatars.com/api/?name=' + encodeURIComponent(email.split('@')[0]) + '&background=4B286D&color=fff'
    };
    userState.isPremium = true;
    
    // Update UI
    const loginBtn = document.getElementById('login-btn');
    if (loginBtn) {
        loginBtn.innerHTML = `<i class="fas fa-user"></i> ${userState.currentUser.name}`;
        loginBtn.onclick = () => {
            if (confirm('Are you sure you want to logout?')) {
                userState.currentUser = null;
                userState.isPremium = false;
                loginBtn.innerHTML = '<i class="fas fa-user"></i> Trainer Login';
                loginBtn.onclick = showLoginModal;
                showNotification('Logged out successfully', 'info');
                
                // Reset premium badge
                const premiumBadge = document.getElementById('premium-status');
                if (premiumBadge) {
                    premiumBadge.innerHTML = '<i class="fas fa-crown"></i> Free Plan';
                    premiumBadge.style.background = '';
                }
            }
        };
    }
    
    // Update premium badge
    const premiumBadge = document.getElementById('premium-status');
    if (premiumBadge) {
        premiumBadge.innerHTML = '<i class="fas fa-crown"></i> Premium Member';
        premiumBadge.style.background = 'linear-gradient(135deg, #FFD700, #D4AF37)';
    }
    
    closeLoginModal();
    showNotification(`Welcome back, ${userState.currentUser.name}! Premium features unlocked.`, 'success');
    
    // Update profile section if visible
    updateProfileSection();
}

// ==================== NOTIFICATION SYSTEM ====================
function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existing = document.querySelectorAll('.epic-notification');
    existing.forEach(n => n.remove());
    
    const notification = document.createElement('div');
    notification.className = 'epic-notification';
    notification.setAttribute('data-type', type);
    
    const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        warning: 'fas fa-exclamation-triangle',
        info: 'fas fa-info-circle'
    };
    
    const colors = {
        success: '#28a745',
        error: '#dc3545',
        warning: '#ffc107',
        info: '#17a2b8'
    };
    
    notification.innerHTML = `
        <div class="notification-content" style="display: flex; align-items: center; gap: 15px;">
            <i class="${icons[type] || icons.info}" style="font-size: 20px;"></i>
            <span>${message}</span>
        </div>
        <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer; padding: 0; font-size: 18px;">Ã</button>
    `;
    
    Object.assign(notification.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        background: colors[type] || colors.info,
        color: 'white',
        padding: '15px 20px',
        borderRadius: '8px',
        boxShadow: '0 5px 15px rgba(0,0,0,0.2)',
        zIndex: '10000',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between',
        gap: '20px',
        minWidth: '300px',
        maxWidth: '400px',
        animation: 'slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards'
    });
    
    // Add animation styles if not present
    if (!document.querySelector('#notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    }
    
    document.body.appendChild(notification);
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    }, 3000);
}

// ==================== INITIALIZE EVERYTHING ====================
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing enhanced Epic Trainer...');
    
    // Fix the AI button
    const aiButton = document.querySelector('#ai-features-button');
    if (aiButton) {
        // Remove any existing links
        const link = aiButton.querySelector('a');
        if (link) {
            link.removeAttribute('href');
            link.style.cursor = 'pointer';
            link.onclick = showAIAssistant;
        } else {
            aiButton.onclick = showAIAssistant;
        }
    }
    
    // Fix login button
    const loginBtn = document.getElementById('login-btn');
    if (loginBtn && !loginBtn.onclick) {
        loginBtn.onclick = showLoginModal;
    }
    
    // Initialize enhanced hospital rendering
    if (typeof renderHospitals === 'function') {
        setTimeout(renderHospitals, 100);
    }
    
    // Update Go-Live stats if needed
    if (typeof updateGoLiveStats === 'function') {
        setTimeout(updateGoLiveStats, 100);
    }
    
    console.log('Enhanced Epic Trainer initialized!');
});
</script>
    
    <!-- Only keep one AI chat button -->
    <div id="ai-features-button" style="position: fixed; bottom: 100px; right: 30px; width: 70px; height: 70px; background: linear-gradient(135deg, #FFD700, #D4AF37); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 8px 25px rgba(0,0,0,0.3); z-index: 9999; transition: all 0.3s ease; animation: pulse 2s infinite;">
        <a href="ai-features.html" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; text-decoration: none; color: #333; font-weight: bold; flex-direction: column;">
            <i class="fas fa-robot" style="font-size: 24px; margin-bottom: 5px;"></i>
            <span style="font-size: 10px;">AI Features</span>
        </a>
    </div>
</body>
</html>

<script>
// ==================== REAL UPLOAD & SAVE SYSTEM ====================

// Initialize user's saved items from localStorage
function initializeUserStorage() {
    const saved = localStorage.getItem('epic_trainer_saved_items');
    if (saved) {
        userState.savedItems = JSON.parse(saved);
    }
    
    const uploaded = localStorage.getItem('epic_trainer_uploads');
    if (uploaded) {
        userState.uploads = JSON.parse(uploaded);
    } else {
        userState.uploads = [];
    }
}

// Save items to localStorage
function saveToStorage() {
    localStorage.setItem('epic_trainer_saved_items', JSON.stringify(userState.savedItems));
    localStorage.setItem('epic_trainer_uploads', JSON.stringify(userState.uploads));
}

// Enhanced save function
function handleSaveItem(e) {
    const button = e.currentTarget;
    const isPremiumFeature = button.getAttribute('data-premium') === 'true';
    
    if (isPremiumFeature && !userState.isPremium) {
        showNotification('Upgrade to Premium to save items', 'warning');
        return;
    }
    
    const itemId = button.getAttribute('data-id');
    const itemType = button.getAttribute('data-type');
    const itemTitle = button.closest('.hospital-card, .resource-card, .faq-item')?.querySelector('h3')?.textContent || 'Untitled Item';
    
    if (button.classList.contains('saved')) {
        // Remove from saved
        button.classList.remove('saved');
        button.innerHTML = '<i class="fas fa-bookmark"></i> Save';
        removeFromSavedItems(itemId);
        showNotification('Item removed from your saved content.');
    } else {
        // Add to saved
        button.classList.add('saved');
        button.innerHTML = '<i class="fas fa-check"></i> Saved';
        
        const savedItem = {
            id: itemId,
            type: itemType,
            title: itemTitle,
            savedAt: new Date().toISOString(),
            notes: ''
        };
        
        userState.savedItems.push(savedItem);
        saveToStorage();
        showNotification('"' + itemTitle + '" saved to your profile!');
        
        // Update saved tab if open
        updateSavedContentDisplay();
    }
}

// Enhanced upload function
function handleFileUpload() {
    const fileInput = document.getElementById('file-input');
    const title = document.getElementById('doc-title').value;
    const description = document.getElementById('doc-description').value;
    const category = document.getElementById('doc-category').value;
    
    if (!title.trim()) {
        showNotification('Please enter a document title', 'warning');
        return;
    }
    
    if (fileInput.files.length === 0) {
        showNotification('Please select a file to upload', 'warning');
        return;
    }
    
    const file = fileInput.files[0];
    const uploadBtn = document.getElementById('start-upload-btn');
    uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Uploading...';
    uploadBtn.disabled = true;
    
    // Simulate upload process
    setTimeout(() => {
        const newUpload = {
            id: 'upload-' + Date.now(),
            title: title,
            description: description,
            category: category,
            filename: file.name,
            size: file.size,
            uploadedAt: new Date().toISOString(),
            type: file.type,
            public: document.getElementById('doc-public').checked
        };
        
        userState.uploads.push(newUpload);
        saveToStorage();
        
        showNotification('"' + title + '" uploaded successfully!', 'success');
        
        // Close modal
        document.getElementById('upload-modal').classList.remove('active');
        
        // Reset form
        document.getElementById('doc-title').value = '';
        document.getElementById('doc-description').value = '';
        document.getElementById('doc-category').value = '';
        document.getElementById('file-input').value = '';
        document.getElementById('file-info').style.display = 'none';
        
        // Update uploads tab
        updateUploadsDisplay();
        
        uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Document';
        uploadBtn.disabled = false;
    }, 1500);
}

// Display saved content
function updateSavedContentDisplay() {
    const savedTab = document.getElementById('saved-tab');
    if (!savedTab || !userState.isPremium) return;
    
    if (userState.savedItems.length === 0) {
        savedTab.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-bookmark" style="font-size: 48px; color: var(--epic-light-purple); margin-bottom: 20px;"></i>
                <h3>No Saved Content Yet</h3>
                <p>Save hospitals, resources, or FAQs to see them here.</p>
            </div>
        `;
        return;
    }
    
    let html = '<h3>Your Saved Content</h3><div class="saved-grid">';
    
    userState.savedItems.forEach((item, index) => {
        const typeIcon = item.type === 'hospital' ? 'fa-hospital' : 
                        item.type === 'resource' ? 'fa-file-alt' : 'fa-question-circle';
        
        html += `
            <div class="saved-item">
                <div class="saved-item-header">
                    <i class="fas ${typeIcon}"></i>
                    <h4>${item.title}</h4>
                    <button onclick="removeSavedItem('${item.id}')" class="btn btn-sm btn-outline">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <p class="small">Saved on ${new Date(item.savedAt).toLocaleDateString()}</p>
                <textarea class="notes-input" data-id="${item.id}" placeholder="Add your notes here..." onchange="updateItemNotes('${item.id}', this.value)">${item.notes || ''}</textarea>
            </div>
        `;
    });
    
    html += '</div>';
    savedTab.innerHTML = html;
}

// Display uploaded files
function updateUploadsDisplay() {
    const uploadsTab = document.getElementById('uploads-tab');
    if (!uploadsTab) return;
    
    if (userState.uploads.length === 0) {
        uploadsTab.innerHTML = `
            <h3>My Uploaded Resources</h3>
            <div class="empty-state">
                <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--epic-light-purple); margin-bottom: 20px;"></i>
                <p>You haven't uploaded any resources yet.</p>
                <button class="btn btn-primary" id="upload-from-profile-btn">
                    <i class="fas fa-upload"></i> Upload Your First Resource
                </button>
            </div>
        `;
        return;
    }
    
    let html = '<h3>My Uploaded Resources</h3><div class="resource-grid">';
    
    userState.uploads.forEach((upload, index) => {
        const fileIcon = upload.filename.endsWith('.pdf') ? 'fa-file-pdf' :
                       upload.filename.endsWith('.doc') ? 'fa-file-word' :
                       upload.filename.endsWith('.mp4') ? 'fa-file-video' : 'fa-file';
        
        html += `
            <div class="resource-card">
                <div class="upload-badge ${upload.public ? 'public' : 'private'}">
                    <i class="fas fa-${upload.public ? 'globe' : 'lock'}"></i>
                    ${upload.public ? 'Public' : 'Private'}
                </div>
                <h3><i class="fas ${fileIcon}"></i> ${upload.title}</h3>
                <div class="resource-meta">
                    <span>${upload.category || 'Document'}</span>
                    <span>${formatFileSize(upload.size)}</span>
                </div>
                <p>${upload.description || 'No description provided.'}</p>
                <button class="btn btn-primary">
                    <i class="fas fa-download"></i> Download
                </button>
                <button onclick="deleteUpload('${upload.id}')" class="btn btn-outline">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        `;
    });
    
    html += '</div>';
    uploadsTab.innerHTML = html;
}

// Helper functions
function removeSavedItem(itemId) {
    userState.savedItems = userState.savedItems.filter(item => item.id !== itemId);
    saveToStorage();
    updateSavedContentDisplay();
    showNotification('Item removed from saved content', 'info');
}

function deleteUpload(uploadId) {
    if (confirm('Are you sure you want to delete this upload?')) {
        userState.uploads = userState.uploads.filter(upload => upload.id !== uploadId);
        saveToStorage();
        updateUploadsDisplay();
        showNotification('Upload deleted', 'info');
    }
}

function updateItemNotes(itemId, notes) {
    const item = userState.savedItems.find(item => item.id === itemId);
    if (item) {
        item.notes = notes;
        saveToStorage();
    }
}

// Initialize storage on app start
initializeUserStorage();

// Update initApp function to include storage
const originalInitApp = initApp;
initApp = function() {
    originalInitApp();
    initializeUserStorage();
    if (userState.isPremium) {
        updateSavedContentDisplay();
    }
    updateUploadsDisplay();
};

// Update premium upgrade to refresh display
const originalStartTrial = window.startTrial;
window.startTrial = function() {
    if (typeof originalStartTrial === 'function') {
        originalStartTrial();
    }
    setTimeout(() => {
        updateSavedContentDisplay();
    }, 100);
};

// Update file upload button handler
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const uploadBtn = document.getElementById('start-upload-btn');
        if (uploadBtn) {
            uploadBtn.onclick = handleFileUpload;
        }
    }, 1000);
});
</script>

<style>
/* Add to your existing CSS */
.saved-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.saved-item {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid var(--medium-gray);
}

.saved-item-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.saved-item-header h4 {
    margin: 0;
    flex: 1;
    font-size: 16px;
}

.notes-input {
    width: 100%;
    min-height: 80px;
    padding: 10px;
    border: 1px solid var(--medium-gray);
    border-radius: 5px;
    font-family: inherit;
    font-size: 14px;
    margin-top: 10px;
    resize: vertical;
}

.upload-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.upload-badge.public {
    background: var(--success);
    color: white;
}

.upload-badge.private {
    background: var(--dark-gray);
    color: white;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--dark-gray);
}
</style>

<script>
// ==================== ENHANCED FILE UPLOAD WITH MEDIA STORAGE ====================

// Convert file to Base64 for localStorage storage
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });
}

// Enhanced upload handler
async function handleFileUpload() {
    const fileInput = document.getElementById('file-input');
    const title = document.getElementById('doc-title').value;
    const description = document.getElementById('doc-description').value;
    const category = document.getElementById('doc-category').value;
    
    if (!title.trim()) {
        showNotification('Please enter a document title', 'warning');
        return;
    }
    
    if (fileInput.files.length === 0) {
        showNotification('Please select a file to upload', 'warning');
        return;
    }
    
    const file = fileInput.files[0];
    const maxSize = 10 * 1024 * 1024; // 10MB limit for localStorage
    
    if (file.size > maxSize) {
        showNotification('File size exceeds 10MB limit for demo version', 'error');
        return;
    }
    
    const uploadBtn = document.getElementById('start-upload-btn');
    uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    uploadBtn.disabled = true;
    
    try {
        // Convert file to Base64 for storage
        const base64Data = await fileToBase64(file);
        
        const newUpload = {
            id: 'upload-' + Date.now(),
            title: title,
            description: description,
            category: category,
            filename: file.name,
            size: file.size,
            type: file.type,
            base64Data: base64Data,
            uploadedAt: new Date().toISOString(),
            public: document.getElementById('doc-public').checked,
            tags: document.getElementById('doc-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
            hospital: document.getElementById('doc-hospital').value
        };
        
        // Store in localStorage
        userState.uploads.push(newUpload);
        saveToStorage();
        
        showNotification('"' + title + '" uploaded successfully!', 'success');
        
        // Close modal and reset
        document.getElementById('upload-modal').classList.remove('active');
        resetUploadForm();
        
        // Update display
        updateUploadsDisplay();
        
    } catch (error) {
        showNotification('Upload failed: ' + error.message, 'error');
    } finally {
        uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Document';
        uploadBtn.disabled = false;
    }
}

// Function to view/play uploaded media
function viewUploadedMedia(uploadId) {
    const upload = userState.uploads.find(u => u.id === uploadId);
    if (!upload) {
        showNotification('File not found', 'error');
        return;
    }
    
    // Create media viewer modal
    const modalHTML = `
        <div class="modal-overlay active" id="media-viewer-modal">
            <div class="modal" style="max-width: 800px; max-height: 90vh;">
                <div class="modal-header">
                    <h2><i class="fas fa-file"></i> ${upload.title}</h2>
                    <button class="modal-close" onclick="closeMediaViewer()">&times;</button>
                </div>
                <div class="modal-body" style="padding: 20px;">
                    <div class="upload-meta" style="margin-bottom: 20px;">
                        <p><strong>Type:</strong> ${upload.type}</p>
                        <p><strong>Size:</strong> ${formatFileSize(upload.size)}</p>
                        <p><strong>Uploaded:</strong> ${new Date(upload.uploadedAt).toLocaleString()}</p>
                        ${upload.description ? `<p><strong>Description:</strong> ${upload.description}</p>` : ''}
                    </div>
                    
                    <div class="media-container" style="background: #000; border-radius: 8px; overflow: hidden;">
                        ${upload.type.startsWith('video/') ? 
                            `<video controls style="width: 100%; max-height: 500px;">
                                <source src="${upload.base64Data}" type="${upload.type}">
                                Your browser does not support the video tag.
                            </video>` : 
                           upload.type.startsWith('image/') ?
                            `<img src="${upload.base64Data}" style="width: 100%; max-height: 500px; object-fit: contain;">` :
                            `<div style="padding: 100px; text-align: center; color: #666;">
                                <i class="fas fa-file" style="font-size: 48px;"></i>
                                <p>Preview not available for this file type</p>
                                <a href="${upload.base64Data}" download="${upload.filename}" class="btn btn-primary">
                                    <i class="fas fa-download"></i> Download File
                                </a>
                            </div>`
                        }
                    </div>
                    
                    <div class="media-actions" style="margin-top: 20px; display: flex; gap: 10px;">
                        <a href="${upload.base64Data}" download="${upload.filename}" class="btn btn-primary">
                            <i class="fas fa-download"></i> Download
                        </a>
                        <button onclick="deleteUpload('${upload.id}')" class="btn btn-outline">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button onclick="shareUpload('${upload.id}')" class="btn btn-outline">
                            <i class="fas fa-share"></i> Share
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Add modal to page
    const existingModal = document.getElementById('media-viewer-modal');
    if (existingModal) existingModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

// Function to share upload (copy link to clipboard)
function shareUpload(uploadId) {
    const upload = userState.uploads.find(u => u.id === uploadId);
    if (!upload) return;
    
    // Create a shareable data URL
    const shareData = {
        title: upload.title,
        text: `Check out this Epic resource: ${upload.title}`,
        url: window.location.href + '#share=' + uploadId
    };
    
    if (navigator.share && navigator.canShare(shareData)) {
        navigator.share(shareData);
    } else {
        // Copy to clipboard as fallback
        const textArea = document.createElement('textarea');
        textArea.value = `${upload.title}\n\nDescription: ${upload.description}\n\nAccess via: ${window.location.href}#share=${uploadId}`;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification('Resource details copied to clipboard!', 'success');
    }
}

// Close media viewer
function closeMediaViewer() {
    const modal = document.getElementById('media-viewer-modal');
    if (modal) modal.remove();
}

// Reset upload form
function resetUploadForm() {
    document.getElementById('doc-title').value = '';
    document.getElementById('doc-description').value = '';
    document.getElementById('doc-category').value = '';
    document.getElementById('doc-tags').value = '';
    document.getElementById('doc-hospital').value = '';
    document.getElementById('doc-public').checked = false;
    document.getElementById('file-input').value = '';
    document.getElementById('file-info').style.display = 'none';
}

// Enhanced uploads display with media preview
function updateUploadsDisplay() {
    const uploadsTab = document.getElementById('uploads-tab');
    if (!uploadsTab) return;
    
    if (userState.uploads.length === 0) {
        uploadsTab.innerHTML = `
            <h3>My Uploaded Resources</h3>
            <div class="empty-state">
                <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: var(--epic-light-purple); margin-bottom: 20px;"></i>
                <p>You haven't uploaded any resources yet.</p>
                <button class="btn btn-primary" id="upload-from-profile-btn">
                    <i class="fas fa-upload"></i> Upload Your First Resource
                </button>
            </div>
        `;
        return;
    }
    
    let html = '<h3>My Uploaded Resources</h3><div class="resource-grid">';
    
    userState.uploads.forEach((upload, index) => {
        const fileIcon = upload.type.startsWith('video/') ? 'fa-file-video' :
                       upload.type.startsWith('image/') ? 'fa-file-image' :
                       upload.type.includes('pdf') ? 'fa-file-pdf' :
                       upload.type.includes('word') ? 'fa-file-word' : 'fa-file';
        
        const isMedia = upload.type.startsWith('video/') || upload.type.startsWith('image/');
        
        html += `
            <div class="resource-card">
                <div class="upload-badge ${upload.public ? 'public' : 'private'}">
                    <i class="fas fa-${upload.public ? 'globe' : 'lock'}"></i>
                    ${upload.public ? 'Public' : 'Private'}
                </div>
                <h3><i class="fas ${fileIcon}"></i> ${upload.title}</h3>
                <div class="resource-meta">
                    <span>${upload.category || 'Document'}</span>
                    <span>${formatFileSize(upload.size)}</span>
                    <span>${new Date(upload.uploadedAt).toLocaleDateString()}</span>
                </div>
                <p>${upload.description || 'No description provided.'}</p>
                
                ${isMedia ? `
                    <div class="media-preview" style="margin: 10px 0; border-radius: 5px; overflow: hidden;">
                        ${upload.type.startsWith('video/') ? 
                            `<video style="width: 100%; max-height: 150px; cursor: pointer;" onclick="viewUploadedMedia('${upload.id}')">
                                <source src="${upload.base64Data}" type="${upload.type}">
                            </video>` : 
                            `<img src="${upload.base64Data}" style="width: 100%; max-height: 150px; object-fit: cover; cursor: pointer;" 
                                 onclick="viewUploadedMedia('${upload.id}')">`
                        }
                    </div>
                ` : ''}
                
                <div class="resource-actions" style="display: flex; gap: 8px; margin-top: 10px;">
                    <button onclick="viewUploadedMedia('${upload.id}')" class="btn ${isMedia ? 'btn-primary' : 'btn-outline'}">
                        <i class="fas fa-${isMedia ? 'play' : 'eye'}"></i> ${isMedia ? 'Play' : 'View'}
                    </button>
                    <a href="${upload.base64Data}" download="${upload.filename}" class="btn btn-outline">
                        <i class="fas fa-download"></i> Download
                    </a>
                    <button onclick="deleteUpload('${upload.id}')" class="btn btn-outline">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    uploadsTab.innerHTML = html;
}
</script>

<style>
/* Enhanced upload styles */
.media-preview video, .media-preview img {
    transition: transform 0.3s ease;
    border-radius: 5px;
    border: 1px solid #dee2e6;
}

.media-preview video:hover, .media-preview img:hover {
    transform: scale(1.02);
}

.upload-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    z-index: 2;
}

.upload-badge.public {
    background: var(--success);
    color: white;
}

.upload-badge.private {
    background: var(--dark-gray);
    color: white;
}

.resource-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.resource-actions .btn {
    flex: 1;
    min-width: 80px;
    text-align: center;
}

/* Hospital search styles */
.search-controls {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.filter-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 15px;
}

.filter-buttons .filter-btn {
    padding: 8px 16px;
    background: var(--light-gray);
    border: 2px solid var(--medium-gray);
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
}

.filter-buttons .filter-btn:hover,
.filter-buttons .filter-btn.active {
    background: var(--epic-purple);
    color: white;
    border-color: var(--epic-purple);
}

.specialty-list {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin: 10px 0;
}
</style>

<script>
// Initialize hospital search when hospitals tab is clicked
document.addEventListener('DOMContentLoaded', function() {
    const hospitalTab = document.querySelector('a[href="#hospitals"]');
    if (hospitalTab) {
        hospitalTab.addEventListener('click', function() {
            setTimeout(() => {
                if (document.getElementById('hospitals').classList.contains('active')) {
                    initializeHospitalSearch();
                }
            }, 100);
        });
    }
});

// Initialize hospital search
function initializeHospitalSearch() {
    const container = document.getElementById('hospital-list');
    if (!container) return;
    
    container.innerHTML = `
        <div class="hospital-search-interface">
            <div class="search-bar-container">
                <div class="search-input-group">
                    <i class="fas fa-search"></i>
                    <input type="text" id="us-hospital-search" placeholder="Search 50+ US hospitals by name, city, state, or specialty..." 
                           style="flex: 1; padding: 12px 15px 12px 45px; border: 2px solid var(--epic-purple); border-radius: 25px; font-size: 16px;">
                </div>
                <div class="search-filters">
                    <select id="state-filter" style="padding: 10px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <option value="">All States</option>
                        <option value="CA">California</option>
                        <option value="NY">New York</option>
                        <option value="TX">Texas</option>
                        <option value="FL">Florida</option>
                        <option value="MA">Massachusetts</option>
                        <option value="IL">Illinois</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="OH">Ohio</option>
                        <option value="MI">Michigan</option>
                        <option value="WA">Washington</option>
                    </select>
                    <select id="bed-filter" style="padding: 10px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <option value="">Any Size</option>
                        <option value="1000">Large (1000+ beds)</option>
                        <option value="500">Medium (500-999 beds)</option>
                        <option value="1">Small (1-499 beds)</option>
                    </select>
                    <select id="epic-filter" style="padding: 10px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <option value="">Any Epic Version</option>
                        <option value="2023">Epic 2023</option>
                        <option value="2022">Epic 2022</option>
                    </select>
                </div>
            </div>
            
            <div class="search-results-info">
                <div id="result-count">50+ US Hospitals Available</div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid"><i class="fas fa-th"></i> Grid</button>
                    <button class="view-btn" data-view="list"><i class="fas fa-list"></i> List</button>
                </div>
            </div>
            
            <div class="hospital-search-results" id="hospital-search-results-container">
                <!-- Results will load here -->
            </div>
        </div>
    `;
    
    // Load initial results
    loadHospitalSearchResults();
    
    // Add search event listeners
    const searchInput = document.getElementById('us-hospital-search');
    searchInput.addEventListener('input', debounce(loadHospitalSearchResults, 300));
    
    document.getElementById('state-filter').addEventListener('change', loadHospitalSearchResults);
    document.getElementById('bed-filter').addEventListener('change', loadHospitalSearchResults);
    document.getElementById('epic-filter').addEventListener('change', loadHospitalSearchResults);
}

// Debounce function for search
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Load hospital search results
function loadHospitalSearchResults() {
    const searchTerm = document.getElementById('us-hospital-search').value.toLowerCase();
    const stateFilter = document.getElementById('state-filter').value;
    const bedFilter = document.getElementById('bed-filter').value;
    const epicFilter = document.getElementById('epic-filter').value;
    
    let results = usHospitals;
    
    // Apply filters
    if (searchTerm) {
        results = results.filter(hospital => 
            hospital.name.toLowerCase().includes(searchTerm) ||
            hospital.city.toLowerCase().includes(searchTerm) ||
            hospital.state.toLowerCase().includes(searchTerm) ||
            hospital.specialties.some(spec => spec.toLowerCase().includes(searchTerm))
        );
    }
    
    if (stateFilter) {
        results = results.filter(hospital => hospital.state === stateFilter);
    }
    
    if (bedFilter) {
        const bedNum = parseInt(bedFilter);
        if (bedFilter === '1000') {
            results = results.filter(hospital => hospital.beds >= 1000);
        } else if (bedFilter === '500') {
            results = results.filter(hospital => hospital.beds >= 500 && hospital.beds < 1000);
        } else if (bedFilter === '1') {
            results = results.filter(hospital => hospital.beds < 500);
        }
    }
    
    if (epicFilter) {
        results = results.filter(hospital => hospital.epicVersion.includes(epicFilter));
    }
    
    displayHospitalSearchResultsUI(results);
}

// Display search results
function displayHospitalSearchResultsUI(hospitals) {
    const container = document.getElementById('hospital-search-results-container');
    const countElement = document.getElementById('result-count');
    
    if (!container) return;
    
    countElement.textContent = `${hospitals.length} hospitals found`;
    
    if (hospitals.length === 0) {
        container.innerHTML = `
            <div class="empty-search-results">
                <i class="fas fa-search" style="font-size: 48px; color: var(--epic-light-purple);"></i>
                <h3>No hospitals found</h3>
                <p>Try a different search term or adjust your filters</p>
            </div>
        `;
        return;
    }
    
    let html = '<div class="hospital-grid">';
    
    hospitals.forEach(hospital => {
        const isSaved = userState.savedItems.some(item => item.id === `hosp-${hospital.id}`);
        
        html += `
            <div class="hospital-card search-result">
                <div class="hospital-header">
                    <h3><i class="fas fa-hospital"></i> ${hospital.name}</h3>
                    <span class="hospital-location">${hospital.city}, ${hospital.state}</span>
                </div>
                
                <div class="hospital-stats">
                    <div class="stat">
                        <span class="stat-label">Beds</span>
                        <span class="stat-value">${hospital.beds.toLocaleString()}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Epic Version</span>
                        <span class="stat-value">${hospital.epicVersion}</span>
                    </div>
                </div>
                
                <div class="hospital-specialties">
                    <strong>Specialties:</strong>
                    <div class="specialty-tags">
                        ${hospital.specialties.map(spec => `<span class="specialty-tag">${spec}</span>`).join('')}
                    </div>
                </div>
                
                <div class="hospital-actions">
                    <button class="btn ${isSaved ? 'btn-success' : 'btn-outline'} save-hospital" 
                            data-id="${hospital.id}" 
                            onclick="toggleSaveHospital(this, ${hospital.id})">
                        <i class="fas fa-${isSaved ? 'check' : 'bookmark'}"></i>
                        ${isSaved ? 'Saved' : 'Save Hospital'}
                    </button>
                    <button class="btn btn-primary" onclick="viewHospitalDetails(${hospital.id})">
                        <i class="fas fa-info-circle"></i> Details
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

// Toggle save hospital
function toggleSaveHospital(button, hospitalId) {
    const hospital = usHospitals.find(h => h.id === hospitalId);
    if (!hospital) return;
    
    if (!userState.isPremium) {
        showNotification('Upgrade to Premium to save hospitals', 'warning');
        return;
    }
    
    const savedItemId = `hosp-${hospitalId}`;
    const existingIndex = userState.savedItems.findIndex(item => item.id === savedItemId);
    
    if (existingIndex >= 0) {
        // Remove from saved
        userState.savedItems.splice(existingIndex, 1);
        button.classList.remove('btn-success');
        button.classList.add('btn-outline');
        button.innerHTML = '<i class="fas fa-bookmark"></i> Save Hospital';
        showNotification('Hospital removed from saved', 'info');
    } else {
        // Add to saved
        const savedItem = {
            id: savedItemId,
            type: 'hospital',
            title: hospital.name,
            data: hospital,
            savedAt: new Date().toISOString(),
            notes: '',
            category: 'Saved Hospitals'
        };
        userState.savedItems.push(savedItem);
        button.classList.remove('btn-outline');
        button.classList.add('btn-success');
        button.innerHTML = '<i class="fas fa-check"></i> Saved';
        showNotification(`${hospital.name} saved to your profile!`, 'success');
    }
    
    saveToStorage();
    updateSavedContentDisplay();
}

// View hospital details
function viewHospitalDetails(hospitalId) {
    const hospital = usHospitals.find(h => h.id === hospitalId);
    if (!hospital) return;
    
    const modalHTML = `
        <div class="modal-overlay active" id="hospital-details-modal">
            <div class="modal" style="max-width: 700px;">
                <div class="modal-header">
                    <h2><i class="fas fa-hospital"></i> ${hospital.name}</h2>
                    <button class="modal-close" onclick="closeModal('hospital-details-modal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="hospital-details-grid">
                        <div class="detail-item">
                            <strong><i class="fas fa-map-marker-alt"></i> Location:</strong>
                            <span>${hospital.city}, ${hospital.state}</span>
                        </div>
                        <div class="detail-item">
                            <strong><i class="fas fa-bed"></i> Bed Capacity:</strong>
                            <span>${hospital.beds.toLocaleString()} beds</span>
                        </div>
                        <div class="detail-item">
                            <strong><i class="fas fa-code-branch"></i> Epic Version:</strong>
                            <span>${hospital.epicVersion}</span>
                        </div>
                        <div class="detail-item">
                            <strong><i class="fas fa-stethoscope"></i> Key Specialties:</strong>
                            <div class="specialty-list">
                                ${hospital.specialties.map(spec => `<span class="specialty-tag">${spec}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="hospital-resources">
                        <h3><i class="fas fa-folder-open"></i> Available Resources</h3>
                        <div class="resources-list">
                            <div class="resource-item">
                                <i class="fas fa-file-pdf"></i>
                                <span>${hospital.name} Epic Implementation Guide</span>
                                <button class="btn btn-sm btn-outline">Download</button>
                            </div>
                            <div class="resource-item">
                                <i class="fas fa-video"></i>
                                <span>${hospital.city} Go-Live Success Story</span>
                                <button class="btn btn-sm btn-outline">Watch</button>
                            </div>
                            <div class="resource-item">
                                <i class="fas fa-file-alt"></i>
                                <span>${hospital.state} Hospital Network Protocols</span>
                                <button class="btn btn-sm btn-outline">View</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button class="btn btn-primary" onclick="toggleSaveHospital(null, ${hospital.id}); closeModal('hospital-details-modal');">
                            <i class="fas fa-bookmark"></i> Save to Profile
                        </button>
                        <button class="btn btn-outline" onclick="closeModal('hospital-details-modal')">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const existingModal = document.getElementById('hospital-details-modal');
    if (existingModal) existingModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) modal.remove();
}
</script>

<style>
.hospital-search-interface {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.search-bar-container {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
}

.search-input-group {
    position: relative;
    display: flex;
    align-items: center;
}

.search-input-group i {
    position: absolute;
    left: 15px;
    color: var(--epic-purple);
}

.search-filters {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.search-filters select {
    padding: 10px 15px;
    border: 2px solid var(--epic-light-purple);
    border-radius: 8px;
    background: white;
    font-size: 14px;
    min-width: 150px;
}

.search-results-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 10px 0;
    border-bottom: 2px solid var(--light-gray);
}

.view-toggle {
    display: flex;
    gap: 5px;
}

.view-btn {
    padding: 8px 15px;
    background: var(--light-gray);
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.view-btn.active {
    background: var(--epic-purple);
    color: white;
}

.hospital-card.search-result {
    position: relative;
    transition: transform 0.3s ease;
}

.hospital-card.search-result:hover {
    transform: translateY(-5px);
}

.hospital-header {
    margin-bottom: 15px;
}

.hospital-location {
    color: var(--dark-gray);
    font-size: 14px;
}

.hospital-stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    margin: 15px 0;
    padding: 15px;
    background: var(--light-gray);
    border-radius: 8px;
}

.stat {
    text-align: center;
}

.stat-label {
    display: block;
    font-size: 12px;
    color: var(--dark-gray);
    margin-bottom: 5px;
}

.stat-value {
    display: block;
    font-size: 18px;
    font-weight: 600;
    color: var(--epic-purple);
}

.hospital-specialties {
    margin: 15px 0;
}

.specialty-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 8px;
}

.specialty-tag {
    background: var(--epic-light-bg);
    color: var(--epic-purple);
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
}

.empty-search-results {
    text-align: center;
    padding: 50px 20px;
    color: var(--dark-gray);
}

.hospital-details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin: 20px 0;
}

.detail-item {
    padding: 10px;
    background: var(--light-gray);
    border-radius: 5px;
}

.hospital-resources {
    margin: 25px 0;
    padding: 20px;
    background: var(--epic-light-bg);
    border-radius: 8px;
}

.resources-list {
    margin-top: 15px;
}

.resource-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 10px;
    background: white;
    margin: 8px 0;
    border-radius: 5px;
    border: 1px solid var(--medium-gray);
}

.modal-actions {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
    margin-top: 20px;
}
</style>

<!-- Training Simulator Modal -->
<div id="simulator-modal" class="modal-overlay">
    <div class="modal" style="max-width: 900px;">
        <div class="modal-header">
            <h2><i class="fas fa-laptop-medical"></i> Epic Training Simulator</h2>
            <button class="modal-close" onclick="closeSimulator()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="simulator-controls">
                <select id="sim-scenario">
                    <option value="">Select Training Scenario</option>
                    <option value="patient-admit">Patient Admission</option>
                    <option value="medication-order">Medication Order Entry</option>
                    <option value="clinical-doc">Clinical Documentation</option>
                    <option value="discharge">Discharge Process</option>
                    <option value="billing">Billing & Coding</option>
                </select>
                <select id="sim-role">
                    <option value="">Select User Role</option>
                    <option value="physician">Physician</option>
                    <option value="nurse">Nurse</option>
                    <option value="med-rec">Medical Records</option>
                    <option value="biller">Billing Specialist</option>
                </select>
                <button class="btn btn-primary" onclick="startSimulation()">
                    <i class="fas fa-play"></i> Start Simulation
                </button>
            </div>
            
            <div id="simulator-content" class="simulator-content" style="display: none;">
                <div class="simulator-step" id="step-1">
                    <h3>Step 1: Patient Lookup</h3>
                    <p>Enter patient MRN or search by name:</p>
                    <input type="text" class="sim-input" placeholder="MRN: 12345678">
                    <button class="btn btn-primary" onclick="nextStep(2)">Search</button>
                </div>
                <!-- More steps would be added dynamically -->
            </div>
            
            <div class="simulator-resources">
                <h4><i class="fas fa-lightbulb"></i> Pro Tips:</h4>
                <ul id="sim-tips"></ul>
            </div>
        </div>
    </div>
</div>

<script>
// Training Simulator
function openSimulator() {
    document.getElementById('simulator-modal').classList.add('active');
}

function closeSimulator() {
    document.getElementById('simulator-modal').classList.remove('active');
}

function startSimulation() {
    const scenario = document.getElementById('sim-scenario').value;
    const role = document.getElementById('sim-role').value;
    
    if (!scenario || !role) {
        showNotification('Please select both scenario and role', 'warning');
        return;
    }
    
    document.getElementById('simulator-content').style.display = 'block';
    loadSimulation(scenario, role);
}

function loadSimulation(scenario, role) {
    const tips = {
        'patient-admit': [
            'Always verify patient identity using two identifiers',
            'Check for existing records before creating new admission',
            'Verify insurance eligibility in real-time',
            'Use SmartTools for common admission diagnoses'
        ],
        'medication-order': [
            'Use BPA (Best Practice Alerts) for drug interactions',
            'Verify allergies before prescribing',
            'Use SmartPhrases for common medication orders',
            'Set appropriate start/stop dates for all medications'
        ]
    };
    
    const tipsList = document.getElementById('sim-tips');
    tipsList.innerHTML = '';
    (tips[scenario] || []).forEach(tip => {
        tipsList.innerHTML += `<li>${tip}</li>`;
    });
}
</script>

<!-- Go-Live Dashboard Widget -->
<div class="widget" style="background: linear-gradient(135deg, #4B286D, #7B52AB); color: white; padding: 20px; border-radius: 10px; margin: 20px 0;">
    <h3><i class="fas fa-calendar-check"></i> Go-Live Countdown</h3>
    <div id="countdown-timer" style="font-size: 32px; font-weight: bold; text-align: center; margin: 15px 0;">
        <div class="countdown-item">
            <span id="days">00</span>
            <small>Days</small>
        </div>
        <div class="countdown-item">
            <span id="hours">00</span>
            <small>Hours</small>
        </div>
        <div class="countdown-item">
            <span id="minutes">00</span>
            <small>Minutes</small>
        </div>
    </div>
    <div class="timeline">
        <div class="timeline-item completed">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <strong>Team Training Completed</strong>
                <small>â 100% trained</small>
            </div>
        </div>
        <div class="timeline-item current">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <strong>Dress Rehearsal</strong>
                <small>In progress</small>
            </div>
        </div>
        <div class="timeline-item">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <strong>Go-Live Day</strong>
                <small>Target: Jan 30, 2024</small>
            </div>
        </div>
    </div>
</div>

<script>
// Countdown Timer
function updateCountdown() {
    const targetDate = new Date('2024-01-30T08:00:00');
    const now = new Date();
    const diff = targetDate - now;
    
    if (diff > 0) {
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        
        document.getElementById('days').textContent = days.toString().padStart(2, '0');
        document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
        document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
    } else {
        document.getElementById('countdown-timer').innerHTML = '<div style="color: #FFD700;">ð Go-Live Complete!</div>';
    }
}

// Update every minute
setInterval(updateCountdown, 60000);
updateCountdown();
</script>

<style>
.countdown-item {
    display: inline-block;
    margin: 0 10px;
    text-align: center;
}

.countdown-item span {
    display: block;
    font-size: 48px;
    line-height: 1;
}

.timeline {
    margin-top: 20px;
    position: relative;
}

.timeline-item {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.timeline-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #ccc;
    margin-right: 10px;
    flex-shrink: 0;
}

.timeline-item.completed .timeline-dot {
    background: #28a745;
}

.timeline-item.current .timeline-dot {
    background: #FFD700;
    animation: pulse 1.5s infinite;
}

.timeline-content {
    flex: 1;
}
</style>

<!-- Certification Section in Profile -->
<div class="certification-tracker" style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px 0;">
    <h3><i class="fas fa-certificate"></i> Epic Certification Tracker</h3>
    <div class="cert-cards">
        <div class="cert-card completed">
            <div class="cert-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="cert-info">
                <h4>Epic Physician Trainer</h4>
                <p>Completed: Jan 2023</p>
                <p>Expires: Jan 2025</p>
            </div>
        </div>
        <div class="cert-card in-progress">
            <div class="cert-icon">
                <i class="fas fa-spinner"></i>
            </div>
            <div class="cert-info">
                <h4>Epic Beacon Oncology</h4>
                <p>Progress: 65%</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
            </div>
        </div>
        <div class="cert-card upcoming">
            <div class="cert-icon">
                <i class="fas fa-calendar"></i>
            </div>
            <div class="cert-info">
                <h4>Epic Radiant</h4>
                <p>Scheduled: Mar 2024</p>
                <button class="btn btn-sm btn-outline">Schedule</button>
            </div>
        </div>
    </div>
    
    <div class="cert-requirements">
        <h4><i class="fas fa-clipboard-list"></i> Certification Requirements</h4>
        <ul>
            <li><input type="checkbox" checked> Complete 40 hours of training</li>
            <li><input type="checkbox" checked> Pass proficiency exam (80%+)</li>
            <li><input type="checkbox"> Complete 3 supervised training sessions</li>
            <li><input type="checkbox"> Submit training portfolio</li>
        </ul>
    </div>
</div>

<style>
.cert-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.cert-card {
    padding: 15px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 15px;
    border: 2px solid transparent;
}

.cert-card.completed {
    background: #e8f5e9;
    border-color: #28a745;
}

.cert-card.in-progress {
    background: #e3f2fd;
    border-color: #2196f3;
}

.cert-card.upcoming {
    background: #fff3e0;
    border-color: #ff9800;
}

.cert-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
}

.completed .cert-icon {
    background: #28a745;
    color: white;
}

.in-progress .cert-icon {
    background: #2196f3;
    color: white;
}

.upcoming .cert-icon {
    background: #ff9800;
    color: white;
}

.progress-bar {
    height: 8px;
    background: #ddd;
    border-radius: 4px;
    margin-top: 8px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: #2196f3;
    transition: width 0.5s ease;
}

.cert-requirements ul {
    list-style: none;
    padding-left: 0;
}

.cert-requirements li {
    padding: 8px 0;
    display: flex;
    align-items: center;
    gap: 10px;
}
</style>

<!-- Staffing Calculator Modal -->
<div id="staffing-calculator" class="modal-overlay">
    <div class="modal" style="max-width: 800px;">
        <div class="modal-header">
            <h2><i class="fas fa-calculator"></i> Go-Live Staffing Calculator</h2>
            <button class="modal-close" onclick="closeStaffingCalculator()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="calculator-inputs">
                <div class="input-group">
                    <label><i class="fas fa-users"></i> Number of End Users:</label>
                    <input type="number" id="user-count" value="500" min="1" max="10000">
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-hospital"></i> Facility Type:</label>
                    <select id="facility-type">
                        <option value="acute">Acute Care Hospital</option>
                        <option value="ambulatory">Ambulatory/Clinic</option>
                        <option value="specialty">Specialty Hospital</option>
                        <option value="multi">Multi-Facility System</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label><i class="fas fa-procedures"></i> High-Acuity Areas:</label>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="has-ed" checked> Emergency Department</label>
                        <label><input type="checkbox" id="has-or" checked> Operating Rooms</label>
                        <label><input type="checkbox" id="has-icu" checked> Intensive Care Unit</label>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="calculateStaffing()" style="width: 100%; padding: 15px; margin: 20px 0;">
                <i class="fas fa-calculator"></i> Calculate Staffing Needs
            </button>
            
            <div id="staffing-results" style="display: none;">
                <h3><i class="fas fa-chart-pie"></i> Recommended Staffing</h3>
                <div class="results-grid">
                    <div class="result-card">
                        <h4>Tier 1 Support</h4>
                        <div class="result-value" id="tier1-count">0</div>
                        <p>At-the-elbow support (1:50 ratio)</p>
                    </div>
                    <div class="result-card">
                        <h4>Tier 2 Support</h4>
                        <div class="result-value" id="tier2-count">0</div>
                        <p>Command Center (1:100 ratio)</p>
                    </div>
                    <div class="result-card">
                        <h4>Tier 3 Support</h4>
                        <div class="result-value" id="tier3-count">0</div>
                        <p>Analyst/Builder (1:200 ratio)</p>
                    </div>
                    <div class="result-card">
                        <h4>Total Staff</h4>
                        <div class="result-value" id="total-staff">0</div>
                        <p>Required for successful go-live</p>
                    </div>
                </div>
                
                <div class="recommendations">
                    <h4><i class="fas fa-lightbulb"></i> Recommendations:</h4>
                    <ul id="staffing-recommendations"></ul>
                </div>
                
                <button class="btn btn-outline" onclick="exportStaffingPlan()">
                    <i class="fas fa-download"></i> Export Staffing Plan
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function openStaffingCalculator() {
    document.getElementById('staffing-calculator').classList.add('active');
}

function closeStaffingCalculator() {
    document.getElementById('staffing-calculator').classList.remove('active');
}

function calculateStaffing() {
    const userCount = parseInt(document.getElementById('user-count').value) || 500;
    const facilityType = document.getElementById('facility-type').value;
    const hasED = document.getElementById('has-ed').checked;
    const hasOR = document.getElementById('has-or').checked;
    const hasICU = document.getElementById('has-icu').checked;
    
    // Base ratios
    let tier1Ratio = 50;  // 1:50
    let tier2Ratio = 100; // 1:100
    let tier3Ratio = 200; // 1:200
    
    // Adjust for high-acuity areas
    let highAcuityMultiplier = 1.0;
    if (hasED || hasOR || hasICU) {
        highAcuityMultiplier = 1.3; // Increase staffing by 30%
    }
    
    // Adjust for facility type
    if (facilityType === 'ambulatory') {
        tier1Ratio = 75; // Less intensive support
    } else if (facilityType === 'multi') {
        highAcuityMultiplier *= 1.2; // Additional complexity
    }
    
    // Calculate staffing
    const tier1Count = Math.ceil((userCount / tier1Ratio) * highAcuityMultiplier);
    const tier2Count = Math.ceil((userCount / tier2Ratio) * highAcuityMultiplier);
    const tier3Count = Math.ceil((userCount / tier3Ratio) * highAcuityMultiplier);
    const totalStaff = tier1Count + tier2Count + tier3Count;
    
    // Update UI
    document.getElementById('tier1-count').textContent = tier1Count;
    document.getElementById('tier2-count').textContent = tier2Count;
    document.getElementById('tier3-count').textContent = tier3Count;
    document.getElementById('total-staff').textContent = totalStaff;
    
    // Generate recommendations
    const recommendations = [
        `Schedule staff in 12-hour shifts for 24/7 coverage`,
        `Ensure 2:1 ratio of clinical to technical support staff`,
        `Plan for 20% contingency coverage for unexpected absences`
    ];
    
    if (hasED) {
        recommendations.push('Increase ED support ratio to 1:25 during peak hours');
    }
    
    if (hasICU) {
        recommendations.push('Assign dedicated ICU support with critical care experience');
    }
    
    const recList = document.getElementById('staffing-recommendations');
    recList.innerHTML = '';
    recommendations.forEach(rec => {
        recList.innerHTML += `<li>${rec}</li>`;
    });
    
    document.getElementById('staffing-results').style.display = 'block';
}

function exportStaffingPlan() {
    const plan = {
        userCount: document.getElementById('user-count').value,
        tier1: document.getElementById('tier1-count').textContent,
        tier2: document.getElementById('tier2-count').textContent,
        tier3: document.getElementById('tier3-count').textContent,
        total: document.getElementById('total-staff').textContent,
        timestamp: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(plan, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const exportFileDefaultName = `staffing-plan-${new Date().toISOString().split('T')[0]}.json`;
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
    
    showNotification('Staffing plan exported successfully!', 'success');
}
</script>

<style>
.calculator-inputs {
    display: grid;
    gap: 20px;
}

.input-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.input-group label {
    font-weight: 600;
    color: var(--epic-purple);
}

.input-group input, .input-group select {
    padding: 10px;
    border: 2px solid #dee2e6;
    border-radius: 6px;
    font-size: 16px;
}

.checkbox-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 5px;
    font-weight: normal;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.result-card {
    background: var(--light-gray);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    border-top: 4px solid var(--epic-purple);
}

.result-value {
    font-size: 32px;
    font-weight: bold;
    color: var(--epic-purple);
    margin: 10px 0;
}

.recommendations {
    background: #e8f4fd;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
}

.recommendations ul {
    margin: 10px 0 0 20px;
    color: #555;
}
</style>

<!-- Analytics Dashboard in Premium -->
<div class="analytics-dashboard" style="background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px 0;">
    <h3><i class="fas fa-chart-line"></i> Training Analytics</h3>
    
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-header">
                <i class="fas fa-user-graduate" style="color: #4B286D;"></i>
                <h4>Training Completion</h4>
            </div>
            <div class="metric-value">92%</div>
            <div class="metric-progress">
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 92%"></div>
                </div>
            </div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <i class="fas fa-clock" style="color: #28a745;"></i>
                <h4>Avg. Training Time</h4>
            </div>
            <div class="metric-value">4.2 hrs</div>
            <div class="metric-trend up">â 12% from last month</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <i class="fas fa-star" style="color: #FFD700;"></i>
                <h4>User Satisfaction</h4>
            </div>
            <div class="metric-value">4.7/5.0</div>
            <div class="metric-trend up">â 0.3 from baseline</div>
        </div>
        
        <div class="metric-card">
            <div class="metric-header">
                <i class="fas fa-question-circle" style="color: #dc3545;"></i>
                <h4>Support Tickets</h4>
            </div>
            <div class="metric-value">42</div>
            <div class="metric-trend down">â 18% from last week</div>
        </div>
    </div>
    
    <div class="chart-container">
        <h4><i class="fas fa-chart-bar"></i> Training Progress by Department</h4>
        <div class="chart" style="height: 200px; margin: 20px 0; display: flex; align-items: flex-end; gap: 10px;">
            <div class="chart-bar" style="height: 85%; background: #4B286D;" title="Nursing: 85%">
                <span>Nursing</span>
            </div>
            <div class="chart-bar" style="height: 72%; background: #7B52AB;" title="Physicians: 72%">
                <span>Physicians</span>
            </div>
            <div class="chart-bar" style="height: 95%; background: #28a745;" title="Ancillary: 95%">
                <span>Ancillary</span>
            </div>
            <div class="chart-bar" style="height: 68%; background: #ffc107;" title="ED: 68%">
                <span>ED</span>
            </div>
            <div class="chart-bar" style="height: 88%; background: #17a2b8;" title="OR: 88%">
                <span>OR</span>
            </div>
        </div>
    </div>
    
    <div class="data-export">
        <button class="btn btn-outline" onclick="exportAnalytics()">
            <i class="fas fa-download"></i> Export Analytics Report
        </button>
        <button class="btn btn-primary" onclick="scheduleReport()">
            <i class="fas fa-calendar-alt"></i> Schedule Weekly Report
        </button>
    </div>
</div>

<script>
function exportAnalytics() {
    const report = {
        generated: new Date().toISOString(),
        metrics: {
            completionRate: "92%",
            avgTrainingTime: "4.2 hours",
            satisfaction: "4.7/5.0",
            supportTickets: 42
        },
        departments: {
            nursing: "85%",
            physicians: "72%",
            ancillary: "95%",
            ed: "68%",
            or: "88%"
        }
    };
    
    const csv = `Metric,Value\nTraining Completion,92%\nAvg Training Time,4.2 hrs\nUser Satisfaction,4.7/5.0\nSupport Tickets,42\n\nDepartment,Completion\nNursing,85%\nPhysicians,72%\nAncillary,95%\nED,68%\nOR,88%`;
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `training-analytics-${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    
    showNotification('Analytics report exported as CSV', 'success');
}

function scheduleReport() {
    showNotification('Weekly analytics report scheduled for Monday mornings', 'info');
}
</script>

<style>
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.metric-card {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid #4B286D;
}

.metric-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.metric-header h4 {
    margin: 0;
    font-size: 14px;
    color: #666;
}

.metric-value {
    font-size: 28px;
    font-weight: bold;
    color: #333;
    margin: 5px 0;
}

.metric-trend {
    font-size: 12px;
    margin-top: 5px;
}

.metric-trend.up {
    color: #28a745;
}

.metric-trend.down {
    color: #dc3545;
}

.chart-bar {
    flex: 1;
    position: relative;
    border-radius: 4px 4px 0 0;
    min-width: 60px;
    text-align: center;
    padding-top: 10px;
    color: white;
    font-weight: bold;
}

.chart-bar span {
    position: absolute;
    bottom: -25px;
    left: 0;
    right: 0;
    color: #333;
    font-size: 12px;
}

.data-export {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}
</style>
// ==================== COMPLETE MEDIA HANDLING SYSTEM ====================

// Store media files as Blob URLs for better performance
const mediaCache = new Map();

// Convert file to Blob URL for efficient storage and playback
function fileToBlobURL(file) {
    return new Promise((resolve, reject) => {
        try {
            // Create blob URL for immediate use
            const blobURL = URL.createObjectURL(file);
            
            // Also store as base64 for localStorage
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result;
                const mediaInfo = {
                    blobURL: blobURL,
                    base64Data: base64Data,
                    type: file.type,
                    size: file.size,
                    name: file.name,
                    lastAccessed: Date.now()
                };
                
                // Cache the media info
                const cacheKey = 'media_' + Date.now() + '_' + file.name;
                mediaCache.set(cacheKey, mediaInfo);
                
                // Clean up old cache entries if needed
                cleanupMediaCache();
                
                resolve({
                    cacheKey: cacheKey,
                    blobURL: blobURL,
                    base64Data: base64Data,
                    type: file.type,
                    size: file.size,
                    name: file.name
                });
            };
            
            reader.onerror = reject;
            reader.readAsDataURL(file);
        } catch (error) {
            reject(error);
        }
    });
}

// Clean up old media cache entries to prevent memory issues
function cleanupMediaCache() {
    const maxCacheSize = 50; // Keep last 50 items
    if (mediaCache.size > maxCacheSize) {
        const entries = Array.from(mediaCache.entries());
        // Sort by last accessed time
        entries.sort((a, b) => a[1].lastAccessed - b[1].lastAccessed);
        // Remove oldest entries
        entries.slice(0, mediaCache.size - maxCacheSize).forEach(([key]) => {
            URL.revokeObjectURL(mediaCache.get(key).blobURL);
            mediaCache.delete(key);
        });
    }
}

// Get media URL for playback/download
function getMediaURL(cacheKey) {
    const mediaInfo = mediaCache.get(cacheKey);
    if (mediaInfo) {
        mediaInfo.lastAccessed = Date.now();
        return mediaInfo.blobURL;
    }
    return null;
}

// Enhanced upload with progress tracking
async function handleFileUploadWithProgress() {
    const fileInput = document.getElementById('file-input');
    const title = document.getElementById('doc-title').value;
    const description = document.getElementById('doc-description').value;
    const category = document.getElementById('doc-category').value;
    
    if (!title.trim()) {
        showNotification('Please enter a document title', 'warning');
        return;
    }
    
    if (fileInput.files.length === 0) {
        showNotification('Please select a file to upload', 'warning');
        return;
    }
    
    const file = fileInput.files[0];
    const maxSize = 25 * 1024 * 1024; // 25MB limit for better video support
    
    if (file.size > maxSize) {
        showNotification(`File size exceeds ${formatFileSize(maxSize)} limit`, 'error');
        return;
    }
    
    // Create progress UI
    const uploadBtn = document.getElementById('start-upload-btn');
    const originalHTML = uploadBtn.innerHTML;
    
    uploadBtn.innerHTML = `
        <div style="width: 100%; background: #e9ecef; border-radius: 4px; overflow: hidden;">
            <div id="upload-progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #4B286D, #7B52AB); transition: width 0.3s; text-align: center; color: white; font-size: 12px; line-height: 30px;">
                0%
            </div>
        </div>
    `;
    uploadBtn.disabled = true;
    
    try {
        // Simulate progress for better UX
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += 5;
            if (progress > 90) clearInterval(progressInterval);
            const progressBar = document.getElementById('upload-progress-bar');
            if (progressBar) {
                progressBar.style.width = progress + '%';
                progressBar.textContent = progress + '%';
            }
        }, 100);
        
        // Process the file
        const mediaData = await fileToBlobURL(file);
        
        clearInterval(progressInterval);
        
        // Complete progress bar
        const progressBar = document.getElementById('upload-progress-bar');
        if (progressBar) {
            progressBar.style.width = '100%';
            progressBar.textContent = 'Processing...';
        }
        
        // Create upload record
        const newUpload = {
            id: 'upload-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9),
            title: title,
            description: description,
            category: category,
            filename: file.name,
            size: file.size,
            type: file.type,
            cacheKey: mediaData.cacheKey,
            base64Data: mediaData.base64Data, // Store for persistence
            uploadedAt: new Date().toISOString(),
            public: document.getElementById('doc-public').checked,
            tags: document.getElementById('doc-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag),
            hospital: document.getElementById('doc-hospital').value,
            metadata: {
                duration: null, // Will be populated for videos
                dimensions: null, // Will be populated for images
                pages: null // Will be populated for PDFs
            }
        };
        
        // Get metadata for media files
        if (file.type.startsWith('video/')) {
            try {
                const video = document.createElement('video');
                video.preload = 'metadata';
                video.onloadedmetadata = function() {
                    newUpload.metadata.duration = Math.round(video.duration);
                    newUpload.metadata.dimensions = {
                        width: video.videoWidth,
                        height: video.videoHeight
                    };
                    saveUploadAndClose(newUpload);
                };
                video.src = mediaData.blobURL;
            } catch (e) {
                saveUploadAndClose(newUpload);
            }
        } else if (file.type.startsWith('image/')) {
            const img = new Image();
            img.onload = function() {
                newUpload.metadata.dimensions = {
                    width: img.width,
                    height: img.height
                };
                saveUploadAndClose(newUpload);
            };
            img.src = mediaData.blobURL;
            setTimeout(() => saveUploadAndClose(newUpload), 1000); // Fallback
        } else {
            saveUploadAndClose(newUpload);
        }
        
    } catch (error) {
        console.error('Upload error:', error);
        showNotification('Upload failed: ' + error.message, 'error');
        uploadBtn.innerHTML = originalHTML;
        uploadBtn.disabled = false;
    }
}

// Save upload and close modal
function saveUploadAndClose(upload) {
    // Store in userState
    userState.uploads.push(upload);
    saveToStorage();
    
    showNotification(`"${upload.title}" uploaded successfully!`, 'success');
    
    // Close modal and reset
    document.getElementById('upload-modal').classList.remove('active');
    resetUploadForm();
    
    // Update display
    updateUploadsDisplay();
    
    // Reset upload button
    const uploadBtn = document.getElementById('start-upload-btn');
    uploadBtn.innerHTML = '<i class="fas fa-upload"></i> Upload Document';
    uploadBtn.disabled = false;
}

// Advanced media viewer with full controls
function openAdvancedMediaViewer(uploadId) {
    const upload = userState.uploads.find(u => u.id === uploadId);
    if (!upload) {
        showNotification('File not found', 'error');
        return;
    }
    
    const mediaURL = getMediaURL(upload.cacheKey) || upload.base64Data;
    
    // Create advanced viewer modal
    const modalHTML = `
        <div class="modal-overlay active" id="advanced-media-viewer">
            <div class="modal" style="max-width: 90vw; max-height: 90vh; width: 90vw; height: 90vh;">
                <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
                        <i class="fas ${getFileIcon(upload.type)}"></i>
                        <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                            ${upload.title}
                        </span>
                    </h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <button onclick="downloadMedia('${uploadId}')" class="btn btn-sm btn-primary" title="Download">
                            <i class="fas fa-download"></i>
                        </button>
                        <button onclick="shareMedia('${uploadId}')" class="btn btn-sm btn-outline" title="Share">
                            <i class="fas fa-share"></i>
                        </button>
                        <button onclick="closeAdvancedViewer()" class="modal-close">&times;</button>
                    </div>
                </div>
                
                <div class="modal-body" style="flex: 1; display: flex; flex-direction: column; overflow: hidden; padding: 0;">
                    ${renderMediaContent(upload, mediaURL)}
                </div>
                
                <div class="modal-footer" style="padding: 15px; border-top: 1px solid #dee2e6; background: #f8f9fa;">
                    <div style="display: flex; justify-content: space-between; align-items: center; font-size: 14px;">
                        <div>
                            <strong>Type:</strong> ${upload.type} | 
                            <strong>Size:</strong> ${formatFileSize(upload.size)} | 
                            <strong>Uploaded:</strong> ${new Date(upload.uploadedAt).toLocaleDateString()}
                            ${upload.metadata.duration ? ` | <strong>Duration:</strong> ${formatDuration(upload.metadata.duration)}` : ''}
                        </div>
                        <div>
                            <button onclick="deleteUpload('${uploadId}', true)" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal
    const existingModal = document.getElementById('advanced-media-viewer');
    if (existingModal) existingModal.remove();
    
    // Add new modal
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    // Initialize media player if video
    if (upload.type.startsWith('video/')) {
        setTimeout(() => {
            const video = document.querySelector('#advanced-media-viewer video');
            if (video) {
                video.controls = true;
                video.controlsList = 'nodownload';
                
                // Add custom controls enhancement
                enhanceVideoPlayer(video, upload);
            }
        }, 100);
    }
}

// Render appropriate media content
function renderMediaContent(upload, mediaURL) {
    if (upload.type.startsWith('video/')) {
        return `
            <div style="flex: 1; display: flex; align-items: center; justify-content: center; background: #000;">
                <video id="media-player" 
                       style="max-width: 100%; max-height: 100%;"
                       controls
                       playsinline
                       preload="metadata">
                    <source src="${mediaURL}" type="${upload.type}">
                    Your browser does not support the video tag.
                </video>
            </div>
        `;
    } else if (upload.type.startsWith('image/')) {
        return `
            <div style="flex: 1; display: flex; align-items: center; justify-content: center; background: #f8f9fa; overflow: auto;">
                <img src="${mediaURL}" 
                     alt="${upload.title}"
                     style="max-width: 100%; max-height: 100%; object-fit: contain; cursor: zoom-in;"
                     onclick="toggleImageZoom(this)">
                <div class="image-zoom-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10002; cursor: zoom-out; align-items: center; justify-content: center;">
                    <img src="${mediaURL}" style="max-width: 95vw; max-height: 95vh;">
                </div>
            </div>
        `;
    } else if (upload.type.includes('pdf')) {
        return `
            <div style="flex: 1; display: flex; flex-direction: column; background: #f8f9fa;">
                <div style="padding: 15px; background: white; border-bottom: 1px solid #dee2e6;">
                    <strong>PDF Preview:</strong> ${upload.filename}
                </div>
                <iframe src="${mediaURL}" 
                        style="flex: 1; border: none;"
                        title="${upload.title}">
                </iframe>
            </div>
        `;
    } else {
        return `
            <div style="flex: 1; display: flex; align-items: center; justify-content: center; background: #f8f9fa;">
                <div style="text-align: center; padding: 40px;">
                    <i class="fas fa-file" style="font-size: 64px; color: #4B286D; margin-bottom: 20px;"></i>
                    <h3>${upload.title}</h3>
                    <p>${upload.description || 'No description available'}</p>
                    <p><strong>File type:</strong> ${upload.type}</p>
                    <a href="${mediaURL}" download="${upload.filename}" class="btn btn-primary btn-lg">
                        <i class="fas fa-download"></i> Download File (${formatFileSize(upload.size)})
                    </a>
                </div>
            </div>
        `;
    }
}

// Enhance video player with additional features
function enhanceVideoPlayer(videoElement, upload) {
    // Add download button to controls
    const downloadBtn = document.createElement('button');
    downloadBtn.className = 'video-download-btn';
    downloadBtn.innerHTML = '<i class="fas fa-download"></i>';
    downloadBtn.title = 'Download video';
    downloadBtn.style.cssText = `
        background: rgba(0,0,0,0.7);
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px;
        margin-left: 10px;
        cursor: pointer;
    `;
    downloadBtn.onclick = () => downloadMedia(upload.id);
    
    // Wait for controls to be available
    setTimeout(() => {
        const controls = videoElement.parentElement.querySelector('.video-controls') || 
                        videoElement.parentElement;
        if (controls) {
            controls.appendChild(downloadBtn);
        }
    }, 500);
    
    // Add keyboard shortcuts
    videoElement.addEventListener('keydown', (e) => {
        switch(e.key) {
            case ' ':
            case 'k':
                e.preventDefault();
                videoElement.paused ? videoElement.play() : videoElement.pause();
                break;
            case 'f':
                e.preventDefault();
                if (videoElement.requestFullscreen) {
                    videoElement.requestFullscreen();
                }
                break;
            case 'm':
                e.preventDefault();
                videoElement.muted = !videoElement.muted;
                break;
            case 'ArrowRight':
                e.preventDefault();
                videoElement.currentTime += 10;
                break;
            case 'ArrowLeft':
                e.preventDefault();
                videoElement.currentTime -= 10;
                break;
        }
    });
}

// Toggle image zoom
function toggleImageZoom(imgElement) {
    const overlay = imgElement.nextElementSibling;
    if (overlay && overlay.classList.contains('image-zoom-overlay')) {
        overlay.style.display = overlay.style.display === 'flex' ? 'none' : 'flex';
    }
}

// Download media file
function downloadMedia(uploadId) {
    const upload = userState.uploads.find(u => u.id === uploadId);
    if (!upload) {
        showNotification('File not found', 'error');
        return;
    }
    
    const mediaURL = getMediaURL(upload.cacheKey) || upload.base64Data;
    
    // Create download link
    const a = document.createElement('a');
    a.href = mediaURL;
    a.download = upload.filename;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    
    showNotification(`Downloading "${upload.title}"...`, 'info');
}

// Share media
function shareMedia(uploadId) {
    const upload = userState.uploads.find(u => u.id === uploadId);
    if (!upload) return;
    
    const shareData = {
        title: upload.title,
        text: upload.description || `Epic Trainer Resource: ${upload.title}`,
        url: window.location.href + '?resource=' + uploadId
    };
    
    if (navigator.share && navigator.canShare(shareData)) {
        navigator.share(shareData).catch(console.error);
    } else {
        // Copy to clipboard
        const text = `${upload.title}\n\n${upload.description || ''}\n\nAccess this resource in Epic Trainer Assistant`;
        navigator.clipboard.writeText(text).then(() => {
            showNotification('Resource information copied to clipboard!', 'success');
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showNotification('Resource information copied to clipboard!', 'success');
        });
    }
}

// Close advanced viewer
function closeAdvancedViewer() {
    const modal = document.getElementById('advanced-media-viewer');
    if (modal) {
        // Revoke blob URLs to free memory
        const videos = modal.querySelectorAll('video');
        videos.forEach(video => {
            if (video.src && video.src.startsWith('blob:')) {
                URL.revokeObjectURL(video.src);
            }
        });
        modal.remove();
    }
}

// Format duration in MM:SS
function formatDuration(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// Get appropriate file icon
function getFileIcon(fileType) {
    if (fileType.startsWith('video/')) return 'fa-file-video';
    if (fileType.startsWith('audio/')) return 'fa-file-audio';
    if (fileType.startsWith('image/')) return 'fa-file-image';
    if (fileType.includes('pdf')) return 'fa-file-pdf';
    if (fileType.includes('word')) return 'fa-file-word';
    if (fileType.includes('excel')) return 'fa-file-excel';
    if (fileType.includes('powerpoint')) return 'fa-file-powerpoint';
    if (fileType.includes('zip') || fileType.includes('compressed')) return 'fa-file-archive';
    return 'fa-file';
}

// Delete upload with confirmation
function deleteUpload(uploadId, fromViewer = false) {
    const upload = userState.uploads.find(u => u.id === uploadId);
    if (!upload) return;
    
    if (confirm(`Are you sure you want to delete "${upload.title}"?`)) {
        // Remove from storage
        userState.uploads = userState.uploads.filter(u => u.id !== uploadId);
        saveToStorage();
        
        // Revoke blob URL if cached
        if (upload.cacheKey && mediaCache.has(upload.cacheKey)) {
            const mediaInfo = mediaCache.get(upload.cacheKey);
            URL.revokeObjectURL(mediaInfo.blobURL);
            mediaCache.delete(upload.cacheKey);
        }
        
        showNotification('Upload deleted', 'info');
        
        if (fromViewer) {
            closeAdvancedViewer();
        }
        
        updateUploadsDisplay();
    }
}

// Update uploads display with enhanced previews
function updateUploadsDisplay() {
    const uploadsTab = document.getElementById('uploads-tab');
    if (!uploadsTab) return;
    
    if (userState.uploads.length === 0) {
        uploadsTab.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-cloud-upload-alt" style="font-size: 64px; color: var(--epic-light-purple); margin-bottom: 20px;"></i>
                <h3>No Uploads Yet</h3>
                <p>Upload training videos, documents, or images to get started</p>
                <button class="btn btn-primary" onclick="document.getElementById('upload-modal').classList.add('active')">
                    <i class="fas fa-upload"></i> Upload Your First Resource
                </button>
            </div>
        `;
        return;
    }
    
    let html = `
        <div class="uploads-header">
            <h3>My Uploaded Resources (${userState.uploads.length})</h3>
            <div class="upload-filters">
                <select id="upload-type-filter" onchange="filterUploads()">
                    <option value="all">All Types</option>
                    <option value="video">Videos</option>
                    <option value="image">Images</option>
                    <option value="document">Documents</option>
                    <option value="other">Other</option>
                </select>
                <select id="upload-sort" onchange="sortUploads()">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="name">Name A-Z</option>
                    <option value="size">Size (Largest)</option>
                </select>
            </div>
        </div>
        <div class="uploads-grid" id="uploads-grid-container">
    `;
    
    // Sort by newest first by default
    const sortedUploads = [...userState.uploads].sort((a, b) => 
        new Date(b.uploadedAt) - new Date(a.uploadedAt)
    );
    
    sortedUploads.forEach((upload, index) => {
        const fileIcon = getFileIcon(upload.type);
        const isVideo = upload.type.startsWith('video/');
        const isImage = upload.type.startsWith('image/');
        const isPDF = upload.type.includes('pdf');
        
        html += `
            <div class="upload-card" data-type="${isVideo ? 'video' : isImage ? 'image' : isPDF ? 'document' : 'other'}">
                <div class="upload-card-header">
                    <div class="upload-type-icon">
                        <i class="fas ${fileIcon}"></i>
                    </div>
                    <div class="upload-info">
                        <h4 title="${upload.title}">${upload.title}</h4>
                        <div class="upload-meta">
                            <span>${formatFileSize(upload.size)}</span>
                            <span>â¢</span>
                            <span>${new Date(upload.uploadedAt).toLocaleDateString()}</span>
                            ${upload.metadata.duration ? `<span>â¢</span><span>${formatDuration(upload.metadata.duration)}</span>` : ''}
                        </div>
                    </div>
                    <div class="upload-actions">
                        <button onclick="downloadMedia('${upload.id}')" class="btn-icon" title="Download">
                            <i class="fas fa-download"></i>
                        </button>
                        <button onclick="deleteUpload('${upload.id}')" class="btn-icon" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="upload-preview">
                    ${isVideo ? `
                        <div class="video-preview" onclick="openAdvancedMediaViewer('${upload.id}')">
                            <video muted preload="metadata">
                                <source src="${getMediaURL(upload.cacheKey) || upload.base64Data}" type="${upload.type}">
                            </video>
                            <div class="play-button">
                                <i class="fas fa-play"></i>
                            </div>
                            <div class="video-duration">
                                ${upload.metadata.duration ? formatDuration(upload.metadata.duration) : ''}
                            </div>
                        </div>
                    ` : isImage ? `
                        <div class="image-preview" onclick="openAdvancedMediaViewer('${upload.id}')">
                            <img src="${getMediaURL(upload.cacheKey) || upload.base64Data}" 
                                 alt="${upload.title}"
                                 loading="lazy">
                            <div class="image-overlay">
                                <i class="fas fa-expand"></i>
                            </div>
                        </div>
                    ` : `
                        <div class="document-preview" onclick="openAdvancedMediaViewer('${upload.id}')">
                            <div class="document-icon">
                                <i class="fas ${fileIcon} fa-3x"></i>
                            </div>
                            <div class="document-info">
                                <p>${upload.description || 'Click to view/download'}</p>
                                <button class="btn btn-outline btn-sm">
                                    <i class="fas fa-external-link-alt"></i> Open
                                </button>
                            </div>
                        </div>
                    `}
                </div>
                
                <div class="upload-footer">
                    <div class="upload-tags">
                        ${upload.tags && upload.tags.length > 0 ? 
                            upload.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : 
                            '<span class="no-tags">No tags</span>'}
                    </div>
                    <button onclick="openAdvancedMediaViewer('${upload.id}')" class="btn btn-primary btn-sm">
                        <i class="fas fa-${isVideo ? 'play' : isImage ? 'image' : 'eye'}"></i>
                        ${isVideo ? 'Play' : isImage ? 'View' : 'Open'}
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    uploadsTab.innerHTML = html;
    
    // Add hover effects for video previews
    setTimeout(() => {
        document.querySelectorAll('.video-preview video').forEach(video => {
            video.addEventListener('mouseenter', function() {
                this.play().catch(e => console.log('Autoplay prevented:', e));
            });
            video.addEventListener('mouseleave', function() {
                this.pause();
                this.currentTime = 0;
            });
        });
    }, 100);
}

// Filter uploads by type
function filterUploads() {
    const filter = document.getElementById('upload-type-filter').value;
    const cards = document.querySelectorAll('.upload-card');
    
    cards.forEach(card => {
        if (filter === 'all' || card.dataset.type === filter) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}

// Sort uploads
function sortUploads() {
    const sortBy = document.getElementById('upload-sort').value;
    let sorted = [...userState.uploads];
    
    switch(sortBy) {
        case 'newest':
            sorted.sort((a, b) => new Date(b.uploadedAt) - new Date(a.uploadedAt));
            break;
        case 'oldest':
            sorted.sort((a, b) => new Date(a.uploadedAt) - new Date(b.uploadedAt));
            break;
        case 'name':
            sorted.sort((a, b) => a.title.localeCompare(b.title));
            break;
        case 'size':
            sorted.sort((a, b) => b.size - a.size);
            break;
    }
    
    userState.uploads = sorted;
    saveToStorage();
    updateUploadsDisplay();
}

// Initialize media system on page load
function initializeMediaSystem() {
    // Convert existing base64 uploads to blob URLs
    userState.uploads.forEach((upload, index) => {
        if (upload.base64Data && !upload.cacheKey) {
            try {
                // Create blob from base64
                const byteCharacters = atob(upload.base64Data.split(',')[1]);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], {type: upload.type});
                const blobURL = URL.createObjectURL(blob);
                
                // Update upload with cache key
                const cacheKey = 'media_' + upload.uploadedAt + '_' + upload.filename;
                upload.cacheKey = cacheKey;
                
                // Cache the blob URL
                mediaCache.set(cacheKey, {
                    blobURL: blobURL,
                    base64Data: upload.base64Data,
                    type: upload.type,
                    size: upload.size,
                    name: upload.filename,
                    lastAccessed: Date.now()
                });
            } catch (e) {
                console.warn('Failed to convert upload to blob:', upload.title, e);
            }
        }
    });
    
    saveToStorage();
    console.log('Media system initialized with', userState.uploads.length, 'uploads');
}

<style>
/* Enhanced upload modal styles */
#upload-modal .modal {
    max-width: 700px;
    max-height: 90vh;
    overflow-y: auto;
}

.file-upload-area {
    border: 3px dashed #4B286D;
    border-radius: 15px;
    padding: 40px 20px;
    text-align: center;
    background: #f8f9fa;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.file-upload-area:hover {
    background: #e9ecef;
    border-color: #7B52AB;
}

.file-upload-area.drag-over {
    background: #e3f2fd;
    border-color: #2196f3;
    transform: scale(1.02);
}

.file-upload-area i {
    font-size: 64px;
    color: #4B286D;
    margin-bottom: 20px;
}

.file-upload-area p {
    margin: 10px 0;
    color: #495057;
}

.file-preview-container {
    display: none;
    margin-top: 20px;
    padding: 20px;
    background: white;
    border-radius: 10px;
    border: 1px solid #dee2e6;
}

.file-preview {
    display: flex;
    align-items: center;
    gap: 15px;
}

.file-icon {
    font-size: 48px;
    color: #4B286D;
}

.file-info h4 {
    margin: 0 0 5px 0;
    color: #343a40;
}

.file-info p {
    margin: 0;
    color: #6c757d;
    font-size: 14px;
}

.file-progress {
    width: 100%;
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 10px;
}

.file-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #4B286D, #7B52AB);
    transition: width 0.3s ease;
    width: 0%;
}

.supported-formats {
    font-size: 12px;
    color: #6c757d;
    margin-top: 10px;
}

/* Upload cards grid */
.uploads-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.upload-card {
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid #dee2e6;
}

.upload-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.upload-card-header {
    display: flex;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid #dee2e6;
    background: #f8f9fa;
}

.upload-type-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #4B286D, #7B52AB);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
    margin-right: 12px;
}

.upload-info {
    flex: 1;
    min-width: 0;
}

.upload-info h4 {
    margin: 0;
    font-size: 16px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.upload-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: #6c757d;
    margin-top: 4px;
}

.upload-actions {
    display: flex;
    gap: 5px;
}

.btn-icon {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    border: 1px solid #dee2e6;
    background: white;
    color: #6c757d;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}

.btn-icon:hover {
    background: #4B286D;
    color: white;
    border-color: #4B286D;
}

.upload-preview {
    position: relative;
    overflow: hidden;
    cursor: pointer;
}

.video-preview {
    position: relative;
    aspect-ratio: 16/9;
    background: #000;
}

.video-preview video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 60px;
    background: rgba(75, 40, 109, 0.9);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    transition: all 0.3s ease;
}

.video-preview:hover .play-button {
    background: rgba(123, 82, 171, 0.9);
    transform: translate(-50%, -50%) scale(1.1);
}

.video-duration {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
}

.image-preview {
    position: relative;
    aspect-ratio: 16/9;
    overflow: hidden;
}

.image-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.image-preview:hover img {
    transform: scale(1.05);
}

.image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
    color: white;
    font-size: 24px;
}

.image-preview:hover .image-overlay {
    opacity: 1;
}

.document-preview {
    padding: 30px 20px;
    text-align: center;
    background: #f8f9fa;
}

.document-icon {
    color: #4B286D;
    margin-bottom: 15px;
}

.document-info p {
    margin: 0 0 15px 0;
    color: #6c757d;
    font-size: 14px;
}

.upload-footer {
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid #dee2e6;
}

.upload-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    flex: 1;
    margin-right: 10px;
}

.tag {
    background: #e3f2fd;
    color: #1976d2;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
}

.no-tags {
    color: #6c757d;
    font-style: italic;
    font-size: 12px;
}

.uploads-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

.upload-filters {
    display: flex;
    gap: 10px;
}

.upload-filters select {
    padding: 8px 12px;
    border: 2px solid #dee2e6;
    border-radius: 6px;
    background: white;
    font-size: 14px;
    min-width: 150px;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #6c757d;
}

.empty-state i {
    font-size: 64px;
    margin-bottom: 20px;
    color: #adb5bd;
}

/* Advanced viewer styles */
#advanced-media-viewer .modal {
    display: flex;
    flex-direction: column;
}

#advanced-media-viewer .modal-body {
    flex: 1;
    min-height: 0;
}

.video-controls {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
}

.video-controls button {
    background: rgba(255,255,255,0.9);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #333;
    font-size: 18px;
    transition: all 0.2s ease;
}

.video-controls button:hover {
    background: white;
    transform: scale(1.1);
}

.progress-bar {
    flex: 1;
    height: 6px;
    background: rgba(255,255,255,0.3);
    border-radius: 3px;
    overflow: hidden;
    cursor: pointer;
}

.progress-fill {
    height: 100%;
    background: #4B286D;
    width: 0%;
}

.time-display {
    color: white;
    font-size: 14px;
    min-width: 100px;
    text-align: center;
}

/* Responsive design */
@media (max-width: 768px) {
    .uploads-grid {
        grid-template-columns: 1fr;
    }
    
    .uploads-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .upload-filters {
        flex-direction: column;
    }
    
    .upload-filters select {
        width: 100%;
    }
    
    #upload-modal .modal {
        width: 95vw;
        margin: 10px;
    }
}
</style>

<script>
// Enhanced file upload area interactions
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('file-upload-area');
    const fileInput = document.getElementById('file-input');
    const fileInfo = document.getElementById('file-info');
    
    if (uploadArea && fileInput) {
        // Click to select file
        uploadArea.addEventListener('click', () => fileInput.click());
        
        // Drag and drop functionality
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            uploadArea.classList.add('drag-over');
        }
        
        function unhighlight() {
            uploadArea.classList.remove('drag-over');
        }
        
        // Handle dropped files
        uploadArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        }
        
        // Handle file selection
        fileInput.addEventListener('change', handleFileSelect);
    }
});

function handleFileSelect() {
    const fileInput = document.getElementById('file-input');
    const fileName = document.getElementById('file-name');
    const fileSize = document.getElementById('file-size');
    const fileInfo = document.getElementById('file-info');
    const uploadArea = document.getElementById('file-upload-area');
    
    if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        
        // Update file info display
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        fileInfo.style.display = 'block';
        
        // Update upload area with preview
        const fileIcon = getFileIcon(file.type);
        uploadArea.innerHTML = `
            <i class="fas ${fileIcon}"></i>
            <p><strong>${file.name}</strong></p>
            <p>${formatFileSize(file.size)} â¢ ${file.type}</p>
            <p class="supported-formats">Click to choose a different file</p>
        `;
        
        // Enable upload button if title is filled
        const title = document.getElementById('doc-title').value;
        const uploadBtn = document.getElementById('start-upload-btn');
        if (title.trim() && uploadBtn) {
            uploadBtn.disabled = false;
        }
    }
}

// Update upload button state based on form validity
document.addEventListener('input', function(e) {
    if (e.target.id === 'doc-title') {
        const fileInput = document.getElementById('file-input');
        const uploadBtn = document.getElementById('start-upload-btn');
        if (uploadBtn) {
            uploadBtn.disabled = !(e.target.value.trim() && fileInput.files.length > 0);
        }
    }
});

// Replace the upload button handler
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        const uploadBtn = document.getElementById('start-upload-btn');
        if (uploadBtn) {
            uploadBtn.onclick = handleFileUploadWithProgress;
        }
    }, 1000);
});

// Initialize media system when app loads
window.addEventListener('load', function() {
    setTimeout(() => {
        if (typeof initializeMediaSystem === 'function') {
            initializeMediaSystem();
        }
    }, 2000);
});
</script>

<script>
// Update the main initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('Initializing enhanced Epic Trainer with media system...');
    
    // Initialize core app
    if (typeof initApp === 'function') {
        initApp();
    }
    
    // Initialize media system
    if (typeof initializeMediaSystem === 'function') {
        setTimeout(() => {
            initializeMediaSystem();
            console.log('Media system initialized');
        }, 1000);
    }
    
    // Update uploads display
    if (typeof updateUploadsDisplay === 'function') {
        setTimeout(updateUploadsDisplay, 1500);
    }
    
    // Initialize hospital search
    const hospitalTab = document.querySelector('a[href="#hospitals"]');
    if (hospitalTab && typeof initializeHospitalSearch === 'function') {
        hospitalTab.addEventListener('click', function() {
            setTimeout(() => {
                if (document.getElementById('hospitals').classList.contains('active')) {
                    initializeHospitalSearch();
                }
            }, 100);
        });
    }
    
    console.log('Enhanced Epic Trainer with complete media system initialized!');
});

// Make sure upload modal works
document.addEventListener('click', function(e) {
    if (e.target.id === 'upload-from-profile-btn' || 
        (e.target.closest && e.target.closest('#upload-from-profile-btn'))) {
        document.getElementById('upload-modal').classList.add('active');
    }
});
</script>
